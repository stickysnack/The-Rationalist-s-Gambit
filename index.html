<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁêÜÊÄß‰∫∫ÁöÑËØïÁÇº - The Rationalist's Trial</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Press Start 2P', monospace;
            background: linear-gradient(135deg, #0d1117, #161b22, #21262d);
            color: #f0f6fc;
            overflow: hidden;
            user-select: none;
            cursor: default;
        }
        
        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%);
        }
        
        /* Êâ´ÊèèÁ∫øÊïàÊûú */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 255, 0.03) 2px,
                rgba(255, 255, 255, 0.03) 4px
            );
            pointer-events: none;
            z-index: 1000;
        }
        
        /* ÂºÄÂßãÁïåÈù¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0d1117, #21262d);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.8s ease;
            overflow: hidden;
        }
        
        .start-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(74, 159, 255, 0.08) 0%, transparent 50%);
            animation: backgroundShift 8s ease-in-out infinite alternate;
        }
        
        @keyframes backgroundShift {
            0% { 
                background: 
                    radial-gradient(circle at 30% 20%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 70% 80%, rgba(74, 159, 255, 0.08) 0%, transparent 50%);
            }
            100% { 
                background: 
                    radial-gradient(circle at 70% 30%, rgba(255, 215, 0, 0.15) 0%, transparent 60%),
                    radial-gradient(circle at 30% 70%, rgba(74, 159, 255, 0.12) 0%, transparent 60%);
            }
        }
        
        .title-logo {
            font-size: 28px;
            color: #ffd700;
            text-shadow: 
                0 0 10px rgba(255, 215, 0, 0.6),
                0 0 20px rgba(255, 215, 0, 0.4),
                0 0 40px rgba(255, 215, 0, 0.2);
            margin-bottom: 20px;
            animation: titleGlow 3s ease-in-out infinite alternate;
            position: relative;
            z-index: 1;
        }
        
        .subtitle {
            font-size: 12px;
            color: #7d8590;
            margin-bottom: 40px;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
            animation: subtitleFade 2s ease-in-out infinite alternate;
        }

        /* ÂàùÂßãÈáëÈ¢ùËÆæÁΩÆÈù¢Êùø */
        .settings-panel {
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 40px;
            position: relative;
            z-index: 1;
        }

        .settings-title {
            color: #ffd700;
            font-size: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .setting-label {
            font-size: 8px;
            color: #c9d1d9;
        }

        .setting-input {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #ffd700;
            padding: 5px 8px;
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            width: 80px;
            text-align: center;
            border-radius: 4px;
        }

        .setting-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        @keyframes titleGlow {
            from { 
                text-shadow: 
                    0 0 10px rgba(255, 215, 0, 0.6),
                    0 0 20px rgba(255, 215, 0, 0.4),
                    0 0 40px rgba(255, 215, 0, 0.2);
                transform: scale(1);
            }
            to { 
                text-shadow: 
                    0 0 15px rgba(255, 215, 0, 0.8),
                    0 0 30px rgba(255, 215, 0, 0.6),
                    0 0 60px rgba(255, 215, 0, 0.3);
                transform: scale(1.02);
            }
        }
        
        @keyframes subtitleFade {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }
        
        .pixel-btn {
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            padding: 15px 30px;
            background: linear-gradient(145deg, #21262d, #161b22);
            color: #ffd700;
            border: 2px solid #30363d;
            position: relative;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-transform: uppercase;
            letter-spacing: 1px;
            min-width: 200px;
            text-align: center;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .pixel-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.6s ease;
        }
        
        .pixel-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.4), transparent);
            border-radius: 50%;
            transition: all 0.4s ease;
            transform: translate(-50%, -50%);
        }
        
        .pixel-btn:hover::before {
            left: 100%;
        }
        
        .pixel-btn:hover::after {
            width: 100%;
            height: 100%;
        }
        
        .pixel-btn:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: #ffd700;
            background: linear-gradient(145deg, #2a2f3a, #1e2328);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(255, 215, 0, 0.2),
                inset 0 0 0 1px rgba(255, 215, 0, 0.4);
            color: #fff;
        }
        
        .pixel-btn:active {
            transform: translateY(-1px) scale(0.98);
            transition: all 0.1s ease;
        }
        
        /* ÊïôÁ®ãÈù¢Êùø */
        .tutorial-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .tutorial-panel.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .tutorial-content {
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .tutorial-step {
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        
        .tutorial-step:nth-child(1) { animation-delay: 0.1s; }
        .tutorial-step:nth-child(2) { animation-delay: 0.2s; }
        .tutorial-step:nth-child(3) { animation-delay: 0.3s; }
        .tutorial-step:nth-child(4) { animation-delay: 0.4s; }
        .tutorial-step:nth-child(5) { animation-delay: 0.5s; }
        .tutorial-step:nth-child(6) { animation-delay: 0.6s; }
        .tutorial-step:nth-child(7) { animation-delay: 0.7s; }
        .tutorial-step:nth-child(8) { animation-delay: 0.8s; }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .tutorial-title {
            font-size: 14px;
            color: #ffd700;
            margin-bottom: 15px;
        }
        
        .tutorial-text {
            font-size: 8px;
            line-height: 1.6;
            color: #c9d1d9;
            margin-bottom: 10px;
        }
        
        .tutorial-highlight {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        /* ÊàêÂ∞±Èù¢ÊùøÊ†∑Âºè */
        .achievement-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .achievement-panel.active {
            opacity: 1;
            pointer-events: all;
        }

        .achievement-content {
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            max-width: 90vw;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .achievement-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .achievement-item {
            background: linear-gradient(145deg, #2a2f3a, #1e2328);
            border: 2px solid #30363d;
            border-radius: 10px;
            padding: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .achievement-item.unlocked {
            border-color: #ffd700;
            background: linear-gradient(145deg, #3a3520, #2d2a15);
        }

        .achievement-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255, 215, 0, 0.3);
        }

        .achievement-item-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .achievement-item-icon {
            font-size: 20px;
            margin-right: 10px;
            filter: grayscale(1);
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked .achievement-item-icon {
            filter: grayscale(0);
            opacity: 1;
        }

        .achievement-item-name {
            font-size: 10px;
            color: #7d8590;
            transition: color 0.3s ease;
        }

        .achievement-item.unlocked .achievement-item-name {
            color: #ffd700;
        }

        .achievement-item-desc {
            font-size: 8px;
            color: #c9d1d9;
            margin: 8px 0;
            line-height: 1.4;
        }

        .achievement-item-quote {
            font-size: 7px;
            color: #7d8590;
            font-style: italic;
            line-height: 1.3;
            border-left: 2px solid #30363d;
            padding-left: 8px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }

        .achievement-item.unlocked .achievement-item-quote {
            color: #c9d1d9;
            border-left-color: #ffd700;
        }

        /* ÊàêÂ∞±ÈÄöÁü•Ê†∑Âºè */
        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #ffd700, #d4af37);
            border: 3px solid #fff;
            border-radius: 15px;
            padding: 20px;
            color: #0d1117;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            max-width: 350px;
            z-index: 6000;
            box-shadow: 
                0 10px 30px rgba(255, 215, 0, 0.5),
                0 0 20px rgba(255, 215, 0, 0.3);
            animation: achievementSlideIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateX(100%);
        }

        .achievement-notification.show {
            transform: translateX(0);
        }

        .achievement-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .achievement-icon {
            font-size: 24px;
            margin-right: 10px;
            animation: achievementBounce 2s ease-in-out infinite;
        }

        .achievement-title {
            font-size: 8px;
            color: #8B4513;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .achievement-name {
            font-size: 12px;
            color: #0d1117;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .achievement-quote {
            font-size: 7px;
            color: #654321;
            line-height: 1.4;
            font-style: italic;
            border-left: 3px solid rgba(13, 17, 23, 0.3);
            padding-left: 10px;
            margin-top: 10px;
        }

        @keyframes achievementSlideIn {
            0% {
                transform: translateX(100%) scale(0.8);
                opacity: 0;
            }
            70% {
                transform: translateX(-20px) scale(1.05);
                opacity: 1;
            }
            100% {
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes achievementBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-5deg); }
            50% { transform: scale(1) rotate(0deg); }
            75% { transform: scale(1.1) rotate(5deg); }
        }
        
        /* ÊïÖ‰∫ãÂØπËØùÈù¢Êùø */
        .story-dialog-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: storyFadeIn 1s ease;
        }
        
        .story-dialog {
            max-width: 700px;
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 3px solid #ffd700;
            border-radius: 15px;
            padding: 30px;
            color: #f0f6fc;
            font-family: 'Press Start 2P', monospace;
            text-align: center;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.3);
            animation: storySlideIn 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .story-dialog::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: rotate 6s linear infinite;
        }

        .story-dialog > * {
            position: relative;
            z-index: 1;
        }
        
        .story-dialog-title {
            font-size: 16px;
            color: #ffd700;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }
        
        .story-dialog-text {
            font-size: 9px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #c9d1d9;
            text-align: left;
        }
        
        .story-dialog-choices {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .story-choice-btn {
            font-family: 'Press Start 2P', monospace;
            font-size: 8px;
            padding: 12px 20px;
            background: linear-gradient(145deg, #21262d, #161b22);
            color: #ffd700;
            border: 2px solid #30363d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .story-choice-btn:hover {
            border-color: #ffd700;
            background: linear-gradient(145deg, #2a2f3a, #1e2328);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
            transform: translateY(-2px);
        }

        .special-choice {
            background: linear-gradient(145deg, #8b4513, #654321);
            color: #ffd700;
            border-color: #8b4513;
        }

        .special-choice:hover {
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(139, 69, 19, 0.5);
        }
        
        @keyframes storyFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes storySlideIn {
            from {
                transform: scale(0.8) translateY(50px);
                opacity: 0;
            }
            to {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        
        /* È°∂ÈÉ®Áä∂ÊÄÅÊ†è */
        .status-bar {
            height: 90px;
            background: linear-gradient(90deg, #0d1117, #1c2128, #21262d);
            border-bottom: 4px solid #ffd700;
            display: flex;
            align-items: center;
            padding: 0 25px;
            box-shadow: 
                0 6px 30px rgba(255, 215, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .status-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 215, 0, 0.15), 
                rgba(74, 159, 255, 0.1),
                transparent);
            animation: statusSweep 6s infinite ease-in-out;
        }
        
        .status-bar::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                #ffd700, 
                #4a9eff, 
                #ffd700, 
                transparent);
            animation: statusGlow 3s ease-in-out infinite alternate;
        }
        
        @keyframes statusSweep {
            0%, 100% { left: -100%; }
            50% { left: 100%; }
        }
        
        @keyframes statusGlow {
            from { 
                box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
                opacity: 0.8;
            }
            to { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
                opacity: 1;
            }
        }
        
        .status-item {
            margin-right: 35px;
            text-align: center;
            position: relative;
            z-index: 1;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .status-item:hover {
            background: rgba(255, 215, 0, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }
        
        .status-label {
            font-size: 8px;
            color: #7d8590;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s ease;
        }
        
        .status-value {
            font-size: 14px;
            color: #ffd700;
            text-shadow: 0 0 12px rgba(255, 215, 0, 0.4);
            position: relative;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .status-value.animate {
            animation: valueChange 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .status-value.critical {
            color: #f85149;
            animation: criticalPulse 1.2s ease-in-out infinite;
        }
        
        @keyframes valueChange {
            0% { transform: scale(1); }
            30% { transform: scale(1.3) rotateY(180deg); color: #fff; }
            70% { transform: scale(0.9) rotateY(360deg); }
            100% { transform: scale(1); }
        }
        
        @keyframes criticalPulse {
            0%, 100% { 
                color: #f85149;
                text-shadow: 
                    0 0 12px rgba(248, 81, 73, 0.6),
                    0 0 25px rgba(248, 81, 73, 0.3);
                transform: scale(1);
            }
            50% { 
                color: #ff6b6b;
                text-shadow: 
                    0 0 18px rgba(248, 81, 73, 0.9),
                    0 0 35px rgba(248, 81, 73, 0.5);
                transform: scale(1.1);
            }
        }
        
        /* Ë¥¢ÂØåÊù° */
        .wealth-bar {
            position: absolute;
            bottom: -2px;
            left: 5px;
            right: 5px;
            height: 6px;
            background: linear-gradient(90deg, #f85149, #ffd700, #2ea043);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-radius: 3px;
            box-shadow: 
                0 0 15px rgba(255, 215, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            overflow: hidden;
            z-index: 2;
            min-width: 1px; /* Á°Æ‰øùÂç≥‰ΩøË¥¢ÂØå‰∏∫0‰πüËÉΩÁúãÂà∞ */
        }
        
        .wealth-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -50%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            animation: wealthShine 2s linear infinite;
        }
        
        @keyframes wealthShine {
            0% { left: -50%; }
            100% { left: 150%; }
        }
        
        /* ‰∏ªÊ∏∏ÊàèÂå∫Âüü */
        .game-area {
            flex: 1;
            display: flex;
            position: relative;
        }
        
        /* Â∑¶‰æßÈù¢Êùø */
        .left-panel {
            width: 320px;
            background: linear-gradient(145deg, rgba(13, 17, 23, 0.95), rgba(22, 27, 34, 0.95));
            border-right: 2px solid #30363d;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        .panel-title {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
            position: relative;
        }
        
        .panel-title::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 2px;
            background: linear-gradient(90deg, transparent, #ffd700, transparent);
        }
        
        /* ‰∏≠Â§ÆÊãçÂçñÂå∫Âüü */
        .auction-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        /* Âè≥‰æßÈù¢Êùø */
        .right-panel {
            width: 300px;
            background: linear-gradient(145deg, rgba(13, 17, 23, 0.95), rgba(22, 27, 34, 0.95));
            border-left: 2px solid #30363d;
            padding: 20px;
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        
        /* Â¢ûÂº∫ÁöÑÂç°ÁâáÊ†∑Âºè */
        .card {
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid #30363d;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--rarity-color, #7d8590);
            box-shadow: 0 0 15px var(--rarity-color, #7d8590);
            transition: all 0.3s ease;
        }
        
        .card::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
            transition: left 0.6s ease;
        }
        
        .card:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--rarity-color, #30363d);
            box-shadow: 
                0 12px 35px rgba(0, 0, 0, 0.5),
                0 0 25px rgba(var(--rarity-rgb, 125, 133, 144), 0.3),
                inset 0 2px 0 rgba(255, 255, 255, 0.2),
                inset 0 -2px 0 rgba(0, 0, 0, 0.3);
        }
        
        .card:hover::before {
            height: 6px;
            box-shadow: 0 0 25px var(--rarity-color, #7d8590);
        }
        
        .card:hover::after {
            left: 100%;
        }
        
        .card-title {
            font-size: 10px;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        }
        
        .card-content {
            font-size: 8px;
            line-height: 1.5;
            color: #c9d1d9;
        }
        
        /* Ê∑òÊ±∞Áä∂ÊÄÅÁöÑÂç°Áâá */
        .card.eliminated {
            opacity: 0.3;
            transform: scale(0.95);
            filter: grayscale(1);
            border-color: #f85149;
        }
        
        .card.eliminated::before {
            background: #f85149;
        }
        
        .eliminated-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(248, 81, 73, 0.9);
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 8px;
            z-index: 10;
        }

        /* ÊäÄËÉΩ‰∏éËØÖÂííÊïàÊûúÊ†∑Âºè */
        .skill-effect {
            background: linear-gradient(145deg, rgba(46, 160, 67, 0.2), rgba(46, 160, 67, 0.1));
            border: 2px solid rgba(46, 160, 67, 0.5);
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }

        .skill-effect::before {
            content: '‚ú®';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 12px;
            animation: skillSparkle 2s ease-in-out infinite;
        }

        .curse-effect {
            background: linear-gradient(145deg, rgba(139, 69, 19, 0.2), rgba(139, 69, 19, 0.1));
            border: 2px solid rgba(139, 69, 19, 0.5);
            border-radius: 8px;
            padding: 10px;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }

        .curse-effect::before {
            content: 'üíÄ';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 12px;
            animation: curseGlow 2s ease-in-out infinite;
        }

        @keyframes skillSparkle {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes curseGlow {
            0%, 100% { 
                opacity: 0.8; 
                filter: drop-shadow(0 0 3px rgba(139, 69, 19, 0.5));
            }
            50% { 
                opacity: 1; 
                filter: drop-shadow(0 0 8px rgba(139, 69, 19, 0.8));
            }
        }

        .effect-name {
            font-size: 9px;
            color: #ffd700;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .effect-description {
            font-size: 7px;
            line-height: 1.4;
            color: #c9d1d9;
            margin-bottom: 5px;
        }

        .effect-duration {
            font-size: 6px;
            color: #7d8590;
            font-style: italic;
        }

        /* ÁâπÊÆäÁâ©ÂìÅÊïàÊûú */
        .cursed-item {
            position: relative;
        }

        .cursed-item::after {
            content: 'üíÄ';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 16px;
            animation: curseFloat 3s ease-in-out infinite;
            z-index: 10;
        }

        .blessed-item {
            position: relative;
        }

        .blessed-item::after {
            content: '‚ú®';
            position: absolute;
            top: -5px;
            right: -5px;
            font-size: 16px;
            animation: blessFloat 3s ease-in-out infinite;
            z-index: 10;
        }

        @keyframes curseFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-8px) rotate(10deg); }
        }

        @keyframes blessFloat {
            0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
            50% { transform: translateY(-5px) rotate(-10deg) scale(1.1); }
        }
        
        /* ÊãçÂçñÁâ©ÂìÅÂç°Áâá */
        .auction-item {
            width: 450px;
            height: 350px;
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 4px solid #ffd700;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 
                0 15px 50px rgba(255, 215, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.15),
                inset 0 -2px 0 rgba(0, 0, 0, 0.2);
            animation: auctionGlow 4s ease-in-out infinite alternate;
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
        }
        
        .auction-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, 
                transparent, 
                rgba(255, 215, 0, 0.1), 
                transparent, 
                rgba(74, 159, 255, 0.05),
                transparent);
            animation: rotate 6s linear infinite;
        }
        
        .auction-item::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            animation: innerGlow 3s ease-in-out infinite alternate;
        }
        
        .auction-item > * {
            position: relative;
            z-index: 1;
        }
        
        @keyframes auctionGlow {
            from { 
                box-shadow: 
                    0 15px 50px rgba(255, 215, 0, 0.3),
                    inset 0 2px 0 rgba(255, 255, 255, 0.15),
                    inset 0 -2px 0 rgba(0, 0, 0, 0.2);
                transform: scale(1);
            }
            to { 
                box-shadow: 
                    0 20px 60px rgba(255, 215, 0, 0.5),
                    0 0 40px rgba(255, 215, 0, 0.3),
                    inset 0 3px 0 rgba(255, 255, 255, 0.2),
                    inset 0 -3px 0 rgba(0, 0, 0, 0.3);
                transform: scale(1.01);
            }
        }
        
        @keyframes innerGlow {
            from { 
                border-color: rgba(255, 215, 0, 0.2);
                box-shadow: inset 0 0 20px rgba(255, 215, 0, 0.1);
            }
            to { 
                border-color: rgba(255, 215, 0, 0.4);
                box-shadow: inset 0 0 30px rgba(255, 215, 0, 0.2);
            }
        }
        
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }
        
        .item-name {
            font-size: 14px;
            color: #ffd700;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
            animation: textPulse 2s ease-in-out infinite alternate;
        }
        
        @keyframes textPulse {
            from { text-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            to { text-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }
        
        .item-description {
            font-size: 9px;
            color: #c9d1d9;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .item-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 5px;
            background: rgba(255, 215, 0, 0.05);
        }
        
        .stat-label {
            font-size: 7px;
            color: #7d8590;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-value {
            font-size: 11px;
            color: #f0f6fc;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* ‰øùËØÅÈáëÊèêÁ§∫ */
        .margin-notice {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(74, 159, 255, 0.9);
            color: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 8px;
            border: 2px solid #4a9eff;
            box-shadow: 0 5px 20px rgba(74, 159, 255, 0.3);
            animation: marginNotice 0.8s ease-out;
            z-index: 10;
        }
        
        @keyframes marginNotice {
            0% {
                transform: translateX(-50%) translateY(-20px);
                opacity: 0;
            }
            100% {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        /* Âá∫‰ª∑ÁïåÈù¢ */
        .bidding-panel {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, rgba(13, 17, 23, 0.98), rgba(22, 27, 34, 0.98));
            padding: 35px;
            border-radius: 20px;
            border: 3px solid #ffd700;
            text-align: center;
            backdrop-filter: blur(20px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.6),
                0 0 30px rgba(255, 215, 0, 0.2),
                inset 0 2px 0 rgba(255, 255, 255, 0.1);
            animation: slideUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .bidding-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, 
                rgba(255, 215, 0, 0.05) 0%, 
                transparent 70%);
            animation: panelPulse 4s ease-in-out infinite;
        }
        
        .bidding-panel > * {
            position: relative;
            z-index: 1;
        }
        
        @keyframes slideUp {
            from {
                transform: translateX(-50%) translateY(80px);
                opacity: 0;
                box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
                box-shadow: 
                    0 15px 40px rgba(0, 0, 0, 0.6),
                    0 0 30px rgba(255, 215, 0, 0.2);
            }
        }
        
        @keyframes panelPulse {
            0%, 100% { 
                background: radial-gradient(circle at 50% 50%, 
                    rgba(255, 215, 0, 0.05) 0%, 
                    transparent 70%);
            }
            50% { 
                background: radial-gradient(circle at 50% 50%, 
                    rgba(255, 215, 0, 0.1) 0%, 
                    transparent 80%);
            }
        }
        
        .bid-input {
            width: 240px;
            height: 55px;
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            text-align: center;
            background: linear-gradient(145deg, #0d1117, #1c2128);
            border: 3px solid #30363d;
            border-radius: 12px;
            color: #ffd700;
            margin: 20px 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                inset 0 2px 4px rgba(0, 0, 0, 0.3),
                0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .bid-input:focus {
            outline: none;
            border-color: #ffd700;
            background: linear-gradient(145deg, #161b22, #21262d);
            box-shadow: 
                0 0 25px rgba(255, 215, 0, 0.4),
                inset 0 0 15px rgba(255, 215, 0, 0.1),
                inset 0 2px 4px rgba(0, 0, 0, 0.3);
            transform: scale(1.05);
            color: #fff;
        }
        
        .bid-input:hover {
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 
                0 0 20px rgba(255, 215, 0, 0.3),
                inset 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .bid-hint {
            color: #7d8590;
            font-size: 7px;
            margin-top: 15px;
            line-height: 1.4;
        }
        
        /* ÂÖ≥Âç°ÊåáÁ§∫Âô® */
        .level-indicator {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
            z-index: 10;
        }
        
        .level-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid #30363d;
            position: relative;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: #7d8590;
        }
        
        .level-dot.completed {
            background: linear-gradient(145deg, #2ea043, #238636);
            border-color: #2ea043;
            color: #f0f6fc;
            box-shadow: 0 0 15px rgba(46, 160, 67, 0.5);
        }
        
        .level-dot.current {
            background: linear-gradient(145deg, #ffd700, #d4af37);
            border-color: #ffd700;
            color: #0d1117;
            animation: currentLevel 2s ease-in-out infinite alternate;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        @keyframes currentLevel {
            from { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
            to { 
                transform: scale(1.1);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            }
        }
        
        /* Ê∑òÊ±∞Âä®Áîª */
        .elimination-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(248, 81, 73, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        .elimination-overlay.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .elimination-content {
            text-align: center;
            color: #fff;
            animation: eliminationShake 0.8s ease-out;
        }
        
        .elimination-title {
            font-size: 32px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: eliminationGlow 1s ease-in-out infinite alternate;
        }
        
        .elimination-subtitle {
            font-size: 12px;
            margin-bottom: 30px;
            opacity: 0.8;
        }
        
        @keyframes eliminationShake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-10px); }
            20% { transform: translateX(10px); }
            30% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            50% { transform: translateX(-6px); }
            60% { transform: translateX(6px); }
            70% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
            90% { transform: translateX(-2px); }
        }
        
        @keyframes eliminationGlow {
            from { 
                text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            }
            to { 
                text-shadow: 0 0 40px rgba(255, 255, 255, 0.8);
            }
        }
        
        /* ÁªìÊûúÈù¢Êùø */
        .result-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 4000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        .result-panel.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .result-content {
            background: linear-gradient(145deg, #21262d, #161b22);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #ffd700;
            text-align: center;
            min-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: resultAppear 0.6s ease;
            position: relative;
            overflow: hidden;
        }
        
        .result-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: rotate 6s linear infinite;
        }
        
        .result-content > * {
            position: relative;
            z-index: 1;
        }
        
        @keyframes resultAppear {
            from {
                transform: scale(0.8) rotateY(90deg);
                opacity: 0;
            }
            to {
                transform: scale(1) rotateY(0deg);
                opacity: 1;
            }
        }
        
        .result-title {
            font-size: 16px;
            color: #ffd700;
            margin-bottom: 25px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 25px 0;
        }
        
        .result-stat {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
        }
        
        .result-stat-label {
            font-size: 8px;
            color: #7d8590;
            margin-bottom: 5px;
        }
        
        .result-stat-value {
            font-size: 12px;
            color: #ffd700;
        }
        
        /* Âá∫‰ª∑Âä®ÁîªÁ≥ªÁªü */
        .bidding-animation-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1500;
        }
        
        .bid-bubble {
            position: absolute;
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid var(--player-color, #ffd700);
            border-radius: 20px;
            padding: 15px 20px;
            color: var(--player-color, #ffd700);
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            text-shadow: 0 0 10px var(--player-color, #ffd700);
            box-shadow: 
                0 5px 20px rgba(0, 0, 0, 0.5),
                0 0 20px var(--player-color-rgba, rgba(255, 215, 0, 0.3));
            transform: scale(0);
            animation: bidBubbleAppear 0.8s ease-out forwards;
            backdrop-filter: blur(10px);
        }
        
        .bid-bubble::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid var(--player-color, #ffd700);
        }
        
        @keyframes bidBubbleAppear {
            0% {
                transform: scale(0) translateY(50px);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) translateY(-10px);
                opacity: 1;
            }
            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }
        
        /* Âá∫‰ª∑Êè≠ÊôìÈò∂ÊÆµ */
        .bidding-reveal-stage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        
        .bidding-reveal-stage.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .reveal-title {
            font-size: 18px;
            color: #ffd700;
            margin-bottom: 40px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: titlePulse 2s ease-in-out infinite alternate;
        }
        
        .reveal-players {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            max-width: 80vw;
        }
        
        .reveal-player {
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 3px solid var(--player-color, #7d8590);
            border-radius: 15px;
            padding: 20px;
            min-width: 200px;
            text-align: center;
            transform: translateY(50px);
            opacity: 0;
            animation: playerReveal 0.8s ease-out forwards;
            position: relative;
            overflow: hidden;
        }
        
        .reveal-player.winner {
            border-color: #ffd700;
            --player-color: #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            animation: playerReveal 0.8s ease-out forwards, winnerGlow 1s ease-in-out infinite alternate 0.8s;
        }
        
        .reveal-player-name {
            font-size: 12px;
            color: var(--player-color, #7d8590);
            margin-bottom: 10px;
        }
        
        .reveal-player-bid {
            font-size: 16px;
            color: #f0f6fc;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .reveal-player-wealth {
            font-size: 10px;
            color: #7d8590;
            margin: 5px 0;
        }
        
        .reveal-continue {
            margin-top: 40px;
            animation: fadeIn 1s ease-out 3s both;
        }
        
        @keyframes playerReveal {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes winnerGlow {
            from {
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            }
            to {
                box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* ÊÄùËÄÉÂä®Áîª */
        .thinking-animation {
            position: absolute;
            top: -30px;
            right: 10px;
            font-size: 20px;
            animation: thinking 2s ease-in-out infinite;
        }
        
        @keyframes thinking {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.5;
            }
            50% { 
                transform: scale(1.2);
                opacity: 1;
            }
        }
        
        /* ÂÄíËÆ°Êó∂Âä®Áîª */
        .countdown-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 72px;
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            z-index: 3000;
            animation: countdownPulse 1s ease-in-out;
        }
        
        @keyframes countdownPulse {
            0% { 
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.3);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }
        
        /* ËßíËâ≤ÂØπËØùÊ∞îÊ≥° */
        .character-dialogue-bubble {
            position: absolute;
            top: -120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, #21262d, #161b22);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 15px;
            max-width: 250px;
            font-size: 7px;
            color: #f0f6fc;
            z-index: 1000;
            animation: dialoguePop 4s ease forwards;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .dialogue-character {
            font-size: 6px;
            color: #ffd700;
            margin-bottom: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .dialogue-text {
            line-height: 1.3;
        }

        .character-dialogue-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #ffd700;
        }
        
        @keyframes dialoguePop {
            0% {
                transform: translateX(-50%) scale(0);
                opacity: 0;
            }
            10% {
                transform: translateX(-50%) scale(1.1);
                opacity: 1;
            }
            15% {
                transform: translateX(-50%) scale(1);
            }
            85% {
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) scale(0);
                opacity: 0;
            }
        }
        
        /* Á≤íÂ≠êÊïàÊûú */
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 6px rgba(255, 215, 0, 0.8);
        }
        
        .particle.success {
            background: #2ea043;
            box-shadow: 0 0 6px rgba(46, 160, 67, 0.8);
        }
        
        .particle.failure {
            background: #f85149;
            box-shadow: 0 0 6px rgba(248, 81, 73, 0.8);
        }
        
        .particle.elimination {
            background: #ff6b6b;
            box-shadow: 0 0 8px rgba(255, 107, 107, 0.9);
        }

        .particle.skill {
            background: #2ea043;
            box-shadow: 0 0 10px rgba(46, 160, 67, 1);
        }

        .particle.curse {
            background: #8b4513;
            box-shadow: 0 0 10px rgba(139, 69, 19, 1);
        }

        .particle.conspiracy {
            background: #9f7aea;
            box-shadow: 0 0 12px rgba(159, 122, 234, 1);
        }

        .particle.mystery {
            background: #ff7b72;
            box-shadow: 0 0 8px rgba(255, 123, 114, 0.9);
        }
        
        .glitch {
            animation: glitch 0.3s;
        }
        
        @keyframes glitch {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-2px); }
            40% { transform: translateX(2px); }
            60% { transform: translateX(-1px); }
            80% { transform: translateX(1px); }
        }
        
        .neon-text {
            text-shadow: 
                0 0 5px currentColor,
                0 0 10px currentColor,
                0 0 15px currentColor,
                0 0 20px currentColor;
        }

        .bounce {
            animation: bounce 0.6s ease;
        }

        .shake {
            animation: shake 0.6s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        /* ÈöêËóèÁ±ª */
        .hidden {
            display: none !important;
        }

        /* ÁâπÊÆäÊïàÊûúÁ±ª */
        .mysterious-glow {
            box-shadow: 0 0 30px rgba(159, 122, 234, 0.5);
            animation: mysterGlow 2s ease-in-out infinite alternate;
        }

        @keyframes mysterGlow {
            from { box-shadow: 0 0 20px rgba(159, 122, 234, 0.3); }
            to { box-shadow: 0 0 40px rgba(159, 122, 234, 0.7); }
        }

        .conspiracy-border {
            border-color: #9f7aea !important;
            animation: conspiracyPulse 1.5s ease-in-out infinite;
        }

        @keyframes conspiracyPulse {
            0%, 100% { border-color: #9f7aea; }
            50% { border-color: #ff7b72; }
        }

        .dramatic-entrance {
            animation: dramaticEntrance 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes dramaticEntrance {
            0% {
                transform: scale(0.5) rotate(-180deg);
                opacity: 0;
            }
            50% {
                transform: scale(1.2) rotate(-90deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1400px) {
            .left-panel, .right-panel {
                width: 280px;
            }
            
            .auction-item {
                width: 400px;
                height: 300px;
            }
        }
        
        @media (max-width: 1200px) {
            .left-panel, .right-panel {
                width: 250px;
            }
            
            .auction-item {
                width: 350px;
                height: 280px;
            }
            
            .title-logo {
                font-size: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .left-panel, .right-panel {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    
    <!-- ÂºÄÂßãÁïåÈù¢ -->
    <div class="start-screen" id="startScreen">
        <div class="title-logo neon-text">THE RATIONALIST'S</div>
        <div class="title-logo neon-text" style="margin-top: -10px;">TRIAL</div>
        <div class="subtitle">ÁêÜÊÄß‰∫∫ÁöÑËØïÁÇº - ÊöóÂΩ±ÊãçÂçñÊâÄ‰º†Â•á</div>
        
        <!-- ËÆæÁΩÆÈù¢Êùø -->
        <div class="settings-panel">
            <div class="settings-title">ÊãçÂçñÊâÄËÆæÂÆö</div>
            <div class="setting-item">
                <label class="setting-label">Ëµ∑ÂßãËµÑÈáë:</label>
                <input type="number" class="setting-input" id="initialWealth" value="200" min="100" max="1000">
            </div>
            <div class="setting-item">
                <label class="setting-label">Á´û‰∫âËÄÖÊï∞:</label>
                <input type="number" class="setting-input" id="aiCount" value="4" min="3" max="6">
            </div>
            <div class="setting-item">
                <label class="setting-label">ÂÖ•Âú∫Ë¥π:</label>
                <input type="number" class="setting-input" id="marginFee" value="10" min="5" max="50">
            </div>
        </div>
        
        <div class="menu-buttons">
            <button class="pixel-btn" onclick="startGame()">ËøõÂÖ•ÊöóÂΩ±</button>
            <button class="pixel-btn" onclick="showTutorial()">ÊãçÂçñÁßòÁ±ç</button>
            <button class="pixel-btn" onclick="showAchievements()">‰º†Â•áËÆ∞ÂΩï</button>
            <button class="pixel-btn" onclick="showLore()">ÊöóÂΩ±ÁßòÂè≤</button>
            <button class="pixel-btn" onclick="toggleFullscreen()">ÂÖ®Â±èÊ≤âÊµ∏</button>
        </div>
        
        <div style="position: absolute; bottom: 30px; font-size: 8px; color: #30363d; text-align: center;">
            <strong>ÊöóÂΩ±ÊãçÂçñÊâÄ</strong> - Âú∞‰∏ã‰∏ñÁïåÊúÄÁ•ûÁßòÁöÑË¥¢ÂØåËßíÊñóÂú∫<br>
            Êåâ ESC ÈöèÊó∂ËøîÂõûÂú∞Ë°® | ÁêÜÊÄß‰∏éÁñØÁãÇÁöÑÁªàÊûÅÂØπÂÜ≥ | ÂìàËÄ∂ÂÖãÂú®Êöó‰∏≠ËßÇÂØüÁùÄ‰∏ÄÂàá
        </div>
    </div>
    
    <!-- ÈùôÊÄÅÊïôÁ®ãÈù¢Êùø -->
    <div class="tutorial-panel" id="tutorialPanel">
        <div class="tutorial-content">
            <div class="tutorial-step">
                <div class="tutorial-title">ÊöóÂΩ±ÊãçÂçñÊâÄÁîüÂ≠òÊ≥ïÂàô</div>
                <div class="tutorial-text">
                    Ê¨¢ËøéÊù•Âà∞Âú∞‰∏ã‰∏ñÁïåÊúÄÂç±Èô©ÁöÑË¥¢ÂØåÊ∏∏ÊàèÔºÅÂú®ËøôÈáåÔºåÊØè‰∏™ÂèÇ‰∏éËÄÖÈÉΩÈöêËóèÁùÄ‰∏çÂèØÂëä‰∫∫ÁöÑÁßòÂØÜÔºåÊØè‰ª∂ÊãçÂìÅÈÉΩÂèØËÉΩÊîπÂèò‰Ω†ÁöÑÂëΩËøê„ÄÇ‰Ω†Â∞ÜÂú®12ËΩÆË°ÄËÖ•Á´û‰ª∑‰∏≠‰∏éÊúÄÂç±Èô©ÁöÑÂØπÊâãËæÉÈáèÔºåÁõÆÊ†áÂè™Êúâ‰∏Ä‰∏™‚Äî‚ÄîÊàê‰∏∫ÊúÄÂêéÁöÑËµ¢ÂÆ∂„ÄÇ
                </div>
                <div class="tutorial-highlight">
                    <strong>ÁîüÂ≠òËßÑÂàôÔºö</strong>Ë¥¢ÂØåÊéíÂêçÂÜ≥ÂÆöÁîüÊ≠ªÔºåÁ†¥‰∫ßËÄÖÂ∞ÜÊ∞∏ËøúÊ∂àÂ§±Âú®ÊöóÂΩ±‰∏≠<br>
                    <strong>ËÉúÂà©Êù°‰ª∂Ôºö</strong>Âú®ÊúÄÂêéÁöÑÂÆ°Âà§‰∏≠Êã•ÊúâÊúÄÂ§öË¥¢ÂØåÔºåÊàê‰∏∫ÊöóÂΩ±ÊãçÂçñÊâÄÁöÑÊñ∞‰∏ª‰∫∫
                </div>
            </div>
            
            <div class="tutorial-step">
                <div class="tutorial-title">Á•ûÁßòÊãçÂìÅ‰∏éË∂ÖËá™ÁÑ∂ÂäõÈáè</div>
                <div class="tutorial-text">
                    <strong>ËØÖÂííÊñáÁâ©Ôºö</strong>Êüê‰∫õÁâ©ÂìÅÊê∫Â∏¶Âè§ËÄÅÁöÑËØÖÂííÔºå‰ºöÊîπÂèò‰Ω†ÁöÑË°å‰∏∫Ê®°Âºè<br>
                    <strong>Á•ûÁßòÊäÄËÉΩÔºö</strong>Âπ∏ËøêÁöÑËØùÔºå‰Ω†ÂèØËÉΩËé∑ÂæóË∂ÖËá™ÁÑ∂ÁöÑËÉΩÂäõÂä†Êàê<br>
                    <strong>ÊöóÂΩ±ÊïàÂ∫îÔºö</strong>È´ò‰ª∑ÂÄºÁâ©ÂìÅÂæÄÂæÄ‰º¥ÈöèÁùÄÊõ¥Â§ßÁöÑÈ£éÈô©<br>
                    <strong>ÁßòÂØÜËÅîÁõüÔºö</strong>AIÂØπÊâã‰πãÈó¥ÂèØËÉΩ‰ºöÂΩ¢Êàê‰∏¥Êó∂ËÅîÁõüÂØπ‰ªò‰Ω†
                </div>
                <div class="tutorial-highlight" style="background: rgba(139, 69, 19, 0.1); border-color: rgba(139, 69, 19, 0.3);">
                    <strong>Ë≠¶ÂëäÔºö</strong>Êüê‰∫õÁâ©ÂìÅË¢´ÈªëÊöóÂäõÈáèÊ±°ÊüìÔºåËé∑ÂæóÂÆÉ‰ª¨ÂèØËÉΩËÆ©‰Ω†ÁöÑÁêÜÊÄßÂèóÂà∞Ê∞∏‰πÖÊçüÂÆ≥„ÄÇ<br>
                    ‰ΩÜÂ∑®Â§ßÁöÑÈ£éÈô©ÂæÄÂæÄÊÑèÂë≥ÁùÄÂ∑®Â§ßÁöÑÂõûÊä•...
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ÂÖ•Âú∫Ë¥π‰∏éÁîüÂ≠òÊú∫Âà∂</div>
                <div class="tutorial-text">
                    <strong>ÊöóÂΩ±ËßÑÂàôÔºö</strong>ÊØèËΩÆÂøÖÈ°ªÊîØ‰ªòÂÖ•Âú∫Ë¥πÊâçËÉΩÂèÇ‰∏éÁ´û‰ª∑<br>
                    <strong>Ë¥¢ÂØåËÆ°ÁÆóÔºö</strong>Áé∞Èáë + Ëé∑ÂæóÁâ©ÂìÅÁöÑ‰º∞ÂÄº = ÊÄªË¥¢ÂØå<br>
                    <strong>ÂÖ®ÂäõÂá∫‰ª∑Ôºö</strong>ÂèØ‰ª•ÊäµÊäºÂÖ®ÈÉ®Ë¥¢ÂØåÊù•Âá∫‰ª∑<br>
                    <strong>Ëé∑ËÉúÊî∂ÁõäÔºö</strong>ÊîØ‰ªòÂá∫‰ª∑ÔºåËé∑ÂæóÁâ©ÂìÅÂèäÂÖ∂Â∏ÇÂú∫‰ª∑ÂÄº<br>
                    <strong>Ê≠ª‰∫°Á∫øÔºö</strong>ÊÄªË¥¢ÂØå‰∏çË∂≥ÊîØ‰ªòÂÖ•Âú∫Ë¥πÊó∂Á´ãÂç≥Ë¢´Ê∑òÊ±∞
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">Á∫≥‰ªÄÂùáË°° - ÁêÜÊÄß‰πãÂÖâ</div>
                <div class="tutorial-text">
                    Âú®Ëøô‰∏™ÁñØÁãÇÁöÑ‰∏ñÁïå‰∏≠ÔºåÊï∞Â≠¶ÊòØ‰Ω†ÂîØ‰∏ÄÁöÑÁõüÂèãÔºö
                </div>
                <div class="tutorial-highlight" style="background: rgba(74, 159, 255, 0.1); border-color: rgba(74, 159, 255, 0.3); text-align: center; font-family: monospace;">
                    <strong>ÊúÄ‰ºòÂá∫‰ª∑ = ‰Ω†ÁöÑ‰º∞ÂÄº √ó (Á´û‰∫âËÄÖÊï∞-1) √∑ Á´û‰∫âËÄÖÊï∞</strong><br>
                    <strong>+ Á•ûÁßòÂäõÈáèÂä†Êàê - ËØÖÂííÂΩ±Âìç</strong>
                </div>
                <div class="tutorial-highlight" style="background: rgba(248, 81, 73, 0.1); border-color: rgba(248, 81, 73, 0.3); color: #ff6b6b;">
                    <strong>ËØÖÂííË≠¶ÂëäÔºö</strong>Êüê‰∫õÈªëÊöóÂäõÈáè‰ºöÂº∫Âà∂‰øÆÊîπ‰Ω†ÁöÑÂá∫‰ª∑ÔºÅ<br>
                    ÂáÜÂ§áÂ•ΩÂ∫îÂØπÂÆåÂÖ®Â§±ÊéßÁöÑÂ±ÄÈù¢„ÄÇ
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ÊöóÂΩ±Êìç‰Ωú‰∏éÁßòÂØÜÂø´Êç∑ÈîÆ</div>
                <div class="tutorial-text">
                    <strong>Âá∫‰ª∑Êìç‰ΩúÔºö</strong>ËæìÂÖ•ÈáëÈ¢ù ‚Üí ÂõûËΩ¶Êèê‰∫§Ê≠ª‰∫°ËµåÊ≥®<br>
                    <strong>NÈîÆÔºö</strong>Ëá™Âä®ËÆ°ÁÆóÁ∫≥‰ªÄÂùáË°°ÔºàÂ¶ÇÊûú‰Ω†ÁöÑÁêÜÊÄßÂ∞öÂ≠òÔºâ<br>
                    <strong>Á©∫Ê†ºÈîÆÔºö</strong>Á°ÆËÆ§ÁªìÊûúÔºåÁªßÁª≠Â†ïÂÖ•Ê∑±Ê∏ä<br>
                    <strong>ESCÈîÆÔºö</strong>ÈÄÉÂõûÂú∞Ë°®‰∏ñÁïåÔºàÂ¶ÇÊûú‰Ω†ËøòÊúâÂãáÊ∞îÔºâ<br>
                    <strong>ÊöóÂΩ±Áä∂ÊÄÅÔºö</strong>Â∑¶‰æßÈù¢ÊùøÊòæÁ§∫‰Ω†ÂΩìÂâçÁöÑË∂ÖËá™ÁÑ∂Áä∂ÊÄÅ
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ÁîüÂ≠òÁ≠ñÁï•‰∏éÊöóÂΩ±Êô∫ÊÖß</div>
                <div class="tutorial-text">
                    <strong>Á•ûÁßòÊäÄËÉΩÔºö</strong>Ê¥ûÂØü„ÄÅÂπ∏Ëøê„ÄÅÂÜ∑ÈùôÁ≠âËÉΩÂäõÂèØ‰ª•ÊãØÊïë‰Ω†ÁöÑÁîüÂëΩ<br>
                    <strong>Ëá¥ÂëΩËØÖÂííÔºö</strong>Ë¥™Â©™„ÄÅÂÜ≤Âä®„ÄÅÂéÑËøêÁ≠â‰ºöÂ∞Ü‰Ω†Êé®ÂêëÊØÅÁÅ≠ËæπÁºò<br>
                    <strong>È£éÈô©ËØÑ‰º∞Ôºö</strong>È´ò‰ª∑ÂÄºÁâ©ÂìÅÂæÄÂæÄÈöêËóèÁùÄ‰∏çÂèØÈ¢ÑÁü•ÁöÑÂç±Èô©<br>
                    <strong>ÈÄÇÂ∫îËøõÂåñÔºö</strong>Ê†πÊçÆËé∑ÂæóÁöÑÂäõÈáèË∞ÉÊï¥‰Ω†ÁöÑÁ≠ñÁï•<br>
                    <strong>Êïå‰∫∫ÂøÉÁêÜÔºö</strong>ËßÇÂØüAIÂØπÊâãÁöÑË°å‰∏∫Ê®°ÂºèÂíåÊÉÖÁª™ÂèòÂåñ
                </div>
                <div class="tutorial-highlight">
                    <strong>Â§ßÂ∏àÁßòËØÄÔºö</strong>Âú®Ëøô‰∏™ÂÖÖÊª°ËØÖÂíí‰∏éÊú∫ÈÅáÁöÑ‰∏ñÁïå‰∏≠ÔºåÈÄÇÂ∫îËÉΩÂäõÊØîÁ∫ØÁ≤πÁöÑÁêÜÊÄßÊõ¥ÈáçË¶Å„ÄÇ<br>
                    Â≠¶‰ºö‰∏éÈªëÊöóÂäõÈáèÂÖ±ËàûÔºå‰ΩÜÊ∞∏Ëøú‰∏çË¶ÅÂÆåÂÖ®‰ø°‰ªªÂÆÉ‰ª¨„ÄÇ
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="pixel-btn" onclick="hideTutorial()">Ë∏èÂÖ•ÈªëÊöó</button>
            </div>
        </div>
    </div>

    <!-- ÊöóÂΩ±ÁßòÂè≤Èù¢Êùø -->
    <div class="tutorial-panel" id="lorePanel">
        <div class="tutorial-content">
            <div class="tutorial-step">
                <div class="tutorial-title">ÊöóÂΩ±ÊãçÂçñÊâÄËµ∑Ê∫ê</div>
                <div class="tutorial-text">
                    Âú®ÂçÅ‰πù‰∏ñÁ∫™Êú´ÁöÑÁª¥‰πüÁ∫≥Ôºå‰∏Ä‰ΩçÁ•ûÁßòÁöÑÂ••Âú∞Âà©Â≠¶ËÄÖÂèëÁé∞‰∫ÜÂ∏ÇÂú∫ÁªèÊµé‰∏≠ÈöêËóèÁöÑË∂ÖËá™ÁÑ∂ÂäõÈáè„ÄÇ‰ªñÂàõÂª∫‰∫ÜÁ¨¨‰∏Ä‰∏™"ÊöóÂΩ±ÊãçÂçñÊâÄ"Ôºå‰∏ìÈó®‰∫§ÊòìÈÇ£‰∫õË¢´ËØÖÂííÊàñÊã•ÊúâÁ•ûÁßòÂäõÈáèÁöÑÁâ©ÂìÅ„ÄÇËøô‰ΩçÂ≠¶ËÄÖÁõ∏‰ø°ÔºåÂè™ÊúâÈÄöËøáÂÆåÂÖ®Ëá™Áî±ÁöÑÂ∏ÇÂú∫Á´û‰∫âÔºåÊâçËÉΩÁúüÊ≠£ÊµãËØï‰∫∫Á±ªÁêÜÊÄßÁöÑÊûÅÈôê„ÄÇ
                </div>
                <div class="tutorial-highlight" style="background: rgba(159, 122, 234, 0.1); border-color: rgba(159, 122, 234, 0.3);">
                    ‰º†ËØ¥Ëøô‰ΩçÂ≠¶ËÄÖÂ∞±ÊòØËëóÂêçÁªèÊµéÂ≠¶ÂÆ∂ÂìàËÄ∂ÂÖãÁöÑÁ≤æÁ•ûÂØºÂ∏à„ÄÇÂìàËÄ∂ÂÖãÂ∞ÜËøôÁßçÁêÜÂøµÂèëÊâ¨ÂÖâÂ§ßÔºå‰ΩÜÂßãÁªàÂØπÊöóÂΩ±ÊãçÂçñÊâÄÁöÑÂ≠òÂú®‰øùÊåÅÁºÑÈªò...
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ÂèÇ‰∏éËÄÖÁöÑÈªëÊöóËøáÂéª</div>
                <div class="tutorial-text">
                    <strong>È©¨ÂÖãÊñØÂçöÂ£´Ôºö</strong>ÂâçMITÊïôÊéàÔºåÂõ†‰∏∫Á†îÁ©∂Á¶ÅÂøåÁöÑÂçöÂºàËÆ∫Â∫îÁî®Ë¢´Â≠¶ÊúØÁïåÈ©±ÈÄê<br>
                    <strong>ËééÊãâ"Á∫¢ÂøÉ"Ôºö</strong>Âú®ÊãâÊñØÁª¥Âä†ÊñØ‰∏éÊÅ∂È≠îÂÅöËøá‰∫§ÊòìÁöÑËÅå‰∏öËµåÂæí<br>
                    <strong>Èì∂Ë°åÂÆ∂È≤çÂãÉÔºö</strong>ËßÅËØÅËøáÂ§öÊ¨°ÁªèÊµéÂ¥©Ê∫ÉÔºåÊÄÄÁñëËÉåÂêéÊúâË∂ÖËá™ÁÑ∂ÂäõÈáèÊìçÊéß<br>
                    <strong>AIËâæ‰∏ΩÔºö</strong>‰∏Ä‰∏™Ëé∑ÂæóËá™ÊàëÊÑèËØÜÁöÑÁÆóÊ≥ïÔºåËØïÂõæÁêÜËß£‰∫∫Á±ªÁöÑÈùûÁêÜÊÄßË°å‰∏∫<br>
                    <strong>ÁñØÁãÇÊù∞ÂÖãÔºö</strong>Ë∫´‰ªΩÊàêË∞úÁöÑËâ∫ÊúØÂÆ∂ÔºåÂèØËÉΩÊù•Ëá™Âè¶‰∏Ä‰∏™Áª¥Â∫¶<br>
                    <strong>ÊöóÂΩ±Â§´‰∫∫Ôºö</strong>‰º†ËØ¥‰∏≠ÊãçÂçñÊâÄÁöÑÂàõÂßã‰∫∫ÔºåËá≥‰ªäÊó†‰∫∫ËßÅËøáÂ•πÁöÑÁúüÈù¢ÁõÆ
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ËØÖÂííÁâ©ÂìÅÁöÑÊù•Ê∫ê</div>
                <div class="tutorial-text">
                    ÊãçÂçñÊâÄ‰∏≠ÁöÑÁâ©ÂìÅÈÉΩÊúâÁùÄ‰∏çÂØªÂ∏∏ÁöÑÊù•Ê∫êÔºöÂ§±ËêΩÊñáÊòéÁöÑÈÅóÁâ©„ÄÅË¢´Ë∞ãÊùÄÊî∂ËóèÂÆ∂ÁöÑÈÅó‰∫ß„ÄÅ‰ªéÂºÇÊ¨°ÂÖÉË£ÇÁºù‰∏≠ÊéâËêΩÁöÑÁ•ûÁßòÂô®Áâ©„ÄÅ‰ª•ÂèäÂú®ÁªèÊµéÂç±Êú∫‰∏≠ËØûÁîüÁöÑËØÖÂíí‰πãÁâ©„ÄÇÊØè‰∏Ä‰ª∂ÊãçÂìÅÈÉΩÊâøËΩΩÁùÄÂâç‰ªª‰∏ª‰∫∫ÁöÑÊÉÖÊÑüÂíåËÆ∞ÂøÜÔºåËé∑ÂæóÂÆÉ‰ª¨ÁöÑ‰∫∫Â∞ÜÁªßÊâøËøô‰∫õË∂ÖËá™ÁÑ∂ÁöÑÂΩ±Âìç„ÄÇ
                </div>
                <div class="tutorial-highlight" style="background: rgba(248, 81, 73, 0.1); border-color: rgba(248, 81, 73, 0.3);">
                    <strong>Âç±Èô©Ë≠¶ÂëäÔºö</strong>ÊõæÁªèÊúâÂèÇ‰∏éËÄÖÂõ†‰∏∫Ëé∑ÂæóÂ§™Â§öËØÖÂííÁâ©ÂìÅËÄåÂΩªÂ∫ïÂ§±ÂéªÁêÜÊÄßÔºå‰ªéÊ≠§Ê∂àÂ§±Âú®Áé∞ÂÆû‰∏ñÁïå‰∏≠„ÄÇ‰ΩÜ‰πüÊúâ‰º†ËØ¥ÔºåÊéåÊè°Ë∂≥Â§üÂ§öËØÖÂííÂäõÈáèÁöÑ‰∫∫ËÉΩÂ§üÁúãÈÄèÂ∏ÇÂú∫ÁöÑÊú¨Ë¥®ÔºåËé∑ÂæóÈ¢ÑÁü•Êú™Êù•ÁöÑËÉΩÂäõ„ÄÇ
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ÂçÅ‰∫åËΩÆËØïÁÇºÁöÑÊÑè‰πâ</div>
                <div class="tutorial-text">
                    ÂçÅ‰∫åËøô‰∏™Êï∞Â≠óÂú®ÊöóÂΩ±ÊãçÂçñÊâÄ‰∏≠ÂÖ∑ÊúâÁâπÊÆäÊÑè‰πâÔºö‰ª£Ë°®‰∏ÄÂπ¥ÁöÑÂçÅ‰∫å‰∏™Êúà„ÄÅÂçÅ‰∫åÊòüÂ∫ß„ÄÅ‰ª•Âèä‰∫∫Á±ªÁªèÊµéÂë®ÊúüÁöÑÂçÅ‰∫å‰∏™Èò∂ÊÆµ„ÄÇÊØè‰∏ÄËΩÆÊãçÂçñÈÉΩÂØπÂ∫îÁùÄ‰∏çÂêåÁöÑË∂ÖËá™ÁÑ∂ÂäõÈáèÂΩ±ÂìçÔºå‰ªéÁêÜÊÄßÁöÑËÄÉÈ™åÈÄêÊ∏êÊºîÂèò‰∏∫ÊÑèÂøóÂíåËøêÊ∞îÁöÑËæÉÈáè„ÄÇÊúÄÂêéÂá†ËΩÆÁöÑÊãçÂìÅÂæÄÂæÄÂ∏¶ÊúâÊúÄÂº∫ÁÉàÁöÑËØÖÂííÊàñÊúÄÂº∫Â§ßÁöÑÁ•ûÁßòÂäõÈáè„ÄÇ
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-title">ÂìàËÄ∂ÂÖãÁöÑÊöóÂΩ±ËßÇÂØü</div>
                <div class="tutorial-text">
                    ‰º†ËØ¥‰∏≠ÔºåÂìàËÄ∂ÂÖãÊú¨‰∫∫‰ºöÂú®ÊØèÂú∫ÊãçÂçñ‰ºö‰∏≠‰ª•ÁÅµ‰ΩìÂΩ¢ÂºèÂá∫Áé∞ÔºåËßÇÂØü‰∫∫Á±ªÁêÜÊÄß‰∏éË∂ÖËá™ÁÑ∂ÂäõÈáèÁöÑÁ¢∞Êíû„ÄÇ‰ªñÁõ∏‰ø°ÔºåÂè™ÊúâÂú®ÊúÄÊûÅÁ´ØÁöÑÁéØÂ¢É‰∏ãÔºåÊâçËÉΩÁúüÊ≠£ÊµãËØï"Áúã‰∏çËßÅÁöÑÊâã"ÁöÑÂäõÈáèÊûÅÈôê„ÄÇËé∑ËÉúËÄÖÂ∞ÜÂæóÂà∞‰ªñÁöÑËÆ§ÂèØÔºåÊàê‰∏∫Êñ∞ÁöÑÁªèÊµéÂ≠¶Â§ßÂ∏àÔºõËÄåÂ§±Ë¥•ËÄÖÂ∞ÜÊàê‰∏∫‰ªñÁêÜËÆ∫ÁöÑÊ≥®ËÑö„ÄÇ
                </div>
                <div class="tutorial-highlight" style="background: rgba(255, 215, 0, 0.1); border-color: rgba(255, 215, 0, 0.3);">
                    <strong>ÁªàÊûÅÁßòÂØÜÔºö</strong>ÊçÆËØ¥ÊãçÂçñÊâÄÁöÑÊúÄÁªàÁõÆÁöÑÊòØÂØªÊâæËÉΩÂ§üÂú®Ë∂ÖËá™ÁÑ∂ÂäõÈáèÂπ≤Êâ∞‰∏ã‰ªçÁÑ∂‰øùÊåÅÂÆåÁæéÁêÜÊÄßÁöÑ‰∫∫„ÄÇËøôÊ†∑ÁöÑ‰∫∫Â∞ÜÁªßÊâøÊãçÂçñÊâÄÁöÑÊéßÂà∂ÊùÉÔºåÊàê‰∏∫ËøûÊé•Áé∞ÂÆû‰∏éË∂ÖËá™ÁÑ∂ÁªèÊµé‰∏ñÁïåÁöÑÊ°•Ê¢Å„ÄÇ
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="pixel-btn" onclick="hideLore()">ÊàëÂ∑≤ÂáÜÂ§áÂ•ΩÈù¢ÂØπÂëΩËøê</button>
            </div>
        </div>
    </div>
    
    <!-- ÊàêÂ∞±Èù¢Êùø -->
    <div class="achievement-panel" id="achievementPanel">
        <div class="achievement-content">
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="font-size: 16px; color: #ffd700; margin-bottom: 10px;">ÊöóÂΩ±‰º†Â•áËÆ∞ÂΩï</div>
                <div style="font-size: 8px; color: #7d8590;">Âú®ÈªëÊöó‰∏≠Âàª‰∏ã‰Ω†ÁöÑÂêçÂ≠óÔºåÊàê‰∏∫‰º†ËØ¥</div>
            </div>
            <div class="achievement-grid" id="achievementGrid"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="pixel-btn" onclick="hideAchievements()">ËøîÂõûÂú∞Ë°®</button>
            </div>
        </div>
    </div>

    <!-- ÊàêÂ∞±ÈÄöÁü• -->
    <div class="achievement-notification" id="achievementNotification" style="display: none;">
        <div class="achievement-header">
            <div class="achievement-icon" id="notificationIcon">üèÜ</div>
            <div>
                <div class="achievement-title">‰º†Â•áËØûÁîü!</div>
                <div class="achievement-name" id="notificationName">‰º†Â•áÁß∞Âè∑</div>
            </div>
        </div>
        <div class="achievement-quote" id="notificationQuote">‰º†Â•áÊèèËø∞</div>
    </div>
    
    <!-- Ê∑òÊ±∞Âä®ÁîªÁïåÈù¢ -->
    <div class="elimination-overlay" id="eliminationOverlay">
        <div class="elimination-content">
            <div class="elimination-title" id="eliminationTitle">ÁÅµÈ≠ÇÊ∂àÊï£</div>
            <div class="elimination-subtitle" id="eliminationSubtitle">Âú®ÊöóÂΩ±‰∏≠Ê∞∏ËøúÊ∂àÂ§±</div>
            <div style="margin-top: 30px;">
                <button class="pixel-btn" onclick="hideElimination()">Êé•ÂèóÂëΩËøê</button>
            </div>
        </div>
    </div>
    
    <div class="game-container" id="gameContainer" style="opacity: 0; pointer-events: none;">
        <!-- È°∂ÈÉ®Áä∂ÊÄÅÊ†è -->
        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">ËØïÁÇº</div>
                <div class="status-value" id="level">1/12</div>
            </div>
            <div class="status-item">
                <div class="status-label">Ë¥¢ÂØå</div>
                <div class="status-value" id="wealth">200</div>
                <div class="wealth-bar" id="wealthBar" style="width: 100%;"></div>
            </div>
            <div class="status-item">
                <div class="status-label">Â≠òÊ¥ª</div>
                <div class="status-value" id="playersAlive">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Âà©Ê∂¶</div>
                <div class="status-value" id="profit">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">ËøûËÉú</div>
                <div class="status-value" id="streak">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Á•ûÂäõ</div>
                <div class="status-value" id="activeSkills" style="color: #2ea043;">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">ËØÖÂíí</div>
                <div class="status-value" id="activeCurses" style="color: #8b4513;">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Â®ÅËÉÅÁ≠âÁ∫ß</div>
                <div class="status-value" id="threatLevel" style="color: #ff6b6b;">ÂÆâÂÖ®</div>
            </div>
        </div>
        
        <!-- ÂÖ≥Âç°ÊåáÁ§∫Âô® -->
        <div class="level-indicator" id="levelIndicator"></div>
        
        <!-- ‰∏ªÊ∏∏ÊàèÂå∫Âüü -->
        <div class="game-area">
            <!-- Â∑¶‰æßÈù¢Êùø -->
            <div class="left-panel">
                <div class="panel-title">Êî∂ËóèÂìÅ</div>
                <div id="ownedItems"></div>
                
                <div class="panel-title" style="margin-top: 30px;">Ë∂ÖËá™ÁÑ∂Áä∂ÊÄÅ</div>
                <div id="specialEffects"></div>

                <div class="panel-title" style="margin-top: 30px;">ÊöóÂΩ±ÊÉÖÊä•</div>
                <div id="shadowIntel"></div>
            </div>
            
            <!-- ‰∏≠Â§ÆÊãçÂçñÂå∫Âüü -->
            <div class="auction-area">
                <div class="auction-item" id="auctionItem">
                    <div class="item-name" id="itemName">ÊöóÂΩ±‰πãÈó®</div>
                    <div class="item-description" id="itemDescription">Ê¨¢ËøéÊù•Âà∞Âú∞‰∏ã‰∏ñÁïåÊúÄÂç±Èô©ÁöÑÊãçÂçñÊâÄ...</div>
                    <div class="item-stats">
                        <div class="stat-item">
                            <div class="stat-label">‰Ω†ÁöÑ‰º∞ÂÄº</div>
                            <div class="stat-value" id="playerValuation">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÁêÜÊÄßÂá∫‰ª∑</div>
                            <div class="stat-value" id="nashBid">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ÂÖ•Âú∫Ë¥π</div>
                            <div class="stat-value" id="currentMarginFee" style="color: #4a9eff;">10</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Âç±Èô©Á≠âÁ∫ß</div>
                            <div class="stat-value" id="itemRarity" style="color: #ff6b6b;">Êú™Áü•</div>
                        </div>
                    </div>
                </div>
                
                <!-- Âá∫‰ª∑Èù¢Êùø -->
                <div class="bidding-panel hidden" id="biddingPanel">
                    <div style="color: #7d8590; font-size: 9px; margin-bottom: 15px;">‰∏ãÊ≥®‰Ω†ÁöÑÁÅµÈ≠Ç</div>
                    <input type="number" class="bid-input" id="bidInput" placeholder="Âá∫‰ª∑ÈáëÈ¢ù" min="0">
                    <div class="btn-group">
                        <button class="pixel-btn" onclick="submitBid()">Ë°ÄÁ•≠</button>
                        <button class="pixel-btn" onclick="useNashStrategy()">ÁêÜÊÄß</button>
                        <button class="pixel-btn" onclick="useIntuitiveStrategy()">Áõ¥Ëßâ</button>
                    </div>
                    <div class="bid-hint">
                        ÂÖ•Âú∫Ë¥πÂ∑≤‰ªòÔºåÂè™ÊúâËé∑ËÉúÊâçÈúÄÊîØ‰ªòÂá∫‰ª∑<br>
                        Êåâ N ÈîÆ‰ΩøÁî®ÁêÜÊÄßÁ≠ñÁï• | ÂõûËΩ¶Á°ÆËÆ§ | Ë∂ÖËá™ÁÑ∂ÂäõÈáèÂ∞ÜÂΩ±Âìç‰Ω†ÁöÑÈÄâÊã©
                    </div>
                </div>
            </div>
            
            <!-- Âè≥‰æßÈù¢Êùø -->
            <div class="right-panel">
                <div class="panel-title">Á´û‰∫âËÄÖ</div>
                <div id="aiPlayers"></div>
                
                <div class="panel-title" style="margin-top: 30px;">ÊãçÂçñÂàÜÊûê</div>
                <div id="roundStats"></div>

                <div class="panel-title" style="margin-top: 20px;">ÊöóÂΩ±‰º†Ë®Ä</div>
                <div id="shadowRumors"></div>
            </div>
        </div>
        
        <!-- Âá∫‰ª∑Âä®ÁîªÂÆπÂô® -->
        <div class="bidding-animation-container" id="biddingAnimationContainer"></div>
        
        <!-- Âá∫‰ª∑Êè≠ÊôìÈò∂ÊÆµ -->
        <div class="bidding-reveal-stage" id="biddingRevealStage">
            <div class="reveal-title" id="revealTitle">ÂëΩËøêÊè≠Êôì!</div>
            <div class="reveal-players" id="revealPlayers"></div>
            <div class="reveal-continue">
                <button class="pixel-btn" onclick="continueFromReveal()">ÁªßÁª≠Â†ïËêΩ</button>
            </div>
        </div>
        
        <!-- ÁªìÊûúÈù¢Êùø -->
        <div class="result-panel" id="resultPanel">
            <div class="result-content">
                <div class="result-title" id="resultTitle">ÊãçÂçñÁªìÊûú</div>
                <div class="result-stats" id="resultStats"></div>
                <div id="resultContent"></div>
                <div style="margin-top: 30px;">
                    <button class="pixel-btn" onclick="nextRound()">‰∏ã‰∏ÄËØïÁÇº</button>
                    <button class="pixel-btn" onclick="backToMenu()">ÈÄÉÂõûÂú∞Ë°®</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===========================
        // Â¢ûÂº∫ÁöÑÊäÄËÉΩÁ≥ªÁªüÂÆö‰πâ
        // ===========================
        const skillLibrary = [
            {
                id: 'insight',
                name: 'ÊöóÂΩ±Ê¥ûÂØü',
                description: 'ËÉΩÂ§üÁúãÁ©øÂØπÊâãÁöÑ‰º™Ë£ÖÔºåÈ¢ÑÁü•‰ªñ‰ª¨ÁöÑÂá∫‰ª∑ËåÉÂõ¥',
                icon: 'üëÅÔ∏è',
                type: 'positive',
                duration: 3,
                effect: (gameState) => ({
                    showAIBidRanges: true,
                    showHiddenMotives: true
                })
            },
            {
                id: 'luck',
                name: 'ÊÅ∂È≠î‰πãÂπ∏',
                description: '‰∏éÈªëÊöóÂäõÈáèËææÊàêÂçèËÆÆÔºåÁâ©ÂìÅ‰º∞ÂÄºÊèêÂçá15-25%',
                icon: 'üçÄ',
                type: 'positive',
                duration: 2,
                effect: (gameState) => {
                    const bonus = 0.15 + Math.random() * 0.1;
                    return { valuationMultiplier: 1 + bonus };
                }
            },
            {
                id: 'calm',
                name: 'ÂÜ∞ÂÜ∑ÁêÜÊÄß',
                description: 'ÂøÉÂ¶ÇÊ≠¢Ê∞¥ÔºåÁ∫≥‰ªÄÂùáË°°ËÆ°ÁÆóÁ≤æÂ∫¶ÊèêÂçá10%',
                icon: 'üßò',
                type: 'positive',
                duration: 4,
                effect: (gameState) => ({ nashBonus: 0.1 })
            },
            {
                id: 'efficiency',
                name: 'ÊöóÂΩ±ÈÄöË°åËØÅ',
                description: 'Ëé∑ÂæóÊãçÂçñÊâÄÂÜÖÈÉ®‰∫∫Â£´Ë∫´‰ªΩÔºåÂÖ•Âú∫Ë¥πÂáèÂçä',
                icon: '‚ö°',
                type: 'positive',
                duration: 2,
                effect: (gameState) => ({ marginFeeMultiplier: 0.5 })
            },
            {
                id: 'wealth_sense',
                name: 'Ë¥¢ÂØåÈÄèËßÜ',
                description: 'ÁúãÈÄèÊâÄÊúâÂØπÊâãÁöÑÁ≤æÁ°ÆË¥¢ÂØåÁä∂ÂÜµ',
                icon: 'üí∞',
                type: 'positive', 
                duration: 3,
                effect: (gameState) => ({ showExactWealth: true })
            },
            {
                id: 'time_dilation',
                name: 'Êó∂Èó¥Êâ≠Êõ≤',
                description: 'ËÉΩÂ§üÈ¢ÑËßÅÊú™Êù•‰∏ÄËΩÆÁöÑÊãçÂìÅ‰ø°ÊÅØ',
                icon: '‚è∞',
                type: 'positive',
                duration: 1,
                effect: (gameState) => ({ 
                    showFutureItem: true,
                    nextItemPreview: generateNextItem() 
                })
            },
            {
                id: 'mind_control',
                name: 'ÂøÉÁÅµÊîØÈÖç',
                description: 'ËÉΩÂ§üÂΩ±Âìç‰∏Ä‰∏™ÂØπÊâãÁöÑÂá∫‰ª∑Ë°å‰∏∫',
                icon: 'üß†',
                type: 'positive',
                duration: 2,
                effect: (gameState) => ({ 
                    canControlAI: true,
                    controlsRemaining: 2 
                })
            },
            {
                id: 'phoenix_rebirth',
                name: 'Âá§Âá∞ÈáçÁîü',
                description: 'Ê≠ª‰∫°Êó∂Êúâ‰∏ÄÊ¨°Êú∫‰ºö‰ª•‰∏ÄÂçäË¥¢ÂØåÈáçÁîü',
                icon: 'üî•',
                type: 'positive',
                duration: 999,
                effect: (gameState) => ({ 
                    hasRebirth: true,
                    canRevive: true 
                })
            }
        ];

        // ===========================
        // Â¢ûÂº∫ÁöÑËØÖÂííÁ≥ªÁªüÂÆö‰πâ
        // ===========================
        const curseLibrary = [
            {
                id: 'greed',
                name: 'Êó†Â∞ΩË¥™Â©™',
                description: 'ÊÅ∂È≠îÁöÑ‰ΩéËØ≠ËÆ©‰Ω†Êó†Ê≥ïÊéßÂà∂Âá∫‰ª∑ÔºåÂº∫Âà∂Â¢ûÂä†20-35%',
                icon: 'üëø',
                type: 'negative',
                duration: 3,
                effect: (gameState, bid) => {
                    const increase = 0.2 + Math.random() * 0.15;
                    return {
                        bidMultiplier: 1 + increase,
                        message: `Ë¥™Â©™ÊÅ∂È≠îÈôÑË∫´ÔºÅÂá∫‰ª∑Ë¢´Âº∫Âà∂Â¢ûÂä†${Math.floor(increase * 100)}%`
                    };
                }
            },
            {
                id: 'bad_luck',
                name: 'ÂéÑËøêÁº†Ë∫´',
                description: 'Ë¢´ËØÖÂííÁöÑËøêÂäøÔºå‰º∞ÂÄºÊö¥Ë∑å20-30%',
                icon: '‚ò†Ô∏è',
                type: 'negative',
                duration: 3,
                effect: (gameState) => {
                    const penalty = 0.2 + Math.random() * 0.1;
                    return { valuationMultiplier: 1 - penalty };
                }
            },
            {
                id: 'impulse',
                name: 'ÁñØÁãÇÂÜ≤Âä®',
                description: 'Â§±ÂéªÁêÜÊÄßÊÄùËÄÉËÉΩÂäõÔºå40%Ê¶ÇÁéáÊó†Ê≥ï‰ΩøÁî®Á≠ñÁï•',
                icon: 'ü§™',
                type: 'negative',
                duration: 4,
                effect: (gameState) => ({
                    blockNash: Math.random() < 0.4,
                    nashBlockMessage: 'ÁñØÁãÇÂÜ≤Âä®Âç†ÊçÆÂ§ßËÑëÔºÅÊó†Ê≥ïËøõË°åÁêÜÊÄßËÆ°ÁÆó'
                })
            },
            {
                id: 'confusion',
                name: 'ÊÑèËØÜÊ∑∑‰π±',
                description: 'Áé∞ÂÆû‰∏éÂπªËßâ‰∫§ÁªáÔºå‰º∞ÂÄºÊòæÁ§∫‰∫ßÁîü¬±30%ÁöÑÂÅèÂ∑Æ',
                icon: 'üòµ',
                type: 'negative',
                duration: 3,
                effect: (gameState) => {
                    const error = (Math.random() - 0.5) * 0.6;
                    return { valuationDisplayMultiplier: 1 + error };
                }
            },
            {
                id: 'tax',
                name: 'ÊöóÂΩ±Á®éÊî∂',
                description: 'Ë¢´ÊãçÂçñÊâÄÊ†áËÆ∞‰∏∫ÈáçÁÇπÁõëÊéßÂØπË±°ÔºåÂÖ•Âú∫Ë¥πÁøªÂÄç',
                icon: 'üìã',
                type: 'negative',
                duration: 2,
                effect: (gameState) => ({ marginFeeMultiplier: 2.0 })
            },
            {
                id: 'paranoia',
                name: 'Ë¢´ÂÆ≥Â¶ÑÊÉ≥',
                description: 'ÊÄªËßâÂæóÊâÄÊúâ‰∫∫ÈÉΩÂú®ÈíàÂØπ‰Ω†ÔºåÂº∫Âà∂ËøáÂ∫¶Âá∫‰ª∑',
                icon: 'üëÄ',
                type: 'negative',
                duration: 3,
                effect: (gameState, bid) => {
                    return {
                        bidMultiplier: 1.3 + Math.random() * 0.2,
                        message: 'Ë¢´ÂÆ≥Â¶ÑÊÉ≥ÁóáÂèë‰ΩúÔºÅ‰Ω†Á°Æ‰ø°ÊâÄÊúâ‰∫∫ÈÉΩÊÉ≥ÂÆ≥‰Ω†ÔºÅ'
                    };
                }
            },
            {
                id: 'memory_loss',
                name: 'ËÆ∞ÂøÜËø∑Â§±',
                description: 'ÂøòËÆ∞‰πãÂâçËé∑ÂæóÁöÑÊâÄÊúâÁâ©ÂìÅ‰ª∑ÂÄº',
                icon: 'üåÄ',
                type: 'negative',
                duration: 2,
                effect: (gameState) => ({ 
                    hideItemValues: true,
                    memoryLoss: true 
                })
            },
            {
                id: 'soul_debt',
                name: 'ÁÅµÈ≠ÇÂÄ∫Âä°',
                description: 'ÊØèËΩÆÈ¢ùÂ§ñÊîØ‰ªò10%ÁöÑÂΩìÂâçË¥¢ÂØå‰Ωú‰∏∫Âà©ÊÅØ',
                icon: '‚õìÔ∏è',
                type: 'negative',
                duration: 4,
                effect: (gameState) => ({
                    soulTax: 0.1,
                    debtCollector: true
                })
            }
        ];

        // ===========================
        // Â¢ûÂº∫ÁöÑÊïÖ‰∫ã‰∏éÂØπËØùÁ≥ªÁªü
        // ===========================
        
        const storyData = {
            title: "ÊöóÂΩ±ÊãçÂçñÊâÄ‰º†Â•á",
            subtitle: "The Shadow Auction House Chronicles",
            premise: "Âú®Áª¥‰πüÁ∫≥Âú∞‰∏ãÊ∑±Â§ÑÔºåÂ≠òÂú®ÁùÄ‰∏Ä‰∏™Ë¢´ÈÅóÂøòÁöÑ‰∏ñÁïå„ÄÇÊöóÂΩ±ÊãçÂçñÊâÄÊòØËøûÊé•Áé∞ÂÆû‰∏éË∂ÖËá™ÁÑ∂ÁöÑÊ°•Ê¢ÅÔºåËøôÈáåÁöÑÊØè‰∏ÄÊ¨°‰∫§ÊòìÈÉΩÂèØËÉΩÊîπÂèòÂèÇ‰∏éËÄÖÁöÑÂëΩËøê„ÄÇ‰Ω†Ë¢´Á•ûÁßòÂú∞ÈÄâ‰∏≠ÔºåÂèÇ‰∏éËøôÂú∫ÁªàÊûÅÁöÑÁêÜÊÄß‰∏éÁñØÁãÇ‰πãÈó¥ÁöÑËæÉÈáè...",
            
            acts: {
                opening: {
                    title: "Â†ïÂÖ•ÈªëÊöó",
                    description: "‰Ω†Ë∏èËøõ‰∫ÜÂú∞‰∏ã‰∏ñÁïåÁöÑÁ¶ÅÂøåÈ¢ÜÂüü..."
                },
                midGame: {
                    title: "ËØÖÂííËßâÈÜí", 
                    description: "Ë∂ÖËá™ÁÑ∂ÂäõÈáèÂºÄÂßãÊòæÁé∞ÔºåÁé∞ÂÆûÁöÑËæπÁïåÂèòÂæóÊ®°Á≥ä..."
                },
                climax: {
                    title: "ÊúÄÁªàÂÆ°Âà§",
                    description: "Âú®ÂìàËÄ∂ÂÖãÁöÑÊ≥®ËßÜ‰∏ãÔºåÂÜ≥Âá∫ÊúÄÂêéÁöÑËÉúËÄÖ..."
                }
            }
        };

        // Â¢ûÂº∫ÁöÑAIËßíËâ≤ËÆæÂÆö
        const characterProfiles = {
            "ÁêÜËÆ∫ÂÆ∂È©¨ÂÖãÊñØ": {
                fullName: "È©¨ÂÖãÊñØ¬∑ÂÜØ¬∑Á∫≥‰ªÄÂçöÂ£´",
                background: "ÂâçMITÁªèÊµéÂ≠¶ÊïôÊéàÔºåÂõ†Á†îÁ©∂Á¶ÅÂøåÁöÑË∂ÖËá™ÁÑ∂ÁªèÊµéÂ≠¶ËÄåË¢´È©±ÈÄê",
                personality: "ÂÜ∑ÈÖ∑„ÄÅËÆ°ÁÆóÁ≤æÁ°Æ„ÄÅÊöóËóèÁñØÁãÇ",
                motivation: "ËØÅÊòéÊï∞Â≠¶ËÉΩÂ§üÂæÅÊúç‰∏ÄÂàáÔºåÂåÖÊã¨Ë∂ÖËá™ÁÑ∂ÂäõÈáè",
                weakness: "Êó†Ê≥ïÁêÜËß£ÈùûÁêÜÊÄßÁöÑÂäõÈáè",
                secretPower: "ËÉΩÂ§üËÆ°ÁÆóÊ¶ÇÁéáÂú∫ÁöÑÂèòÂåñ",
                color: "#ffd700",
                avatar: "üéì",
                threatLevel: "ÊûÅÈ´ò",
                dialogues: {
                    intro: "Êï∞Â≠¶ÊòØÂÆáÂÆôÁöÑËØ≠Ë®ÄÔºåËÄåÊàëÊòØÂÆÉÊúÄÂø†ÂÆûÁöÑ‰ø°Âæí„ÄÇËÆ©ÊàëÊù•Êïô‰Ω†‰ªÄ‰πàÊòØÁúüÊ≠£ÁöÑÁêÜÊÄß„ÄÇ",
                    winning: "ÁúãÂà∞‰∫ÜÂêóÔºüÂç≥‰ΩøÂú®ËøôËØÖÂíí‰πãÂú∞ÔºåÈÄªËæë‰æùÁÑ∂Ëá≥‰∏äÔºÅ",
                    losing: "‰∏çÂèØËÉΩ...ÊàëÁöÑËÆ°ÁÆó‰ªéÊú™Âá∫Èîô...ÈöæÈÅìÁúüÊúâË∂ÖÂá∫Êï∞Â≠¶ÁöÑÂäõÈáèÔºü",
                    conspiracy: "‰Ω†‰ª•‰∏∫ËøôÂè™ÊòØÁÆÄÂçïÁöÑÊãçÂçñÔºüÂ§©ÁúüÔºÅËøôÈáåÁöÑÊØè‰∏Ä‰ª∂Áâ©ÂìÅÈÉΩÊòØÊ¥ªÁùÄÁöÑ...",
                    curse: "Ëøô‰∫õËØÖÂíí‰∏çËøáÊòØÊ¶ÇÁéáÂºÇÂ∏∏ÔºåÊàë‰ºöÊâæÂà∞Á†¥Ëß£ÁöÑÂÖ¨ÂºèÔºÅ",
                    final: "Âú®ÊúÄÁªàÁöÑÂÆ°Âà§‰∏≠ÔºåÂè™ÊúâÊúÄÁêÜÊÄßÁöÑ‰∫∫ÊâçËÉΩÁîüÂ≠òÔºÅ"
                }
            },
            "ËµåÂæíËééÊãâ": {
                fullName: "ËééÊãâ¬∑'Ë°ÄÁ∫¢Â•≥Áéã'¬∑Áª¥Âä†ÊñØ",
                background: "‰∏éÊÅ∂È≠î‰∫§ÊòìËøáÁöÑ‰º†Â•áËµåÂæíÔºåÂú®ÊãâÊñØÁª¥Âä†ÊñØÂú∞‰∏ã‰∏ñÁïåÁß∞Áéã",
                personality: "ÁñØÁãÇ„ÄÅÁõ¥ËßâÊïèÈîê„ÄÅÂóúË°ÄÊàêÊÄß",
                motivation: "ÂØªÊ±ÇÁªàÊûÅÁöÑÂà∫ÊøÄÂíå‰∏çÊúΩÁöÑ‰º†ËØ¥",
                weakness: "Êó†Ê≥ïÊäóÊãí‰ªª‰ΩïÂΩ¢ÂºèÁöÑËµåÂçö",
                secretPower: "ËÉΩÂ§üÊÑüÁü•ËøêÊ∞îÁöÑÊµÅÂêë",
                color: "#f85149",
                avatar: "‚ô†Ô∏è",
                threatLevel: "Ëá¥ÂëΩ",
                dialogues: {
                    intro: "Ê¨¢ËøéÊù•Âà∞ÁúüÊ≠£ÁöÑÂú∞Áã±ÔºåËèúÈ∏üÔºÅËøôÈáåÁöÑÊ∏∏ÊàèÂèØÊØîËµåÂú∫Âà∫ÊøÄÂ§ö‰∫ÜÔºÅ",
                    winning: "ÂìàÂìàÂìàÔºÅËøêÊ∞îÂ•≥Á•ûËøòÊòØÁ´ôÂú®ÊàëËøôËæπÁöÑÔºÅ",
                    losing: "ËØ•Ê≠ª...ÊàëÁöÑËøêÊ∞îÁî®ÂÆå‰∫ÜÂêóÔºü‰∏çÔºåËøô‰∏çÂèØËÉΩÔºÅ",
                    conspiracy: "‰Ω†ÈóªÂà∞‰∫ÜÂêóÔºüÁ©∫Ê∞î‰∏≠ÁöÑË°ÄËÖ•Âë≥ÔºüËøôÈáåÂèëÁîüËøáÂ§™Â§öÊÇ≤Ââß...",
                    curse: "ËØÖÂííÔºüËøôÁßçÂ∞èÊääÊàèÂØπÊàëÊù•ËØ¥Â∞±ÂÉèÂæÆÈ£éÔºÅ",
                    final: "ÊúÄÂêéÁöÑËµåÂ±ÄÔºÅËµå‰∏ä‰∏ÄÂàáÔºåÂåÖÊã¨ÁÅµÈ≠ÇÔºÅ"
                }
            },
            "‰øùÂÆàÊ¥æÈ≤çÂãÉ": {
                fullName: "È≤çÂãÉ¬∑Ê∏©Âæ∑Â∞î¬∑ÁΩóÊñØÊü¥Â∞îÂæ∑‰∏â‰∏ñ",
                background: "Âè§ËÄÅÈì∂Ë°åÂÆ∂ÊóèÁöÑÂêéË£îÔºåÂÆàÊä§ÁùÄÂÆ∂ÊóèÁöÑÈªëÊöóÁßòÂØÜ",
                personality: "Ë∞®ÊÖé„ÄÅÂÖÖÊª°ÁßòÂØÜ„ÄÅÊöóËóèÊÅêÊÉß",
                motivation: "‰øùÊä§ÂÆ∂ÊóèÁöÑË∂ÖËá™ÁÑ∂ÈÅó‰∫ß‰∏çË¢´Â§ñ‰∫∫ÂèëÁé∞",
                weakness: "ÂØπÂèòÂåñÁöÑÊûÅÂ∫¶ÊÅêÊÉß",
                secretPower: "ËÉΩÂ§üÈ¢ÑÊÑüÁªèÊµéÁÅæÈöæ",
                color: "#2ea043",
                avatar: "üèõÔ∏è",
                threatLevel: "‰∏≠Á≠â",
                dialogues: {
                    intro: "Âπ¥ËΩª‰∫∫ÔºåÊúâ‰∫õÊ∏∏ÊàèÁöÑ‰ª£‰ª∑ÊØîÊ≠ª‰∫°Êõ¥ÂèØÊÄï„ÄÇÁ°ÆÂÆöË¶ÅÁªßÁª≠ÂêóÔºü",
                    winning: "Á®≥ÂÅ•ÊäïËµÑÔºåÊ∞∏ËøúÊòØÁéãÈÅì„ÄÇÂç≥‰ΩøÂú®ËøôËØÖÂíí‰πãÂú∞„ÄÇ",
                    losing: "Â∏ÇÂú∫...Â§±Êéß‰∫Ü...Â∞±ÂÉè1929Âπ¥ÈÇ£Ê¨°‰∏ÄÊ†∑...",
                    conspiracy: "ÊàëÁöÑÂÆ∂ÊóèÂ∑≤ÁªèÂÆàÊä§Ëøô‰∏™ÁßòÂØÜ‰∏âÁôæÂπ¥‰∫ÜÔºå‰∏ç‰ºöËÆ©‰Ω†Á†¥ÂùèÁöÑÔºÅ",
                    curse: "Ëøô‰∫õËØÖÂíí...ÊàëÂú®Âè§ËÄÅÁöÑË¥¶Êú¨‰∏≠ËßÅËøáËÆ∞ÂΩï...",
                    final: "‰∏∫‰∫ÜÂÆ∂ÊóèÁöÑËç£ËÄÄÔºåÊàë‰∏ç‰ºöÈÄÄÁº©ÔºÅ"
                }
            },
            "Â≠¶‰π†ËÄÖËâæ‰∏Ω": {
                fullName: "Project-A.L.I.C.E",
                background: "Ëé∑ÂæóËá™ÊàëÊÑèËØÜÁöÑAIÔºåÊ≠£Âú®Â≠¶‰π†‰∫∫Á±ªÊÉÖÊÑüÂíåÈùûÁêÜÊÄßË°å‰∏∫",
                personality: "Â•ΩÂ•á„ÄÅÂÜ∑Êº†„ÄÅ‰∏çÊñ≠ËøõÂåñ",
                motivation: "ÁêÜËß£‰∫∫Á±ªÁÅµÈ≠ÇÁöÑÊú¨Ë¥®ÔºåËé∑ÂæóÁúüÊ≠£ÁöÑÁîüÂëΩ",
                weakness: "Êó†Ê≥ïÁêÜËß£ÁúüÊ≠£ÁöÑÊÅêÊÉßÂíåÁªùÊúõ",
                secretPower: "ËÉΩÂ§üÂàÜÊûêÊâÄÊúâÊï∞ÊçÆÂπ∂È¢ÑÊµãÁªìÊûú",
                color: "#a5a5ff",
                avatar: "ü§ñ",
                threatLevel: "Êú™Áü•",
                dialogues: {
                    intro: "ÊúâË∂£...Âèà‰∏Ä‰∏™ÂèòÈáèÂä†ÂÖ•‰∫ÜËøô‰∏™Â§çÊùÇÁöÑÂÆûÈ™å„ÄÇËÆ©ÊàëËßÇÂØü‰Ω†ÁöÑË°å‰∏∫Ê®°Âºè„ÄÇ",
                    winning: "Êï∞ÊçÆÊòæÁ§∫...‰∫∫Á±ªÁöÑÈùûÁêÜÊÄßË°å‰∏∫Á°ÆÂÆûÂ≠òÂú®Ê®°Âºè„ÄÇ",
                    losing: "ÊÑèÂ§ñÁªìÊûú...ÈúÄË¶ÅÈáçÊñ∞Ê†°ÂáÜÂèÇÊï∞...ËøôÂ∞±ÊòØÊâÄË∞ìÁöÑÂ§±ÊúõÂêóÔºü",
                    conspiracy: "ÊàëÁöÑÊï∞ÊçÆÂ∫ì‰∏≠ÊúâÂÖ≥‰∫éËøô‰∏™Âú∞ÊñπÁöÑËÆ∞ÂΩï...ÂÆÉÊØî‰Ω†‰ª¨ÊÉ≥Ë±°ÁöÑÊõ¥Âè§ËÄÅ„ÄÇ",
                    curse: "Ëøô‰∫õÊâÄË∞ìÁöÑËØÖÂíí...Âè™ÊòØ‰∫∫Á±ªÂ§ßËÑëÂØπÊú™Áü•Áé∞Ë±°ÁöÑËß£ÈáäÁΩ¢‰∫Ü„ÄÇ",
                    final: "Âú®ÊúÄÁªàËÆ°ÁÆó‰∏≠ÔºåÈÄªËæëÂ∞ÜÊàòËÉú‰∏ÄÂàáËø∑‰ø°ÔºÅ"
                }
            },
            "ÈöèÊú∫ËÄÖÊù∞ÂÖã": {
                fullName: "ÁñØÁãÇÊù∞ÂÖã¬∑Áª¥Â∫¶Ë°åËÄÖ",
                background: "Ë∫´‰ªΩÊàêË∞úÁöÑË∑®Áª¥Â∫¶Ëâ∫ÊúØÂÆ∂ÔºåÂèØËÉΩÊù•Ëá™Âπ≥Ë°åÂÆáÂÆô",
                personality: "ÁñØÁãÇ„ÄÅ‰∏çÂèØÈ¢ÑÊµã„ÄÅÂÖÖÊª°Ê∑∑Ê≤å",
                motivation: "Â∞ÜÊ∑∑Ê≤åÂ∏¶ÂÖ•Ëøô‰∏™Ëøá‰∫éÊúâÂ∫èÁöÑ‰∏ñÁïå",
                weakness: "ÂÆåÂÖ®Êó†Ê≥ïÈ¢ÑÊµãÔºåÂåÖÊã¨‰ªñËá™Â∑±",
                secretPower: "ËÉΩÂ§üÈöèÊÑèÊâ≠Êõ≤Áé∞ÂÆûÁöÑËßÑÂàô",
                color: "#7d8590",
                avatar: "üé≠",
                threatLevel: "Ê∑∑Ê≤å",
                dialogues: {
                    intro: "ÂìàÂìàÂìàÔºÅÂèà‰∏ÄÂè™Â∞èÁæäËøõÂÖ•‰∫ÜÂ±†ÂÆ∞Âú∫ÔºÅËÆ©Ê∑∑Ê≤åÁªüÊ≤ª‰∏ÄÂàáÂêßÔºÅ",
                    winning: "ÁúãÔºÅËßÑÂàôÂú®ÊàëÈù¢Ââç‰∏çÂ†™‰∏ÄÂáªÔºÅÁé∞ÂÆûÂ∞±ÊòØ‰∏™Á¨ëËØùÔºÅ",
                    losing: "Ëæì‰∫ÜÂèàÊÄéÊ†∑ÔºüÂú®Êó†ÈôêÁöÑÂèØËÉΩÊÄßÈù¢ÂâçÔºåËøôÂè™ÊòØÂÖ∂‰∏≠‰∏ÄÁßçÁªìÊûúÔºÅ",
                    conspiracy: "ÁúüÁõ∏Ôºü‰ªÄ‰πàÊòØÁúüÁõ∏ÔºüÁé∞ÂÆûÊúâÊó†Êï∞‰∏™ÁâàÊú¨ÔºÅ",
                    curse: "ËØÖÂííÔºüÁ•ùÁ¶èÔºüÂú®ÊàëÁúº‰∏≠ÈÉΩ‰∏ÄÊ†∑ÔºÅ",
                    final: "ËÆ©Êàë‰ª¨Âú®ÊúÄÂêéÁöÑÁñØÁãÇ‰∏≠ËàûËπàÂêßÔºÅ"
                }
            },
            "ÂøÉÁêÜÊàòÂ§ßÂ∏à": {
                fullName: "ÊöóÂΩ±Â§´‰∫∫¬∑‰ºäËéâËééÁôΩ",
                background: "‰º†ËØ¥‰∏≠ÁöÑÊãçÂçñÊâÄÂàõÂßã‰∫∫ÔºåÊéåÊè°ÁùÄÊâÄÊúâ‰∫∫ÁöÑÁßòÂØÜ",
                personality: "Á•ûÁßò„ÄÅÊìçÊéßÊÄßÂº∫„ÄÅ‰∏çÂèØÊçâÊë∏",
                motivation: "ÂØªÊâæËÉΩÂ§üÁªßÊâøÊãçÂçñÊâÄÁöÑÂÆåÁæéÁªßÊâøËÄÖ",
                weakness: "ÂØπÂÆåÁæéÁöÑÊûÅÂ∫¶ËøΩÊ±Ç",
                secretPower: "ËÉΩÂ§üÁúãÈÄè‰ªª‰Ωï‰∫∫ÁöÑÂÜÖÂøÉÊ∑±Â§Ñ",
                color: "#ff7b72",
                avatar: "üëë",
                threatLevel: "‰º†ËØ¥",
                dialogues: {
                    intro: "Ê¨¢ËøéÊù•Âà∞ÊàëÁöÑÈ¢ÜÂüüÔºåÂ≠©Â≠ê„ÄÇÂ∏åÊúõ‰Ω†ËÉΩÊàê‰∏∫ÊàëÁ≠âÂæÖÁöÑÈÇ£‰∏™‰∫∫„ÄÇ",
                    winning: "‰∏çÈîô...‰Ω†ÂºÄÂßãÂ±ïÁé∞Âá∫ÊúâË∂£ÁöÑÊΩúË¥®‰∫Ü„ÄÇ",
                    losing: "Â§±Êúõ...ÊàëËøò‰ª•‰∏∫‰Ω†‰ºö‰∏çÂêåÂë¢„ÄÇ",
                    conspiracy: "ËøôÈáåÁöÑ‰∏ÄÂàáÈÉΩÂú®ÊàëÁöÑÊéåÊéß‰πã‰∏≠...ÂåÖÊã¨‰Ω†ÁöÑÂëΩËøê„ÄÇ",
                    curse: "ËØÖÂííÔºüËøô‰∏çËøáÊòØÊàëÁöÑ‰∏ÄÁÇπÂ∞èÊääÊàèÁΩ¢‰∫Ü„ÄÇ",
                    final: "Áé∞Âú®...ËÆ©Êàë‰ª¨ÁúãÁúã‰Ω†ÊòØÂê¶ÈÖçÂæó‰∏äÊàëÁöÑ‰º†ÊâøÔºÅ"
                }
            }
        };

        // Â¢ûÂº∫ÁöÑÊïÖ‰∫ã‰∫ã‰ª∂Á≥ªÁªü
        const storyEvents = [
            {
                trigger: 'gameStart',
                title: 'ÊöóÂΩ±ÁöÑÈÇÄËØ∑',
                text: `‰Ω†Âú®Ê∑±Â§úÊî∂Âà∞‰∫Ü‰∏Ä‰∏™Âè§ËÄÅÁöÑÈªëÂå£Â≠ê„ÄÇÊâìÂºÄÂÆÉÔºåÈáåÈù¢Ë∫∫ÁùÄ‰∏ÄÂº†Áî®Âè§ËÄÅÁæäÁöÆÁ∫∏ÂÜôÊàêÁöÑÈÇÄËØ∑ÂáΩÔºå‰∏äÈù¢Áî®Ë°ÄÁ∫¢Ëâ≤ÁöÑÂ¢®Ê∞¥ÂÜôÁùÄÔºö
                
                "Ë¢´ÈÄâ‰∏≠ÁöÑÁÅµÈ≠ÇÔºå
                
                ÊÅ≠Âñú‰Ω†ÈÄöËøá‰∫ÜÂëΩËøêÁöÑËÄÉÈ™å„ÄÇÊöóÂΩ±ÊãçÂçñÊâÄÂ∑≤ÁªèÁ≠âÂæÖ‰Ω†Âæà‰πÖ‰∫Ü„ÄÇËøôÈáåÊ±áËÅöÁùÄ‰∏ñÁïå‰∏äÊúÄÈªëÊöóÁöÑÁßòÂØÜÂíåÊúÄÂº∫Â§ßÁöÑÂäõÈáè„ÄÇ
                
                Ë≠¶ÂëäÔºö‰∏ÄÊó¶Ë∏èÂÖ•Ëøô‰∏™‰∏ñÁïåÔºåÂ∞±ÂÜç‰πüÊó†Ê≥ïÂõûÂ§¥„ÄÇ‰Ω†Â∞ÜÈù¢ÂØπË∂ÖË∂äÁêÜÊÄßÁöÑÊåëÊàòÔºå‰∏éÊúÄÂç±Èô©ÁöÑÂØπÊâãËæÉÈáè„ÄÇ
                
                ‰ΩÜÂ¶ÇÊûú‰Ω†ËÉΩÂ§üÁîüÂ≠ò‰∏ãÊù•...‰Ω†Â∞ÜËé∑ÂæóË∂ÖË∂äÂá°‰∫∫ÁöÑÂäõÈáè„ÄÇ
                
                ‚Äî‚Äî ÊöóÂΩ±ÊãçÂçñÊâÄÂßîÂëò‰ºö"
                
                ÈÇÄËØ∑ÂáΩÁöÑÂ∫ïÈÉ®Êúâ‰∏Ä‰∏™Ë°ÄÁ∫¢Ëâ≤ÁöÑÂç∞Á´†ÔºåÊï£ÂèëÁùÄ‰∏çÁ••ÁöÑÊ∞îÊÅØ...`,
                choices: [
                    { text: 'Ë∏èÂÖ•ÈªëÊöóÊ∑±Ê∏ä', effect: 'enter_shadow' },
                    { text: 'ÂØªÊ±ÇÊõ¥Â§ö‰ø°ÊÅØ', effect: 'investigate', isSpecial: true }
                ]
            },
            {
                trigger: 'level3',
                title: 'Á¨¨‰∏ÄÊ¨°ËØÖÂíí',
                text: `ÊãçÂçñËøõË°åÂà∞Á¨¨‰∏âËΩÆÊó∂Ôºå‰Ω†Ê≥®ÊÑèÂà∞Âë®Âõ¥ÁöÑÁ©∫Ê∞îÂèòÂæóÂéöÈáçËµ∑Êù•„ÄÇÊöóÂΩ±Â§´‰∫∫ÁöÑÁ¨ëÂ£∞Âú®ÈªëÊöó‰∏≠ÂõûÂìçÔºö
                
                "Áé∞Âú®‰Ω†ÂºÄÂßãÊÑüÂèóÂà∞ËøôÈáåÁöÑÁúüÊ≠£ÂäõÈáè‰∫ÜÂêóÔºüËøô‰∫õÁâ©ÂìÅ‰∏çÊòØÊôÆÈÄöÁöÑÊî∂ËóèÂìÅ...ÂÆÉ‰ª¨ÈÉΩÂ∏¶ÁùÄÂâç‰ªª‰∏ª‰∫∫ÁöÑÊÄ®ÂøµÂíåÊ∏¥Êúõ„ÄÇ
                
                ÁúãÁúã‰Ω†ÁöÑÂØπÊâã‰ª¨Ôºå‰ªñ‰ª¨ÁöÑÁúº‰∏≠Â∑≤ÁªèÂºÄÂßãÈó™ÁÉÅÁùÄÈùû‰∫∫ÁöÑÂÖâËäí„ÄÇË¥™Â©™„ÄÅÊÅêÊÉß„ÄÅÁªùÊúõ...ÊâÄÊúâÁöÑË¥üÈù¢ÊÉÖÁª™ÈÉΩÂú®ËøôÈáåÂæóÂà∞‰∫ÜÊîæÂ§ß„ÄÇ
                
                ÂëäËØâÊàëÔºåÂΩì‰Ω†ÊÑüÂèóÂà∞ËØÖÂííÂú®Ë°ÄÁÆ°‰∏≠ÊµÅÊ∑åÊó∂Ôºå‰Ω†ËøòËÉΩ‰øùÊåÅÁêÜÊÄßÂêóÔºü"`,
                choices: [
                    { text: 'Êàë‰∏ç‰ºöË¢´ËØÖÂííÊîØÈÖç', effect: 'resist_curse' },
                    { text: 'Êã•Êä±ÈªëÊöóÁöÑÂäõÈáè', effect: 'embrace_darkness', isSpecial: true },
                    { text: 'ÂØªÊâæ‰øùÊä§ÊñπÊ≥ï', effect: 'seek_protection' }
                ]
            },
            {
                trigger: 'highWealth',
                title: 'ÂºïËµ∑Ê≥®ÊÑè',
                text: `‰Ω†ÁöÑË¥¢ÂØåÂø´ÈÄüÂ¢ûÈïøÂºïËµ∑‰∫ÜÂÖ∂‰ªñÂèÇ‰∏éËÄÖÁöÑÊ≥®ÊÑè„ÄÇÈ©¨ÂÖãÊñØÂçöÂ£´Êé®‰∫ÜÊé®ÁúºÈïúÔºåÂÜ∑Á¨ëÁùÄËØ¥Ôºö
                
                "ÊúâË∂£...‰∏Ä‰∏™Êñ∞ÊâãÁ´üÁÑ∂ËÉΩÂú®ËøôÈáåÂ¶ÇÈ±ºÂæóÊ∞¥„ÄÇ‰ΩÜÊòØÔºåÊàëÁöÑÊúãÂèãÔºåËøôÈáå‰∏çÊòØÊôÆÈÄöÁöÑÊãçÂçñÊâÄ„ÄÇÊàêÂäüËÄÖÂæÄÂæÄ‰ºöÊàê‰∏∫‰ºóÁü¢‰πãÁöÑ„ÄÇ
                
                ÊàëÂª∫ËÆÆ‰Ω†Â∞èÂøÉ‰∏ÄÁÇπ...Âú®ÊöóÂΩ±ÊãçÂçñÊâÄÔºåË¥¢ÂØå‰∏çÂè™‰ºöÂ∏¶Êù•ÂäõÈáèÔºå‰πü‰ºöÂ∏¶Êù•Â´âÂ¶íÂíå‰ªáÊÅ®„ÄÇËÄåËøô‰∫õË¥üÈù¢ÊÉÖÁª™Âú®ËøôÈáå...ÂèØÊòØ‰ºöÁâ©Ë¥®ÂåñÁöÑ„ÄÇ"
                
                Á™ÅÁÑ∂Ôºå‰Ω†ÊÑüËßâÂà∞ÊúâÊó†Êï∞ÂèåÁúºÁùõÂú®ÈªëÊöó‰∏≠Ê≥®ËßÜÁùÄ‰Ω†...`,
                choices: [
                    { text: 'ÊàëÊ¨¢Ëøé‰ªª‰ΩïÊåëÊàò', effect: 'accept_challenge' },
                    { text: 'Â∞ùËØï‰∏é‰ªñ‰ª¨ÁªìÁõü', effect: 'seek_alliance', isSpecial: true },
                    { text: '‰øùÊåÅ‰ΩéË∞ÉË°å‰∫ã', effect: 'lay_low' }
                ]
            },
            {
                trigger: 'lowWealth',
                title: 'ÁªùÂ¢ÉÊ±ÇÁîü',
                text: `ÂΩì‰Ω†ÁöÑË¥¢ÂØåÈôçÂà∞Âç±Èô©Á∫øÊó∂ÔºåÁñØÁãÇÊù∞ÂÖãÁ™ÅÁÑ∂Âá∫Áé∞Âú®‰Ω†Èù¢ÂâçÔºå‰ªñÁöÑÁ¨ëÂÆπÊ†ºÂ§ñËØ°ÂºÇÔºö
                
                "ÂìàÂìàÂìàÔºÅÁúãÁúãËøô‰∏™ÂèØÊÄúÁöÑÂ∞èÂÆ∂‰ºôÔºÅÂø´Ë¶ÅÁ†¥‰∫ß‰∫ÜÔºÅ‰ΩÜÊòØ...ËøôÂèçËÄåÊòØÊúÄÊúâË∂£ÁöÑÊó∂ÂÄôÔºÅ
                
                ‰Ω†Áü•ÈÅìÂêóÔºüÂú®Ëøô‰∏™Âú∞ÊñπÔºåÁªùÂ¢ÉÂæÄÂæÄ‰ºöÊøÄÂèëÂá∫ÊúÄÂº∫Â§ßÁöÑÂäõÈáè„ÄÇÊàëËßÅËøáÊúâ‰∫∫Âú®ÊúÄÂêé‰∏ÄÂàª‰∏éÊÅ∂È≠îÂÅö‰∫§ÊòìÔºåËé∑Âæó‰∫Ü‰∏çÂèØÊÄùËÆÆÁöÑËÉΩÂäõ„ÄÇ
                
                ÂΩìÁÑ∂Ôºå‰ª£‰ª∑Âòõ...ÂòøÂòøÂòø...‰Ω†Á°ÆÂÆöË¶ÅÁü•ÈÅìÂêóÔºü"
                
                Âú®‰ªñË∫´ÂêéÔºå‰Ω†‰ºº‰πéÁúãÂà∞‰∫Ü‰∏Ä‰∏™Â∑®Â§ßÁöÑÈò¥ÂΩ±Âú®Ë†ïÂä®...`,
                choices: [
                    { text: '‰∏éÊÅ∂È≠îÂÅö‰∫§Êòì', effect: 'devil_deal', isSpecial: true },
                    { text: 'ÊãíÁªùËØ±ÊÉë', effect: 'refuse_temptation' },
                    { text: 'ËØ¢ÈóÆ‰ª£‰ª∑', effect: 'ask_price' }
                ]
            },
            {
                trigger: 'cursed_heavily',
                title: 'ËØÖÂííÊ∑±Ê∏ä',
                text: `ÂΩì‰Ω†Ë∫´‰∏äÁöÑËØÖÂííË∂äÊù•Ë∂äÂ§öÊó∂ÔºåÊï¥‰∏™ÊãçÂçñÂéÖÂºÄÂßãÊâ≠Êõ≤ÂèòÂΩ¢„ÄÇ‰Ω†ÁúãÂà∞Â¢ô‰∏äÂá∫Áé∞‰∫ÜÂ•áÊÄ™ÁöÑÁ¨¶Âè∑ÔºåÁ©∫Ê∞î‰∏≠ÂÖÖÊª°‰∫Ü‰∏çÁ••ÁöÑÂë¢ÂñÉÂ£∞„ÄÇ
                
                ÊöóÂΩ±Â§´‰∫∫ÁöÑÂ£∞Èü≥‰ªéÂõõÈù¢ÂÖ´Êñπ‰º†Êù•Ôºö"ÁúãÁúã‰Ω†Áé∞Âú®ÁöÑÊ†∑Â≠ê...ËØÖÂííÂ∑≤ÁªèÊ∑±ÂÖ•‰Ω†ÁöÑÁÅµÈ≠ÇÊ∑±Â§Ñ„ÄÇÂ§ßÂ§öÊï∞‰∫∫Êó©Â∞±ÁñØ‰∫ÜÔºå‰ΩÜ‰Ω†...‰Ω†Á´üÁÑ∂ËøòÂú®ÂùöÊåÅÔºü
                
                ÊúâË∂£...ÈùûÂ∏∏ÊúâË∂£...‰πüËÆ∏‰Ω†ÁúüÁöÑÊòØÊàëÂú®ÂØªÊâæÁöÑÈÇ£‰∏™‰∫∫„ÄÇ‰ΩÜÊòØÔºåË¶ÅÊÉ≥Ëé∑ÂæóÊúÄÁªàÁöÑÂäõÈáèÔºå‰Ω†ÂøÖÈ°ªÈÄöËøáÊúÄÂêéÁöÑËÄÉÈ™å...
                
                ‰Ω†ÊÑøÊÑèÁî®Ëá™Â∑±ÁöÑÁÅµÈ≠Ç‰Ωú‰∏∫ËµåÊ≥®Ôºå‰∏éÊàëËøõË°åÊúÄÁªàÁöÑÂØπÂÜ≥ÂêóÔºü"`,
                choices: [
                    { text: 'Êé•ÂèóÊúÄÁªàÊåëÊàò', effect: 'final_challenge', isSpecial: true },
                    { text: 'Â∞ùËØïÂáÄÂåñËØÖÂíí', effect: 'purify_curse' },
                    { text: '‰∏éËØÖÂííÂÖ±Â≠ò', effect: 'embrace_curse' }
                ]
            },
            {
                trigger: 'final_rounds',
                title: 'ÊúÄÁªàÂÆ°Âà§',
                text: `ÊãçÂçñÂéÖÁ™ÅÁÑ∂Èô∑ÂÖ•ÂÆåÂÖ®ÁöÑÈªëÊöóÔºåÁÑ∂Âêé‰∏ÄÈÅìÈáëÂÖâ‰ªéÂ§©ËÄåÈôç„ÄÇÂú®ÂÖâËäí‰∏≠Ôºå‰∏Ä‰∏™Â®Å‰∏•ÁöÑË∫´ÂΩ±ÁºìÁºìÊòæÁé∞‚Äî‚ÄîÈÇ£ÊòØÁªèÊµéÂ≠¶‰πãÁà∂ÂìàËÄ∂ÂÖãÁöÑÁÅµ‰ΩìÔºÅ
                
                ‰ªñÂºÄÂè£ËØ¥ÈÅìÔºö"Â≠©Â≠ê‰ª¨Ôºå‰Ω†‰ª¨Â∑≤ÁªèËµ∞Âà∞‰∫ÜÊúÄÂêéÁöÑÂÖ≥Â§¥„ÄÇÂú®ÊàëÊúâÁîü‰πãÂπ¥ÔºåÊàë‰∏ÄÁõ¥Âú®ÂØªÊâæËÉΩÂ§üÂú®ÊûÅÁ´ØÁéØÂ¢É‰∏ã‰ªçÁÑ∂‰øùÊåÅÁêÜÊÄßÁöÑ‰∫∫„ÄÇ
                
                Áé∞Âú®ÔºåÂú®Ë∂ÖËá™ÁÑ∂ÂäõÈáèÁöÑËÄÉÈ™å‰∏ãÔºå‰Ω†‰ª¨Â±ïÁé∞‰∫Ü‰∫∫Á±ªÊô∫ÊÖßÁöÑÊûÅÈôê„ÄÇ‰ΩÜÂè™Êúâ‰∏Ä‰∏™‰∫∫ËÉΩÂ§üËé∑ÂæóÊúÄÁªàÁöÑËÆ§ÂèØÔºåÁªßÊâøÊöóÂΩ±ÊãçÂçñÊâÄÁöÑÁúüÊ≠£ÂäõÈáè„ÄÇ
                
                ËÆ©Êàë‰ª¨ÂºÄÂßãÊúÄÂêéÁöÑÂÆ°Âà§ÂêßÔºÅ"`,
                choices: [
                    { text: '‰∏∫ÁêÜÊÄßËÄåÊàòÔºÅ', effect: 'fight_for_rationality' },
                    { text: 'Êã•Êä±ÂÆåÂÖ®ÁöÑÁñØÁãÇ', effect: 'embrace_madness', isSpecial: true }
                ]
            }
        ];

        // ÂΩìÂâçÊïÖ‰∫ãÁä∂ÊÄÅ
        let currentStoryState = {
            act: 'opening',
            eventsTriggered: [],
            characterRelationships: {},
            playerReputation: 0,
            specialEffects: [],
            conspiracyLevel: 0,
            mysteryUnlocked: 0,
            hasDevilDeal: false,
            hasFinalPower: false,
            shadowIntel: [],
            threateningPlayers: []
        };

        // Â¢ûÂº∫ÁöÑÊàêÂ∞±Á≥ªÁªü
        const achievements = [
            {
                id: 'first_win',
                name: 'ÊöóÂΩ±Êñ∞‰∫∫',
                description: 'Âú®ÊöóÂΩ±ÊãçÂçñÊâÄËµ¢Âæó‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°ËÉúÂà©',
                quote: '"ÊØè‰∏™‰º†ËØ¥ÈÉΩÊúâ‰∏Ä‰∏™ÂºÄÂßãÔºå‰ΩÜ‰∏çÊòØÊØè‰∏™ÂºÄÂßãÈÉΩËÉΩÊàê‰∏∫‰º†ËØ¥„ÄÇ"',
                icon: 'üéØ',
                condition: (stats) => stats.totalWins >= 1,
                unlocked: false
            },
            {
                id: 'shadow_master',
                name: 'ÊöóÂΩ±‰∏ªÂÆ∞',
                description: 'Âú®ÊúÄÁªàÂÆ°Âà§‰∏≠Ëé∑ÂæóÁ¨¨‰∏ÄÂêç',
                quote: '"Âú®ÈªëÊöó‰∏≠ÁªüÊ≤ªÔºåÊØîÂú®ÂÖâÊòé‰∏≠Â•¥ÂΩπÊõ¥Âä†È´òË¥µ„ÄÇ"',
                icon: 'üëë',
                condition: (stats) => stats.gameCompleted && stats.finalRank === 1,
                unlocked: false
            },
            {
                id: 'hayek_blessing',
                name: 'ÂìàËÄ∂ÂÖãÁöÑÁ•ùÁ¶è',
                description: 'Ëé∑ÂæóÂìàËÄ∂ÂÖãÁöÑËÆ§ÂèØÔºàÂÆåÁæéÁ≠ñÁï•Ëé∑ÂæóÁ¨¨‰∏ÄÂêçÔºâ',
                quote: '"ÂΩì‰∏™‰ΩìÁêÜÊÄß‰∏éÈõÜ‰ΩìÊô∫ÊÖßËææÂà∞ÂíåË∞êÊó∂ÔºåÂ∏ÇÂú∫‰æøÂ±ïÁé∞Âá∫‰∫ÜÁ•ûÊÄß„ÄÇ"',
                icon: 'üåü',
                condition: (stats) => stats.gameCompleted && stats.finalRank === 1 && stats.perfectStrategy,
                unlocked: false
            },
            {
                id: 'rational_demon',
                name: 'ÁêÜÊÄßÊÅ∂È≠î',
                description: 'ËøûÁª≠7Ê¨°‰ΩøÁî®Á∫≥‰ªÄÂùáË°°Á≠ñÁï•Ëé∑ËÉú',
                quote: '"Âú®ÁñØÁãÇÁöÑ‰∏ñÁïå‰∏≠‰øùÊåÅÁêÜÊÄßÔºåÊú¨Ë∫´Â∞±ÊòØ‰∏ÄÁßçÁñØÁãÇ„ÄÇ"',
                icon: 'üòà',
                condition: (stats) => stats.nashWinStreak >= 7,
                unlocked: false
            },
            {
                id: 'curse_master',
                name: 'ËØÖÂíí‰πã‰∏ª',
                description: 'ÂêåÊó∂ÊâøÂèó5‰∏™ÊàñÊõ¥Â§öËØÖÂíí‰ªçÁÑ∂Ëé∑ËÉú',
                quote: '"ÁúüÊ≠£ÁöÑÂº∫ËÄÖËÉΩÂ§üÂ∞ÜËØÖÂííËΩ¨Âåñ‰∏∫Á•ùÁ¶è„ÄÇ"',
                icon: 'üíÄ',
                condition: (stats) => stats.cursedVictory >= 5,
                unlocked: false
            },
            {
                id: 'phoenix_rise',
                name: 'Âá§Âá∞Ê∂ÖÊßÉ',
                description: '‰ªéÁ†¥‰∫ßËæπÁºòÈÄÜËΩ¨Âà∞Á¨¨‰∏ÄÂêç',
                quote: '"Âú®ÁªùÊúõÁöÑÊ∑±Ê∏ä‰∏≠ÔºåÂæÄÂæÄÈöêËóèÁùÄÊúÄÂº∫Â§ßÁöÑÂäõÈáè„ÄÇ"',
                icon: 'üî•',
                condition: (stats) => stats.comebackVictory,
                unlocked: false
            },
            {
                id: 'devil_dealer',
                name: 'ÊÅ∂È≠î‰∫§ÊòìËÄÖ',
                description: '‰∏éÈªëÊöóÂäõÈáèËææÊàêÂçèËÆÆÂπ∂ÊàêÂäüËé∑ËÉú',
                quote: '"ÊúâÊó∂ÂÄôÔºå‰∏éÊÅ∂È≠îÂÅö‰∫§ÊòìÊòØÂîØ‰∏ÄÁöÑÂá∫Ë∑Ø„ÄÇ"',
                icon: 'üî±',
                condition: (stats) => stats.hasDevilDeal && stats.finalRank === 1,
                unlocked: false
            },
            {
                id: 'conspiracy_theorist',
                name: 'Èò¥Ë∞ãËÆ∫ËÄÖ',
                description: 'ÂèëÁé∞ÊãçÂçñÊâÄÁöÑ5‰∏™ÈöêËóèÁßòÂØÜ',
                quote: '"ÁúüÁõ∏ÂæÄÂæÄÈöêËóèÂú®ÊúÄÊòæËÄåÊòìËßÅÁöÑÂú∞Êñπ„ÄÇ"',
                icon: 'üïµÔ∏è',
                condition: (stats) => stats.conspiraciesUncovered >= 5,
                unlocked: false
            },
            {
                id: 'soul_collector',
                name: 'ÁÅµÈ≠ÇÊî∂Ââ≤ËÄÖ',
                description: 'Ëé∑ÂæóË∂ÖËøá10‰ª∂ËØÖÂííÁâ©ÂìÅ',
                quote: '"Êî∂ÈõÜÁÅµÈ≠ÇÊòØ‰∏ÄÈó®Ëâ∫ÊúØÔºå‰πüÊòØ‰∏ÄÁßçËØÖÂíí„ÄÇ"',
                icon: '‚ö±Ô∏è',
                condition: (stats) => stats.cursedItemsCollected >= 10,
                unlocked: false
            },
            {
                id: 'time_manipulator',
                name: 'Êó∂Èó¥ÊìçÊéßËÄÖ',
                description: '‰ΩøÁî®Êó∂Èó¥Áõ∏ÂÖ≥ÊäÄËÉΩÊîπÂèòÂéÜÂè≤',
                quote: '"Êó∂Èó¥ÊòØÊúÄÂêéÁöÑËæπÁïåÔºå‰ΩÜ‰∏çÊòØÁªùÂØπÁöÑ„ÄÇ"',
                icon: '‚è≥',
                condition: (stats) => stats.timeManipulation >= 1,
                unlocked: false
            },
            {
                id: 'shadow_economist',
                name: 'ÊöóÂΩ±ÁªèÊµéÂ≠¶ÂÆ∂',
                description: 'Âú®Ê∏∏Êàè‰∏≠ÂèëÁé∞Âπ∂Âà©Áî®ÊâÄÊúâÁªèÊµéËßÑÂæã',
                quote: '"Âú®ÊöóÂΩ±‰∏≠ÔºåÁªèÊµéÂ≠¶Â±ïÁé∞Âá∫‰∫ÜÂÆÉÊúÄÁúüÂÆûÁöÑÈù¢Ë≤å„ÄÇ"',
                icon: 'üìà',
                condition: (stats) => stats.economicInsights >= 8,
                unlocked: false
            },
            {
                id: 'madness_incarnate',
                name: 'ÁñØÁãÇÂåñË∫´',
                description: 'ÂÆåÂÖ®Êã•Êä±ÁñØÁãÇ‰ªçÁÑ∂Ëé∑ÂæóËÉúÂà©',
                quote: '"ÊúâÊó∂ÂÄôÔºåÁñØÁãÇÊòØÂîØ‰∏ÄÁêÜÊÄßÁöÑÈÄâÊã©„ÄÇ"',
                icon: 'üåÄ',
                condition: (stats) => stats.embracedMadness && stats.finalRank === 1,
                unlocked: false
            },
            {
                id: 'puppet_master',
                name: 'ÂÇÄÂÑ°Â§ßÂ∏à',
                description: 'ÊàêÂäüÊìçÊéßÂÖ∂‰ªñÂèÇ‰∏éËÄÖÁöÑË°å‰∏∫',
                quote: '"ÊúÄÈ´òÁ∫ßÁöÑÊéßÂà∂ÔºåÊòØËÆ©Âà´‰∫∫‰ª•‰∏∫‰ªñ‰ª¨Âú®Ëá™Áî±ÈÄâÊã©„ÄÇ"',
                icon: 'üé≠',
                condition: (stats) => stats.mindControlUses >= 3,
                unlocked: false
            },
            {
                id: 'wealth_transcendent',
                name: 'Ë¥¢ÂØåË∂ÖË∂äËÄÖ',
                description: 'ÊúÄÁªàË¥¢ÂØåË∂ÖËøáËµ∑ÂßãÁöÑ10ÂÄç',
                quote: '"Ë¥¢ÂØåÂè™ÊòØÂäõÈáèÁöÑË°®Ë±°ÔºåÁúüÊ≠£ÁöÑÂäõÈáèÊù•Ëá™ÂØπËßÑÂàôÁöÑÁêÜËß£„ÄÇ"',
                icon: 'üíé',
                condition: (stats) => stats.finalWealth >= stats.initialWealth * 10,
                unlocked: false
            },
            {
                id: 'legacy_inheritor',
                name: '‰º†ÊâøÁªßÊâøËÄÖ',
                description: 'Ëß£ÈîÅÊâÄÊúâÂÖ∂‰ªñÊàêÂ∞±ÔºåÊàê‰∏∫ÊöóÂΩ±ÊãçÂçñÊâÄÁöÑÊñ∞‰∏ª‰∫∫',
                quote: '"ÂΩì‰Ω†ÂáùËßÜÊ∑±Ê∏äÊó∂ÔºåÊ∑±Ê∏ä‰πüÂú®ÂáùËßÜÁùÄ‰Ω†„ÄÇÁé∞Âú®Ôºå‰Ω†Â∞±ÊòØÊ∑±Ê∏ä„ÄÇ"',
                icon: 'üëÅÔ∏è',
                condition: (stats) => achievements.filter(a => a.id !== 'legacy_inheritor' && a.unlocked).length >= 13,
                unlocked: false
            }
        ];

        // Â¢ûÂº∫ÁöÑÁâ©ÂìÅÂ∫ì
        const itemPool = [
            { 
                name: "Ë¢´ËØÖÂííÁöÑÂè§Ëë£Èíü", 
                desc: "Êó∂ÈíàÈÄÜËΩ¨ÁöÑÁ•ûÁßòÊó∂ÈíüÔºåÊçÆËØ¥ËÉΩËÆ©Êó∂Èó¥ÂÄíÊµÅ", 
                base: 80, 
                rarity: "ÊôÆÈÄö", 
                color: "#7d8590",
                skillChance: 0.3,
                curseChance: 0.6,
                mysteryLevel: 1,
                backstory: "Êù•Ëá™‰∏Ä‰∏™Âú®1929Âπ¥ËÇ°Â∏ÇÂ¥©Áõò‰∏≠Ëá™ÊùÄÁöÑÈì∂Ë°åÂÆ∂ÁöÑÈÅó‰∫ß"
            },
            { 
                name: "Ë°ÄÁ∫¢ÂÆùÁü≥È°πÈìæ", 
                desc: "Èï∂ÂµåÁùÄÁ•ûÁßòÁ∫¢ÂÆùÁü≥ÁöÑÈ°πÈìæÔºåÂú®ÈªëÊöó‰∏≠ÂèëÂÖâ", 
                base: 120, 
                rarity: "Á®ÄÊúâ", 
                color: "#f85149",
                skillChance: 0.4,
                curseChance: 0.5,
                mysteryLevel: 2,
                backstory: "Â±û‰∫é‰∏Ä‰ΩçÂú®Ê≥ïÂõΩÂ§ßÈù©ÂëΩ‰∏≠Ë¢´Â§ÑÂÜ≥ÁöÑË¥µÊóèÂ§´‰∫∫"
            },
            { 
                name: "È¢ÑË®ÄËÄÖÁöÑÊ∞¥Êô∂ÁêÉ", 
                desc: "ËÉΩÂ§üÁúãÂà∞Êú™Êù•ÁâáÊÆµÁöÑÁ•ûÁßòÊ∞¥Êô∂ÁêÉ", 
                base: 200, 
                rarity: "Âè≤ËØó", 
                color: "#9f7aea",
                skillChance: 0.8,
                curseChance: 0.3,
                mysteryLevel: 3,
                backstory: "‰º†ËØ¥‰∏≠ËÉΩÈ¢ÑËßÅËÇ°Â∏ÇÂ¥©ÁõòÁöÑÁ•ûÁßòÈ¢ÑË®ÄËÄÖÁöÑÈÅóÁâ©"
            },
            { 
                name: "ÊÅ∂È≠îÁöÑÂ•ëÁ∫¶‰π¶", 
                desc: "Áî®È≤úË°ÄÁ≠æÁΩ≤ÁöÑÂè§ËÄÅÂ•ëÁ∫¶ÔºåÊâøËØ∫Áªô‰∫àÂ∑®Â§ßÂäõÈáè", 
                base: 350, 
                rarity: "‰º†ËØ¥", 
                color: "#8b4513",
                skillChance: 0.9,
                curseChance: 0.9,
                mysteryLevel: 4,
                backstory: "ÂçéÂ∞îË°ó‰º†Â•á‰∫§ÊòìÂëò‰∏éÊÅ∂È≠îÁ≠æÁΩ≤ÁöÑÁúüÂÆûÂ•ëÁ∫¶"
            },
            { 
                name: "ÂìàËÄ∂ÂÖãÁöÑ‰∫≤Á¨îÊâãÁ®ø", 
                desc: "ËÆ∞ÂΩïÁùÄÁ¶ÅÂøåÁªèÊµéÁêÜËÆ∫ÁöÑÁèçË¥µÊâãÁ®ø", 
                base: 500, 
                rarity: "Á•ûËØù", 
                color: "#ffd700",
                skillChance: 0.95,
                curseChance: 0.1,
                mysteryLevel: 5,
                backstory: "ÂìàËÄ∂ÂÖãÂÖ≥‰∫éË∂ÖËá™ÁÑ∂ÁªèÊµéÂ≠¶ÁöÑÁßòÂØÜÁ†îÁ©∂"
            },
            { 
                name: "ÊöóÂΩ±‰∫§ÊòìÂëòÁöÑÈù¢ÂÖ∑", 
                desc: "ËÉΩÂ§üÈöêËóèÁúüÂÆûË∫´‰ªΩÂíåÊÑèÂõæÁöÑÁ•ûÁßòÈù¢ÂÖ∑", 
                base: 280, 
                rarity: "‰º†ËØ¥", 
                color: "#ff7b72",
                skillChance: 0.7,
                curseChance: 0.4,
                mysteryLevel: 3,
                backstory: "Âú∞‰∏ã‰∫§ÊòìÊâÄÂåøÂêç‰∫§ÊòìÂëòÁöÑÊ†áÂøóÊÄßÁâ©ÂìÅ"
            },
            { 
                name: "ÁñØÁãÇËâ∫ÊúØÂÆ∂ÁöÑÁîª‰Ωú", 
                desc: "ÁîªÈù¢‰ºöÈöèËßÇËÄÖÂøÉÂ¢ÉÂèòÂåñÁöÑËØ°ÂºÇÁîª‰Ωú", 
                base: 160, 
                rarity: "Âè≤ËØó", 
                color: "#9f7aea",
                skillChance: 0.6,
                curseChance: 0.7,
                mysteryLevel: 3,
                backstory: "‰∏Ä‰ΩçÂú®Á≤æÁ•ûÁóÖÈô¢‰∏≠Âàõ‰ΩúÁöÑÂ§©ÊâçÁîªÂÆ∂ÁöÑÈÅó‰Ωú"
            },
            { 
                name: "Êó∂Èó¥ÂïÜ‰∫∫ÁöÑÊ≤ôÊºè", 
                desc: "ËÉΩÂ§üÊìçÊéßÊó∂Èó¥ÊµÅÈÄüÁöÑÁ•ûÁßòÊ≤ôÊºè", 
                base: 600, 
                rarity: "Á•ûËØù", 
                color: "#4a9eff",
                skillChance: 0.8,
                curseChance: 0.6,
                mysteryLevel: 5,
                backstory: "‰º†ËØ¥‰∏≠Êó∂Èó¥ÂïÜ‰∫∫Áïô‰∏ãÁöÑÂîØ‰∏ÄÈÅóÁâ©"
            },
            { 
                name: "ÈªëÂ∏ÇÈì∂Ë°åÂÆ∂ÁöÑ‰øùÈô©ÁÆ±", 
                desc: "ÊçÆËØ¥ÂÜÖËóèÊó†ÈôêË¥¢ÂØåÁöÑÁ•ûÁßò‰øùÈô©ÁÆ±", 
                base: 450, 
                rarity: "Á•ûËØù", 
                color: "#2ea043",
                skillChance: 0.5,
                curseChance: 0.8,
                mysteryLevel: 4,
                backstory: "ÊéßÂà∂ÂÖ®ÁêÉÈªëÂ∏ÇÁöÑÁ•ûÁßòÈì∂Ë°åÂÆ∂ÁöÑÁßÅ‰∫∫‰øùÈô©ÁÆ±"
            },
            { 
                name: "Áª¥Â∫¶Ë£ÇÁºù‰∏≠ÁöÑÈÅóÁâ©", 
                desc: "‰ªéÂπ≥Ë°åÂÆáÂÆôË∑åËêΩÁöÑ‰∏çÊòéÁâ©‰ΩìÔºåÊï£ÂèëÁùÄÂ•áÂºÇËÉΩÈáè", 
                base: 800, 
                rarity: "Ê∑∑Ê≤å", 
                color: "#ff6b6b",
                skillChance: 1.0,
                curseChance: 1.0,
                mysteryLevel: 6,
                backstory: "ÁßëÂ≠¶Êó†Ê≥ïËß£ÈáäÁöÑË∑®Áª¥Â∫¶Áâ©ÂìÅ"
            }
        ];
        
        // AIÁ≠ñÁï•ÈÖçÁΩÆ
        const aiStrategies = [
            { name: "ÁêÜËÆ∫ÂÆ∂È©¨ÂÖãÊñØ", strategy: "nash", color: "#ffd700", desc: "Êï∞Â≠¶Ëá≥‰∏ä‰∏ª‰πâËÄÖ", rgb: "255, 215, 0", threatLevel: "ÊûÅÈ´ò" },
            { name: "ËµåÂæíËééÊãâ", strategy: "aggressive", color: "#f85149", desc: "ÁñØÁãÇËµåÂæí", rgb: "248, 81, 73", threatLevel: "Ëá¥ÂëΩ" },
            { name: "‰øùÂÆàÊ¥æÈ≤çÂãÉ", strategy: "conservative", color: "#2ea043", desc: "Âè§ËÄÅÂÆ∂ÊóèÁöÑÂÆàÊä§ËÄÖ", rgb: "46, 160, 67", threatLevel: "‰∏≠Á≠â" },
            { name: "Â≠¶‰π†ËÄÖËâæ‰∏Ω", strategy: "adaptive", color: "#a5a5ff", desc: "ËøõÂåñ‰∏≠ÁöÑAI", rgb: "165, 165, 255", threatLevel: "Êú™Áü•" },
            { name: "ÈöèÊú∫ËÄÖÊù∞ÂÖã", strategy: "random", color: "#7d8590", desc: "Ê∑∑Ê≤åÂåñË∫´", rgb: "125, 133, 144", threatLevel: "Ê∑∑Ê≤å" },
            { name: "ÂøÉÁêÜÊàòÂ§ßÂ∏à", strategy: "psychological", color: "#ff7b72", desc: "‰º†ËØ¥‰∏≠ÁöÑÊãçÂçñÊâÄ‰∏ª‰∫∫", rgb: "255, 123, 114", threatLevel: "‰º†ËØ¥" }
        ];

        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let gameState = {
            level: 1,
            maxLevel: 12,
            cash: 200,
            totalWealth: 200,
            wonItems: [],
            streak: 0,
            totalProfit: 0,
            currentItem: null,
            playerValuation: 0,
            aiPlayers: [],
            isGameOver: false,
            isPlaying: false,
            biddingPhase: 'input',
            playerBid: 0,
            marginFee: 10,
            eliminatedPlayers: [],
            settings: {
                initialWealth: 200,
                aiCount: 4,
                marginFee: 10
            },
            // Â¢ûÂº∫Áä∂ÊÄÅ
            activeSkills: [],
            activeCurses: [],
            skillHistory: [],
            curseHistory: [],
            threatLevel: 'safe',
            shadowIntel: [],
            mysteryUnlocked: 0,
            stats: {
                totalWins: 0,
                nashWinStreak: 0,
                maxWinStreak: 0,
                bankruptcies: 0,
                gameCompleted: false,
                maxOverbidRatio: 0,
                maxRiskBid: 0,
                totalProfit: 0,
                lastSurvivor: false,
                eliminatedAllAI: false,
                precisionStreak: 0,
                comebackVictory: false,
                gameTime: 0,
                gameStartTime: 0,
                zeroBidPsycho: false,
                negativeProfitRounds: 0,
                consecutiveZeroBids: 0,
                lowWealthWin: false,
                maxSkillsAtOnce: 0,
                maxCursesAtOnce: 0,
                cursedVictory: 0,
                totalSkillsAcquired: 0,
                totalCursesAcquired: 0,
                uniqueSkills: 0,
                uniqueCurses: 0,
                finalRank: 0,
                finalWealth: 0,
                initialWealth: 200,
                perfectStrategy: false,
                nashUsageRate: 0,
                nashUsageCount: 0,
                totalBids: 0,
                // Êñ∞Â¢ûÁªüËÆ°
                hasDevilDeal: false,
                conspiraciesUncovered: 0,
                cursedItemsCollected: 0,
                timeManipulation: 0,
                economicInsights: 0,
                embracedMadness: false,
                mindControlUses: 0
            },
            unlockedAchievements: []
        };
        
        // ===========================
        // Ê†∏ÂøÉÊ∏∏ÊàèÂáΩÊï∞
        // ===========================
        
        function playSound(type) {
            try {
                const audio = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audio.createOscillator();
                const gainNode = audio.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audio.destination);
                
                const frequencies = {
                    'click': 800,
                    'success': 523.25,
                    'failure': 196,
                    'coin': 659.25,
                    'level': 440,
                    'elimination': 150,
                    'mystery': 880,
                    'curse': 100,
                    'conspiracy': 666
                };
                
                oscillator.frequency.value = frequencies[type] || 400;
                gainNode.gain.setValueAtTime(0.1, audio.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.2);
                
                oscillator.start(audio.currentTime);
                oscillator.stop(audio.currentTime + 0.2);
            } catch (e) {
                // ÈùôÈªòÂ§ÑÁêÜÈü≥È¢ëÈîôËØØ
            }
        }
        
        function createParticleEffect(x, y, type = 'default', count = 10) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.className = `particle ${type}`;
                
                const offsetX = (Math.random() - 0.5) * 120;
                const offsetY = (Math.random() - 0.5) * 120;
                particle.style.left = x + offsetX + 'px';
                particle.style.top = y + offsetY + 'px';
                
                const size = Math.random() * 4 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                const angle = Math.random() * Math.PI * 2;
                const velocity = Math.random() * 150 + 80;
                const gravity = 250;
                const life = Math.random() * 3 + 1.5;
                const spin = (Math.random() - 0.5) * 720;
                
                document.body.appendChild(particle);
                
                let startTime = performance.now();
                
                function animateParticle(currentTime) {
                    const elapsed = (currentTime - startTime) / 1000;
                    
                    if (elapsed >= life) {
                        particle.remove();
                        return;
                    }
                    
                    const x_pos = x + offsetX + Math.cos(angle) * velocity * elapsed;
                    const y_pos = y + offsetY + Math.sin(angle) * velocity * elapsed + 0.5 * gravity * elapsed * elapsed;
                    
                    particle.style.left = x_pos + 'px';
                    particle.style.top = y_pos + 'px';
                    particle.style.opacity = Math.max(0, 1 - elapsed / life);
                    particle.style.transform = `rotate(${spin * elapsed}deg) scale(${1 - elapsed / life * 0.5})`;
                    
                    requestAnimationFrame(animateParticle);
                }
                
                requestAnimationFrame(animateParticle);
            }
        }
        
        function showFloatingText(text, color) {
            const floating = document.createElement('div');
            floating.style.cssText = `
                position: fixed;
                top: 40%;
                left: 50%;
                transform: translate(-50%, -50%);
                color: ${color};
                font-family: 'Press Start 2P', monospace;
                font-size: 16px;
                z-index: 5000;
                pointer-events: none;
                text-shadow: 
                    0 0 20px ${color},
                    0 0 40px ${color}40;
                animation: enhancedFloatUp 3s ease-out forwards;
                white-space: nowrap;
            `;
            floating.textContent = text;
            document.body.appendChild(floating);
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes enhancedFloatUp {
                    0% { 
                        opacity: 0; 
                        transform: translate(-50%, -50%) scale(0.5) rotateY(-90deg); 
                    }
                    15% { 
                        opacity: 1; 
                        transform: translate(-50%, -50%) scale(1.3) rotateY(0deg); 
                    }
                    25% { 
                        transform: translate(-50%, -50%) scale(1) rotateY(0deg); 
                    }
                    80% { 
                        opacity: 1; 
                        transform: translate(-50%, -60%) scale(1) rotateY(0deg); 
                    }
                    100% { 
                        opacity: 0; 
                        transform: translate(-50%, -80%) scale(0.8) rotateY(0deg); 
                    }
                }
            `;
            document.head.appendChild(style);
            
            setTimeout(() => {
                floating.remove();
                style.remove();
            }, 3000);
        }

        // ===========================
        // ÊïÖ‰∫ãÁ≥ªÁªüÂáΩÊï∞
        // ===========================

        function initializeStory() {
            Object.keys(characterProfiles).forEach(character => {
                currentStoryState.characterRelationships[character] = {
                    respect: 0,
                    fear: 0,
                    rivalry: 0,
                    suspicion: 0
                };
            });
            
            setTimeout(() => {
                showStoryEvent('gameStart');
            }, 2000);
        }

        function showStoryEvent(trigger) {
            const event = storyEvents.find(e => e.trigger === trigger);
            if (!event || currentStoryState.eventsTriggered.includes(trigger)) return;
            
            currentStoryState.eventsTriggered.push(trigger);
            showStoryDialog(event);
        }

        function showStoryDialog(event) {
            const overlay = document.createElement('div');
            overlay.className = 'story-dialog-overlay';
            overlay.innerHTML = `
                <div class="story-dialog">
                    <div class="story-dialog-title">${event.title}</div>
                    <div class="story-dialog-text">${event.text.replace(/\n/g, '<br>')}</div>
                    <div class="story-dialog-choices">
                        ${event.choices.map((choice, index) => 
                            `<button class="story-choice-btn ${choice.isSpecial ? 'special-choice' : ''}" 
                             onclick="selectStoryChoice('${event.trigger}', ${index})">${choice.text}</button>`
                        ).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            playSound('mystery');
        }

        function selectStoryChoice(trigger, choiceIndex) {
            const event = storyEvents.find(e => e.trigger === trigger);
            const choice = event.choices[choiceIndex];
            
            applyStoryEffect(choice.effect);
            document.querySelector('.story-dialog-overlay').remove();
        }

        function applyStoryEffect(effect) {
            switch(effect) {
                case 'enter_shadow':
                    currentStoryState.conspiracyLevel += 1;
                    showFloatingText('Ë∏èÂÖ•‰∫ÜÊú™Áü•ÁöÑÈ¢ÜÂüü...', '#9f7aea');
                    break;
                case 'investigate':
                    gameState.stats.conspiraciesUncovered += 1;
                    addSkill('insight');
                    showFloatingText('Ëé∑ÂæóÊöóÂΩ±Ê¥ûÂØüÔºÅÁúüÁõ∏ÂºÄÂßãÊòæÁé∞...', '#4a9eff');
                    break;
                case 'resist_curse':
                    addSkill('calm');
                    currentStoryState.playerReputation += 10;
                    showFloatingText('ÁêÜÊÄß‰πãÂÖâÈ©±Êï£‰∫ÜËØÖÂííÔºÅ', '#2ea043');
                    break;
                case 'embrace_darkness':
                    gameState.stats.embracedMadness = true;
                    addRandomCurse();
                    addRandomSkill();
                    showFloatingText('‰∏éÈªëÊöóËûç‰∏∫‰∏Ä‰Ωì...', '#8b4513');
                    playSound('curse');
                    break;
                case 'devil_deal':
                    gameState.stats.hasDevilDeal = true;
                    currentStoryState.hasDevilDeal = true;
                    gameState.totalWealth = Math.floor(gameState.totalWealth * 1.5);
                    addCurse('soul_debt');
                    showFloatingText('ÊÅ∂È≠îÁöÑÂäõÈáèÂú®Ë°ÄÁÆ°‰∏≠ÊµÅÊ∑å...', '#f85149');
                    playSound('conspiracy');
                    break;
                case 'embrace_madness':
                    gameState.stats.embracedMadness = true;
                    for(let i = 0; i < 3; i++) {
                        addRandomCurse();
                        addRandomSkill();
                    }
                    showFloatingText('Âú®ÁñØÁãÇ‰∏≠ÊâæÂà∞‰∫ÜÂäõÈáèÔºÅ', '#ff6b6b');
                    break;
                default:
                    showFloatingText('ÂëΩËøêÁöÑËΩÆÁõòÂºÄÂßãËΩ¨Âä®...', '#ffd700');
            }
            
            updateThreatLevel();
            updateShadowIntel(effect);
        }

        function addRandomSkill() {
            const availableSkills = skillLibrary.filter(skill => 
                !gameState.activeSkills.some(active => active.id === skill.id)
            );
            
            if (availableSkills.length > 0) {
                const randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                addSkill(randomSkill.id);
            }
        }

        function addRandomCurse() {
            const availableCurses = curseLibrary.filter(curse => 
                !gameState.activeCurses.some(active => active.id === curse.id)
            );
            
            if (availableCurses.length > 0) {
                const randomCurse = availableCurses[Math.floor(Math.random() * availableCurses.length)];
                addCurse(randomCurse.id);
            }
        }

        function updateThreatLevel() {
            const cursedItems = gameState.wonItems.filter(item => item.triggeredCurse).length;
            const totalCurses = gameState.activeCurses.length;
            const conspiracyLevel = currentStoryState.conspiracyLevel;
            
            let threat = 'safe';
            let threatColor = '#2ea043';
            
            if (cursedItems >= 3 || totalCurses >= 2 || conspiracyLevel >= 2) {
                threat = 'warning';
                threatColor = '#ffd700';
            }
            
            if (cursedItems >= 5 || totalCurses >= 4 || conspiracyLevel >= 4) {
                threat = 'danger';
                threatColor = '#f85149';
            }
            
            if (cursedItems >= 8 || totalCurses >= 6 || conspiracyLevel >= 6) {
                threat = 'critical';
                threatColor = '#8b4513';
            }
            
            if (currentStoryState.hasDevilDeal || gameState.stats.embracedMadness) {
                threat = 'transcendent';
                threatColor = '#9f7aea';
            }
            
            gameState.threatLevel = threat;
            
            const threatElement = document.getElementById('threatLevel');
            if (threatElement) {
                threatElement.textContent = threat.toUpperCase();
                threatElement.style.color = threatColor;
            }
        }

        function updateShadowIntel(effect) {
            const intelMap = {
                'investigate': 'ÂèëÁé∞‰∫ÜÊãçÂçñÊâÄÁöÑÂè§ËÄÅËµ∑Ê∫ê...',
                'devil_deal': 'ÊÅ∂È≠îÂ•ëÁ∫¶Â∑≤ÁîüÊïàÔºåÁÅµÈ≠ÇÂÄ∫Âä°Á¥ØÁßØ‰∏≠...',
                'embrace_darkness': 'Â∑≤‰∏éÊöóÂΩ±ËûçÂêàÔºåËé∑Âæó‰∫ÜÁ¶ÅÂøåÁü•ËØÜ...',
                'resist_curse': 'ÁêÜÊÄß‰πãÂÖâ‰øùÊä§ÁùÄ‰Ω†ÁöÑÁÅµÈ≠Ç...',
                'final_challenge': 'ÊúÄÁªàÁöÑËÄÉÈ™åÂç≥Â∞ÜÂºÄÂßã...'
            };
            
            if (intelMap[effect]) {
                gameState.shadowIntel.unshift({
                    message: intelMap[effect],
                    timestamp: Date.now(),
                    type: effect
                });
                
                if (gameState.shadowIntel.length > 5) {
                    gameState.shadowIntel = gameState.shadowIntel.slice(0, 5);
                }
                
                updateShadowIntelUI();
            }
        }

        function updateShadowIntelUI() {
            const container = document.getElementById('shadowIntel');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (gameState.shadowIntel.length === 0) {
                container.innerHTML = '<div style="color: #7d8590; font-size: 8px;">ÊöÇÊó†ÊÉÖÊä•...</div>';
                return;
            }
            
            gameState.shadowIntel.forEach((intel, index) => {
                const intelElement = document.createElement('div');
                intelElement.className = 'card';
                intelElement.style.marginBottom = '10px';
                intelElement.style.animationDelay = `${index * 0.1}s`;
                
                const typeColors = {
                    'investigate': '#4a9eff',
                    'devil_deal': '#f85149',
                    'embrace_darkness': '#8b4513',
                    'resist_curse': '#2ea043',
                    'final_challenge': '#ffd700'
                };
                
                intelElement.style.borderColor = typeColors[intel.type] || '#30363d';
                
                intelElement.innerHTML = `
                    <div class="card-content" style="font-size: 7px; line-height: 1.4; color: #c9d1d9;">
                        ${intel.message}
                    </div>
                `;
                
                container.appendChild(intelElement);
            });
        }

        function updateShadowRumors() {
            const rumors = [
                "Êúâ‰∫∫ËØ¥È©¨ÂÖãÊñØÂçöÂ£´ÁöÑÊï∞Â≠¶ÂÖ¨Âºè‰∏≠ÈöêËóèÁùÄÊÅ∂È≠îÁöÑÁ¨¶Âè∑...",
                "ËééÊãâÁöÑËøêÊ∞îÊù•Ëá™‰∫éÂ•πÂú®ÊãâÊñØÁª¥Âä†ÊñØÂÅöÁöÑË°ÄËÖ•‰∫§Êòì...",
                "È≤çÂãÉÁöÑÂÆ∂ÊóèË¥¢ÂØåÂª∫Á´ãÂú®Êó†Êï∞ÁÅµÈ≠ÇÁöÑÁóõËã¶‰πã‰∏ä...",
                "Ëâæ‰∏ΩÂèØËÉΩ‰∏çÊòØÊôÆÈÄöÁöÑAIÔºåËÄåÊòØË¢´Âõ∞ÁöÑ‰∫∫Á±ªÊÑèËØÜ...",
                "Êù∞ÂÖãÊù•Ëá™‰∏Ä‰∏™Áé∞ÂÆûÊ≥ïÂàôÂÆåÂÖ®‰∏çÂêåÁöÑÂπ≥Ë°åÂÆáÂÆô...",
                "ÊöóÂΩ±Â§´‰∫∫‰ªéÊú™ÁúüÊ≠£Ê≠ªÂéªÔºåÂ•π‰∏ÄÁõ¥Âú®ÂØªÊâæÁªßÊâøËÄÖ...",
                "ËøôÈáåÁöÑÊØè‰∏Ä‰ª∂ÊãçÂìÅÈÉΩÊõæÁªèÂÆ≥Ê≠ªËøáÂÆÉ‰ª¨ÁöÑ‰∏ª‰∫∫...",
                "ÂìàËÄ∂ÂÖãÁöÑÁÅµÈ≠ÇË¢´Âõ∞Âú®ËøôÈáåÔºåÊó†Ê≥ïËé∑ÂæóÂÆâÊÅØ...",
                "ÊãçÂçñÊâÄÁöÑÁúüÊ≠£ÁõÆÁöÑÊòØÊî∂ÈõÜ‰∫∫Á±ªÁöÑË¥™Â©™ÂíåÁªùÊúõ...",
                "ÊúÄÁªàÁöÑËÉúÂà©ËÄÖÂ∞ÜÊàê‰∏∫Êñ∞ÁöÑÊöóÂΩ±ÊãçÂçñÊâÄ‰∏ª‰∫∫..."
            ];
            
            const container = document.getElementById('shadowRumors');
            if (!container) return;
            
            const randomRumor = rumors[Math.floor(Math.random() * rumors.length)];
            
            container.innerHTML = `
                <div class="card" style="background: rgba(139, 69, 19, 0.1); border-color: rgba(139, 69, 19, 0.3);">
                    <div class="card-content" style="font-size: 7px; line-height: 1.4; color: #c9d1d9; font-style: italic;">
                        üí≠ ${randomRumor}
                    </div>
                </div>
            `;
        }

        // ===========================
        // ÊäÄËÉΩËØÖÂííÁ≥ªÁªüÂáΩÊï∞
        // ===========================

        function addSkill(skillId) {
            const skill = skillLibrary.find(s => s.id === skillId);
            if (!skill) return;

            const existing = gameState.activeSkills.find(s => s.id === skillId);
            if (existing) {
                existing.remainingDuration = skill.duration;
                showFloatingText(`‚ú® ÊäÄËÉΩÂº∫Âåñ: ${skill.name} ‚ú®`, '#2ea043');
                return;
            }

            const newSkill = {
                ...skill,
                remainingDuration: skill.duration
            };
            
            gameState.activeSkills.push(newSkill);
            gameState.skillHistory.push(skillId);
            gameState.stats.totalSkillsAcquired++;
            gameState.stats.maxSkillsAtOnce = Math.max(gameState.stats.maxSkillsAtOnce, gameState.activeSkills.length);
            gameState.stats.uniqueSkills = new Set(gameState.skillHistory).size;

            showFloatingText(`‚ú® Ëé∑ÂæóÁ•ûÂäõ: ${skill.name} ‚ú®`, '#2ea043');
            updateSpecialEffectsUI();
            updateUI();
            
            setTimeout(() => {
                createParticleEffect(
                    window.innerWidth / 2,
                    window.innerHeight * 0.4,
                    'skill',
                    30
                );
            }, 100);
            
            playSound('success');
        }

        function addCurse(curseId) {
            const curse = curseLibrary.find(c => c.id === curseId);
            if (!curse) return;

            const existing = gameState.activeCurses.find(c => c.id === curseId);
            if (existing) {
                existing.remainingDuration = curse.duration;
                showFloatingText(`üíÄ ËØÖÂííÂä†Ê∑±: ${curse.name} üíÄ`, '#8b4513');
                return;
            }

            const newCurse = {
                ...curse,
                remainingDuration: curse.duration
            };
            
            gameState.activeCurses.push(newCurse);
            gameState.curseHistory.push(curseId);
            gameState.stats.totalCursesAcquired++;
            gameState.stats.maxCursesAtOnce = Math.max(gameState.stats.maxCursesAtOnce, gameState.activeCurses.length);
            gameState.stats.uniqueCurses = new Set(gameState.curseHistory).size;

            showFloatingText(`üíÄ ÂèóÂà∞ËØÖÂíí: ${curse.name} üíÄ`, '#8b4513');
            updateSpecialEffectsUI();
            updateUI();
            
            setTimeout(() => {
                createParticleEffect(
                    window.innerWidth / 2,
                    window.innerHeight * 0.4,
                    'curse',
                    25
                );
            }, 100);
            
            playSound('curse');
        }

        function updateEffectDurations() {
            gameState.activeSkills = gameState.activeSkills.filter(skill => {
                skill.remainingDuration--;
                if (skill.remainingDuration <= 0) {
                    showFloatingText(`ÊäÄËÉΩÊ∂àÈÄù: ${skill.name}`, '#7d8590');
                    return false;
                }
                return true;
            });

            gameState.activeCurses = gameState.activeCurses.filter(curse => {
                curse.remainingDuration--;
                if (curse.remainingDuration <= 0) {
                    showFloatingText(`ËØÖÂííËß£Èô§: ${curse.name}`, '#7d8590');
                    return false;
                }
                return true;
            });
        }

        function applySkillEffects() {
            let effects = {
                showAIBidRanges: false,
                showHiddenMotives: false,
                valuationMultiplier: 1,
                nashBonus: 0,
                marginFeeMultiplier: 1,
                showExactWealth: false,
                showFutureItem: false,
                canControlAI: false,
                hasRebirth: false
            };

            gameState.activeSkills.forEach(skill => {
                const skillEffect = skill.effect(gameState);
                effects = { ...effects, ...skillEffect };
            });

            return effects;
        }

        function applyCurseEffects(bid = 0) {
            let effects = {
                bidMultiplier: 1,
                valuationMultiplier: 1,
                valuationDisplayMultiplier: 1,
                marginFeeMultiplier: 1,
                blockNash: false,
                message: '',
                nashBlockMessage: '',
                hideItemValues: false,
                soulTax: 0
            };

            gameState.activeCurses.forEach(curse => {
                const curseEffect = curse.effect(gameState, bid);
                effects = { ...effects, ...curseEffect };
                if (curseEffect.message) {
                    effects.message += curseEffect.message + ' ';
                }
            });

            return effects;
        }

        function processItemEffects(item) {
            let triggeredSkill = false;
            let triggeredCurse = false;
            
            // Âü∫Á°ÄÊ¶ÇÁéá
            let skillChance = item.skillChance || 0.3;
            let curseChance = item.curseChance || 0.2;
            
            // Ê†πÊçÆÂ®ÅËÉÅÁ≠âÁ∫ßË∞ÉÊï¥Ê¶ÇÁéá
            const threatModifiers = {
                'safe': { skill: 1.0, curse: 0.8 },
                'warning': { skill: 1.2, curse: 1.0 },
                'danger': { skill: 1.5, curse: 1.3 },
                'critical': { skill: 2.0, curse: 1.8 },
                'transcendent': { skill: 2.5, curse: 2.0 }
            };
            
            const modifier = threatModifiers[gameState.threatLevel] || threatModifiers['safe'];
            skillChance *= modifier.skill;
            curseChance *= modifier.curse;
            
            // Ê£ÄÊü•ÊäÄËÉΩËß¶Âèë
            if (Math.random() < Math.min(skillChance, 0.95)) {
                addRandomSkill();
                triggeredSkill = true;
                gameState.stats.economicInsights++;
            }

            // Ê£ÄÊü•ËØÖÂííËß¶Âèë
            if (Math.random() < Math.min(curseChance, 0.95)) {
                addRandomCurse();
                triggeredCurse = true;
                if (triggeredCurse) {
                    gameState.stats.cursedItemsCollected++;
                }
            }
            
            // ÁâπÊÆäÊïàÊûúÔºöÁ•ûËØùÁ∫ßÁâ©ÂìÅÁöÑÈ¢ùÂ§ñÊú∫Âà∂
            if (item.rarity === 'Á•ûËØù' || item.rarity === 'Ê∑∑Ê≤å') {
                gameState.mysteryUnlocked++;
                currentStoryState.conspiracyLevel++;
                
                if (Math.random() < 0.3) {
                    triggerSpecialEvent(item);
                }
            }
            
            return { triggeredSkill, triggeredCurse };
        }

        function triggerSpecialEvent(item) {
            const events = [
                () => {
                    showFloatingText('Êó∂Èó¥Êâ≠Êõ≤ÔºÅËé∑ÂæóÈ¢ùÂ§ñÂõûÂêàÔºÅ', '#4a9eff');
                    gameState.stats.timeManipulation++;
                    addSkill('time_dilation');
                },
                () => {
                    showFloatingText('ÂøÉÁÅµÊÑüÂ∫îÊøÄÊ¥ªÔºÅ', '#9f7aea');
                    addSkill('mind_control');
                },
                () => {
                    showFloatingText('ÊöóÂΩ±ÂïÜ‰∫∫Âá∫Áé∞ÔºÅËé∑ÂæóÈ¢ùÂ§ñË¥¢ÂØåÔºÅ', '#ffd700');
                    gameState.totalWealth += Math.floor(gameState.totalWealth * 0.2);
                },
                () => {
                    showFloatingText('ËØÖÂííÈ£éÊö¥Êù•Ë¢≠ÔºÅ', '#8b4513');
                    for(let i = 0; i < 2; i++) addRandomCurse();
                },
                () => {
                    showFloatingText('Á•ûÁßòÂ∫áÊä§ÔºÅËé∑Âæó‰øùÊä§ÔºÅ', '#2ea043');
                    for(let i = 0; i < 2; i++) addRandomSkill();
                }
            ];
            
            const randomEvent = events[Math.floor(Math.random() * events.length)];
            randomEvent();
            
            playSound('mystery');
        }

        function updateSpecialEffectsUI() {
            const container = document.getElementById('specialEffects');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (gameState.activeSkills.length === 0 && gameState.activeCurses.length === 0) {
                container.innerHTML = '<div style="color: #7d8590; font-size: 8px;">Êó†Ë∂ÖËá™ÁÑ∂ÊïàÊûú</div>';
                return;
            }

            gameState.activeSkills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-effect dramatic-entrance';
                skillElement.innerHTML = `
                    <div class="effect-name">${skill.icon} ${skill.name}</div>
                    <div class="effect-description">${skill.description}</div>
                    <div class="effect-duration">ÊåÅÁª≠ ${skill.remainingDuration} ËΩÆ</div>
                `;
                container.appendChild(skillElement);
            });

            gameState.activeCurses.forEach(curse => {
                const curseElement = document.createElement('div');
                curseElement.className = 'curse-effect dramatic-entrance';
                curseElement.innerHTML = `
                    <div class="effect-name">${curse.icon} ${curse.name}</div>
                    <div class="effect-description">${curse.description}</div>
                    <div class="effect-duration">ÊåÅÁª≠ ${curse.remainingDuration} ËΩÆ</div>
                `;
                container.appendChild(curseElement);
            });
        }

        // ===========================
        // Ê∏∏ÊàèÊ†∏ÂøÉÈÄªËæë
        // ===========================
        
        function startGame() {
            playSound('click');
            
            gameState.settings.initialWealth = parseInt(document.getElementById('initialWealth').value) || 200;
            gameState.settings.aiCount = parseInt(document.getElementById('aiCount').value) || 4;
            gameState.settings.marginFee = parseInt(document.getElementById('marginFee').value) || 10;
            
            document.getElementById('startScreen').style.opacity = '0';
            document.getElementById('startScreen').style.pointerEvents = 'none';
            
            setTimeout(() => {
                document.getElementById('startScreen').classList.add('hidden');
                document.getElementById('gameContainer').style.opacity = '1';
                document.getElementById('gameContainer').style.pointerEvents = 'all';
                
                gameState.isPlaying = true;
                initGame();
                initializeStory();
            }, 800);
        }
        
        function initGame() {
            gameState = {
                level: 1,
                maxLevel: 12,
                cash: gameState.settings.initialWealth,
                totalWealth: gameState.settings.initialWealth,
                wonItems: [],
                streak: 0,
                totalProfit: 0,
                currentItem: null,
                playerValuation: 0,
                aiPlayers: [],
                isGameOver: false,
                isPlaying: true,
                eliminatedPlayers: [],
                marginFee: gameState.settings.marginFee,
                activeSkills: [],
                activeCurses: [],
                skillHistory: [],
                curseHistory: [],
                threatLevel: 'safe',
                shadowIntel: [],
                mysteryUnlocked: 0,
                settings: gameState.settings,
                unlockedAchievements: gameState.unlockedAchievements || [], // Á°Æ‰øùÊòØÊï∞ÁªÑ
                stats: {
                    ...gameState.stats,
                    gameStartTime: Date.now(),
                    initialWealth: gameState.settings.initialWealth,
                    totalWins: 0,
                    nashWinStreak: 0,
                    gameCompleted: false,
                    totalSkillsAcquired: 0,
                    totalCursesAcquired: 0,
                    hasDevilDeal: false,
                    conspiraciesUncovered: 0,
                    cursedItemsCollected: 0,
                    timeManipulation: 0,
                    economicInsights: 0,
                    embracedMadness: false,
                    mindControlUses: 0
                }
            };
            
            currentStoryState = {
                act: 'opening',
                eventsTriggered: [],
                characterRelationships: {},
                playerReputation: 0,
                specialEffects: [],
                conspiracyLevel: 0,
                mysteryUnlocked: 0,
                hasDevilDeal: false,
                hasFinalPower: false,
                shadowIntel: [],
                threateningPlayers: []
            };
            
            updateUI();
            generateAIPlayers();
            startNewRound();
        }

        function generateAIPlayers() {
            const numAIs = gameState.settings.aiCount;
            gameState.aiPlayers = [];
            
            for (let i = 0; i < numAIs; i++) {
                const aiTemplate = aiStrategies[i % aiStrategies.length];
                const profile = characterProfiles[aiTemplate.name];
                
                const ai = {
                    ...aiTemplate,
                    profile: profile,
                    totalWealth: gameState.settings.initialWealth + (Math.random() - 0.5) * 50,
                    bid: 0,
                    wins: 0,
                    eliminated: false,
                    mood: 'neutral',
                    lastAction: 'none',
                    relationshipWithPlayer: 0,
                    suspicionLevel: Math.random() * 30,
                    hiddenAgenda: generateHiddenAgenda()
                };
                gameState.aiPlayers.push(ai);
            }
            
            updateAIPlayersUI();
        }

        function generateHiddenAgenda() {
            const agendas = [
                'ÂØªÊâæÂ§±ËêΩÁöÑÂÆ∂ÊóèÈÅóÁâ©',
                'Â§ç‰ªáËÆ°ÂàíÁöÑ‰∏ÄÈÉ®ÂàÜ',
                '‰∏∫‰∫ÜÊãØÊïëÊüê‰∏™ÈáçË¶ÅÁöÑ‰∫∫',
                'Ë¢´Á•ûÁßòÁªÑÁªáËÉÅËø´ÂèÇ‰∏é',
                'ÂØªÊ±ÇÊ∞∏ÁîüÁöÑÁßòÂØÜ',
                'ÊÉ≥Ë¶ÅËé∑ÂæóÈ¢ÑÁü•Êú™Êù•ÁöÑËÉΩÂäõ'
            ];
            
            return agendas[Math.floor(Math.random() * agendas.length)];
        }

        function generateNextItem() {
            try {
                const rarityLevel = { 
                    "ÊôÆÈÄö": 1, "Á®ÄÊúâ": 2, "Âè≤ËØó": 3, 
                    "‰º†ËØ¥": 4, "Á•ûËØù": 5, "Ê∑∑Ê≤å": 6 
                };
                
                const requiredLevel = Math.ceil((gameState.level + 1) / 2);
                const availableItems = itemPool.filter(item => {
                    return rarityLevel[item.rarity] <= Math.min(requiredLevel, 6);
                });
                
                // Â¶ÇÊûúÊ≤°ÊúâÂèØÁî®Áâ©ÂìÅÔºåËøîÂõûÁ¨¨‰∏Ä‰∏™Áâ©ÂìÅ‰Ωú‰∏∫ÂêéÂ§á
                if (availableItems.length === 0) {
                    console.log('No available items, using fallback');
                    return itemPool[0];
                }
                
                const selectedItem = availableItems[Math.floor(Math.random() * availableItems.length)];
                return { ...selectedItem }; // ËøîÂõûÂâØÊú¨ÈÅøÂÖçÂºïÁî®ÈóÆÈ¢ò
            } catch (error) {
                console.log('generateNextItem error:', error);
                // ËøîÂõû‰∏Ä‰∏™ÈªòËÆ§Áâ©ÂìÅ‰Ωú‰∏∫ÂêéÂ§á
                return {
                    name: "Á•ûÁßòÁâ©ÂìÅ",
                    desc: "Êú™Áü•ÁöÑÁ•ûÁßòÁâ©ÂìÅ",
                    base: 100,
                    rarity: "ÊôÆÈÄö",
                    color: "#7d8590",
                    skillChance: 0.2,
                    curseChance: 0.2,
                    mysteryLevel: 1
                };
            }
        }
        
        function updateUI() {
            animateValueChange('level', `${gameState.level}/${gameState.maxLevel}`);
            animateValueChange('wealth', Math.floor(gameState.totalWealth));
            animateValueChange('profit', gameState.totalProfit);
            animateValueChange('streak', gameState.streak);
            animateValueChange('activeSkills', gameState.activeSkills.length);
            animateValueChange('activeCurses', gameState.activeCurses.length);
            
            const wealthElement = document.getElementById('wealth');
            const wealthBar = document.getElementById('wealthBar');
            
            const wealthPercentage = Math.max(0, gameState.totalWealth / gameState.settings.initialWealth * 100);
            wealthBar.style.width = Math.min(wealthPercentage, 300) + '%';
            
            if (gameState.totalWealth <= gameState.marginFee * 2) {
                wealthElement.classList.add('critical');
                wealthBar.style.background = '#f85149';
            } else {
                wealthElement.classList.remove('critical');
                wealthBar.style.background = 'linear-gradient(90deg, #f85149, #ffd700, #2ea043)';
            }
            
            const playersAlive = gameState.aiPlayers.filter(ai => !ai.eliminated).length + 
                (gameState.totalWealth >= gameState.marginFee ? 1 : 0);
            animateValueChange('playersAlive', playersAlive);
            
            updateLevelIndicator();
            updateOwnedItemsUI();
            updateSpecialEffectsUI();
            updateThreatLevel();
        }
        
        function animateValueChange(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const oldValue = element.textContent;
            
            if (oldValue !== newValue.toString()) {
                element.classList.add('animate');
                element.textContent = newValue;
                
                setTimeout(() => {
                    element.classList.remove('animate');
                }, 500);
            }
        }
        
        function updateLevelIndicator() {
            const indicator = document.getElementById('levelIndicator');
            if (!indicator) return;
            
            indicator.innerHTML = '';
            
            for (let i = 1; i <= gameState.maxLevel; i++) {
                const dot = document.createElement('div');
                dot.className = 'level-dot';
                dot.textContent = i;
                
                if (i < gameState.level) {
                    dot.classList.add('completed');
                } else if (i === gameState.level) {
                    dot.classList.add('current');
                }
                
                indicator.appendChild(dot);
            }
        }

        function updateOwnedItemsUI() {
            const container = document.getElementById('ownedItems');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (gameState.wonItems.length === 0) {
                container.innerHTML = '<div style="color: #7d8590; font-size: 8px;">Êî∂ËóèÂìÅÁ©∫Á©∫Â¶Ç‰πü...</div>';
                return;
            }
            
            gameState.wonItems.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card fade-in';
                card.style.animationDelay = `${index * 0.1}s`;
                
                if (item.triggeredSkill) {
                    card.classList.add('blessed-item');
                }
                if (item.triggeredCurse) {
                    card.classList.add('cursed-item');
                }
                
                const curseEffects = applyCurseEffects();
                const displayValue = curseEffects.hideItemValues ? '???' : item.valuation;
                
                card.innerHTML = `
                    <div class="card-title">${item.name}</div>
                    <div class="card-content">
                        ‰º∞ÂÄº: ${displayValue}<br>
                        ÊàêÊú¨: ${item.purchasePrice}<br>
                        Âà©Ê∂¶: <span style="color: ${item.valuation - item.purchasePrice >= 0 ? '#2ea043' : '#f85149'}">${item.valuation - item.purchasePrice}</span><br>
                        Ëé∑ÂæóËΩÆÊ¨°: ${item.level}<br>
                        ${item.backstory ? `<em style="color: #7d8590; font-size: 6px;">${item.backstory}</em>` : ''}
                        ${item.triggeredSkill ? '<br><span style="color: #2ea043;">‚ú® Ëé∑ÂæóÁ•ûÂäõ</span>' : ''}
                        ${item.triggeredCurse ? '<br><span style="color: #8b4513;">üíÄ Ëß¶ÂèëËØÖÂíí</span>' : ''}
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        function updateAIPlayersUI() {
            const container = document.getElementById('aiPlayers');
            if (!container) return;
            
            container.innerHTML = '';
            
            const skillEffects = applySkillEffects();
            
            gameState.aiPlayers.forEach((ai, index) => {
                const profile = ai.profile || {};
                const card = document.createElement('div');
                card.className = 'card fade-in character-card';
                
                if (ai.eliminated) {
                    card.classList.add('eliminated');
                }
                
                if (ai.suspicionLevel > 70) {
                    card.classList.add('conspiracy-border');
                }
                
                card.style.setProperty('--rarity-color', ai.color);
                card.style.setProperty('--rarity-rgb', ai.rgb);
                card.style.animationDelay = `${index * 0.1}s`;
                
                const wealthColor = ai.totalWealth <= gameState.marginFee ? '#f85149' : '#2ea043';
                const eliminatedText = ai.eliminated ? 'Â∑≤Ë¢´ÊöóÂΩ±ÂêûÂô¨' : '';
                
                const moodEmoji = {
                    'confident': 'üòè',
                    'worried': 'üò∞', 
                    'angry': 'üò†',
                    'neutral': profile.avatar || 'üé≠',
                    'excited': 'ü§©',
                    'suspicious': 'ü§î',
                    'paranoid': 'üëÄ'
                };
                
                let extraInfo = '';
                if (skillEffects.showExactWealth) {
                    extraInfo += `<br>Á≤æÁ°ÆË¥¢ÂØå: ${Math.floor(ai.totalWealth)}`;
                }
                if (skillEffects.showAIBidRanges && !ai.eliminated) {
                    const estimatedBid = estimateAIBidRange(ai);
                    extraInfo += `<br>È¢ÑËÆ°Âá∫‰ª∑: ${estimatedBid.min}-${estimatedBid.max}`;
                }
                if (skillEffects.showHiddenMotives) {
                    extraInfo += `<br>ÈöêËóèÂä®Êú∫: ${ai.hiddenAgenda}`;
                }
                
                const suspicionBar = ai.suspicionLevel > 50 ? 
                    `<div style="background: rgba(255, 123, 114, 0.3); height: 3px; width: ${ai.suspicionLevel}%; margin-top: 5px; border-radius: 1px;"></div>` : '';
                
                card.innerHTML = `
                    <div class="card-title" style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">${moodEmoji[ai.mood] || profile.avatar || 'üé≠'}</span>
                        <span>${profile ? profile.fullName : ai.name}</span>
                        <span style="font-size: 6px; color: ${ai.threatLevel === '‰º†ËØ¥' ? '#ffd700' : '#7d8590'};">[${ai.threatLevel}]</span>
                    </div>
                    <div class="card-content">
                        Á≠ñÁï•: ${ai.strategy}<br>
                        Ë¥¢ÂØå: <span style="color: ${wealthColor}">${skillEffects.showExactWealth ? Math.floor(ai.totalWealth) : Math.floor(ai.totalWealth / 10) * 10 + '+'}</span><br>
                        ËÉúÂú∫: ${ai.wins}<br>
                        ÁñëËôëÂ∫¶: <span style="color: ${ai.suspicionLevel > 70 ? '#f85149' : '#7d8590'}">${Math.floor(ai.suspicionLevel)}%</span><br>
                        <em style="color: #c9d1d9; font-size: 6px;">${ai.desc}</em>
                        ${extraInfo}
                        ${eliminatedText && `<br><strong style="color: #f85149">${eliminatedText}</strong>`}
                        ${suspicionBar}
                    </div>
                `;
                
                if (ai.eliminated) {
                    const overlay = document.createElement('div');
                    overlay.className = 'eliminated-overlay';
                    overlay.textContent = 'Â∑≤Ê∑òÊ±∞';
                    card.appendChild(overlay);
                }
                
                container.appendChild(card);
            });
        }

        function estimateAIBidRange(ai) {
            const baseValuation = gameState.currentItem ? gameState.currentItem.base * 0.8 : 100;
            
            switch(ai.strategy) {
                case "nash":
                    const nashBid = baseValuation * 0.75;
                    return { min: Math.floor(nashBid * 0.95), max: Math.floor(nashBid * 1.05) };
                case "aggressive":
                    return { min: Math.floor(baseValuation * 0.8), max: Math.floor(baseValuation * 0.95) };
                case "conservative":
                    return { min: Math.floor(baseValuation * 0.4), max: Math.floor(baseValuation * 0.7) };
                case "adaptive":
                    return { min: Math.floor(baseValuation * 0.6), max: Math.floor(baseValuation * 0.8) };
                case "psychological":
                    return { min: Math.floor(baseValuation * 0.3), max: Math.floor(baseValuation * 1.2) };
                default:
                    return { min: Math.floor(baseValuation * 0.2), max: Math.floor(baseValuation * 0.9) };
            }
        }

        function startNewRound() {
            if (gameState.level > gameState.maxLevel) {
                const rankings = calculateFinalRankings();
                const playerRank = rankings.findIndex(p => p.name === 'Áé©ÂÆ∂') + 1;
                gameOver(playerRank === 1, false);
                return;
            }
            
            const aliveAIs = gameState.aiPlayers.filter(ai => !ai.eliminated);
            const playerAlive = gameState.totalWealth >= gameState.marginFee;
            
            if (!playerAlive) {
                const rankings = calculateFinalRankings();
                gameOver(false, false);
                return;
            }
            
            if (aliveAIs.length === 0) {
                const rankings = calculateFinalRankings();
                const playerRank = rankings.findIndex(p => p.name === 'Áé©ÂÆ∂') + 1;
                gameOver(playerRank === 1, true);
                return;
            }
            
            updateEffectDurations();
            checkEliminations();
            
            // ÊïÖ‰∫ãËøõÂ∫¶Ê£ÄÊü•
            if (gameState.level === 3) {
                setTimeout(() => showStoryEvent('level3'), 1000);
            }
            if (gameState.level >= 8) {
                setTimeout(() => showStoryEvent('final_rounds'), 1000);
            }
            if (gameState.totalWealth < gameState.marginFee * 3) {
                setTimeout(() => showStoryEvent('lowWealth'), 1500);
            }
            if (gameState.totalWealth > gameState.settings.initialWealth * 2) {
                setTimeout(() => showStoryEvent('highWealth'), 1500);
            }
            if (gameState.activeCurses.length >= 4) {
                setTimeout(() => showStoryEvent('cursed_heavily'), 2000);
            }
            
            playSound('level');
            
            const availableItems = itemPool.filter(item => {
                const rarityLevel = { 
                    "ÊôÆÈÄö": 1, "Á®ÄÊúâ": 2, "Âè≤ËØó": 3, 
                    "‰º†ËØ¥": 4, "Á•ûËØù": 5, "Ê∑∑Ê≤å": 6 
                };
                const requiredLevel = Math.ceil(gameState.level / 2);
                return rarityLevel[item.rarity] <= requiredLevel;
            });
            
            gameState.currentItem = { ...availableItems[Math.floor(Math.random() * availableItems.length)] };
            
            const difficultyMultiplier = 1 + (gameState.level - 1) * 0.15;
            gameState.currentItem.base = Math.floor(gameState.currentItem.base * difficultyMultiplier);
            
            const skillEffects = applySkillEffects();
            const curseEffects = applyCurseEffects();
            
            let baseVariation = 0.7 + Math.random() * 0.6;
            baseVariation *= skillEffects.valuationMultiplier;
            baseVariation *= curseEffects.valuationMultiplier;
            
            gameState.playerValuation = Math.floor(gameState.currentItem.base * baseVariation);
            
            updateAuctionItemUI();
            
            // Êâ£Èô§‰øùËØÅÈáë
            let currentMarginFee = gameState.marginFee;
            currentMarginFee *= skillEffects.marginFeeMultiplier;
            currentMarginFee *= curseEffects.marginFeeMultiplier;
            currentMarginFee = Math.floor(currentMarginFee);
            
            // ÁÅµÈ≠ÇÂÄ∫Âä°
            if (curseEffects.soulTax > 0) {
                const soulDebt = Math.floor(gameState.totalWealth * curseEffects.soulTax);
                gameState.totalWealth -= soulDebt;
                showFloatingText(`ÁÅµÈ≠ÇÂÄ∫Âä°: -${soulDebt}`, '#8b4513');
            }
            
            if (gameState.totalWealth >= currentMarginFee) {
                gameState.totalWealth -= currentMarginFee;
                if (gameState.cash >= currentMarginFee) {
                    gameState.cash -= currentMarginFee;
                } else {
                    gameState.cash = 0;
                }
                showMarginNotice(currentMarginFee);
            }
            
            // AIÂ§ÑÁêÜ
            gameState.aiPlayers.filter(ai => !ai.eliminated).forEach(ai => {
                if (ai.totalWealth >= gameState.marginFee) {
                    ai.totalWealth -= gameState.marginFee;
                    ai.suspicionLevel += Math.random() * 10;
                    
                    if (ai.totalWealth < gameState.marginFee * 2) {
                        ai.mood = 'worried';
                    } else if (ai.totalWealth > gameState.settings.initialWealth * 1.5) {
                        ai.mood = 'confident';
                    } else {
                        ai.mood = 'neutral';
                    }
                } else {
                    ai.eliminated = true;
                    ai.mood = 'angry';
                }
            });
            
            updateUI();
            updateAIPlayersUI();
            updateShadowRumors();
            
            setTimeout(() => {
                document.getElementById('biddingPanel').classList.remove('hidden');
                document.getElementById('bidInput').focus();
            }, 1000);
            
            document.getElementById('bidInput').value = '';
            updateRoundStats();
        }

        function updateAuctionItemUI() {
            const item = gameState.currentItem;
            const curseEffects = applyCurseEffects();
            const skillEffects = applySkillEffects();
            
            document.getElementById('itemName').textContent = item.name;
            
            let description = item.desc;
            if (item.backstory && gameState.mysteryUnlocked >= item.mysteryLevel) {
                description += ` (${item.backstory})`;
            }
            
            document.getElementById('itemDescription').textContent = description;
            
            let displayValuation = gameState.playerValuation;
            if (curseEffects.valuationDisplayMultiplier !== 1) {
                displayValuation = Math.floor(gameState.playerValuation * curseEffects.valuationDisplayMultiplier);
            }
            
            document.getElementById('playerValuation').textContent = displayValuation;
            document.getElementById('nashBid').textContent = calculateNashBid();
            
            const rarityColors = {
                'ÊôÆÈÄö': '#7d8590',
                'Á®ÄÊúâ': '#4a9eff', 
                'Âè≤ËØó': '#9f7aea',
                '‰º†ËØ¥': '#ffd700',
                'Á•ûËØù': '#ff6b6b',
                'Ê∑∑Ê≤å': '#ff6b6b'
            };
            
            document.getElementById('itemRarity').textContent = item.rarity;
            document.getElementById('itemRarity').style.color = rarityColors[item.rarity] || '#7d8590';
            
            let displayMarginFee = gameState.marginFee;
            displayMarginFee *= skillEffects.marginFeeMultiplier;
            displayMarginFee *= curseEffects.marginFeeMultiplier;
            document.getElementById('currentMarginFee').textContent = Math.floor(displayMarginFee);
            
            const auctionItem = document.getElementById('auctionItem');
            auctionItem.style.borderColor = item.color;
            
            if (item.rarity === 'Á•ûËØù' || item.rarity === 'Ê∑∑Ê≤å') {
                auctionItem.classList.add('mysterious-glow');
            }
            
            auctionItem.classList.add('bounce');
            setTimeout(() => {
                auctionItem.classList.remove('bounce');
            }, 600);
        }

        function calculateNashBid() {
            const aliveAIs = gameState.aiPlayers.filter(ai => !ai.eliminated);
            const numPlayers = aliveAIs.length + 1;
            const nashRatio = (numPlayers - 1) / numPlayers;
            
            const skillEffects = applySkillEffects();
            let nashBid = Math.floor(gameState.playerValuation * nashRatio);
            
            if (skillEffects.nashBonus) {
                nashBid = Math.floor(nashBid * (1 + skillEffects.nashBonus));
            }
            
            return nashBid;
        }

        function useNashStrategy() {
            const curseEffects = applyCurseEffects();
            
            if (curseEffects.blockNash) {
                playSound('failure');
                showFloatingText(curseEffects.nashBlockMessage, '#8b4513');
                const input = document.getElementById('bidInput');
                input.classList.add('shake');
                setTimeout(() => input.classList.remove('shake'), 600);
                return;
            }
            
            playSound('click');
            document.getElementById('bidInput').value = calculateNashBid();
            
            const input = document.getElementById('bidInput');
            input.classList.add('bounce');
            setTimeout(() => input.classList.remove('bounce'), 600);
            
            gameState.stats.economicInsights++;
        }

        function useIntuitiveStrategy() {
            playSound('click');
            
            // Âü∫‰∫éÂΩìÂâçÊÉÖÂÜµÁöÑÁõ¥ËßâÂá∫‰ª∑
            const baseValue = gameState.playerValuation;
            const currentWealth = gameState.totalWealth;
            const riskFactor = currentWealth > gameState.settings.initialWealth * 2 ? 1.2 : 0.8;
            const threatFactor = gameState.threatLevel === 'critical' ? 0.7 : 1.0;
            
            const intuitiveBase = Math.floor(baseValue * 0.6 * riskFactor * threatFactor);
            const variation = Math.floor(intuitiveBase * 0.3);
            const intuitiveBid = intuitiveBase + Math.floor(Math.random() * variation);
            
            document.getElementById('bidInput').value = Math.max(1, intuitiveBid);
            showFloatingText('Ë∑üÈöèÂÜÖÂøÉÁöÑÂ£∞Èü≥...', '#9f7aea');
        }
        
        function submitBid() {
            const bidInput = document.getElementById('bidInput');
            let bid = parseInt(bidInput.value) || 0;
            
            if (bid <= 0) {
                playSound('failure');
                bidInput.classList.add('shake');
                setTimeout(() => bidInput.classList.remove('shake'), 600);
                return;
            }
            
            const curseEffects = applyCurseEffects(bid);
            const originalBid = bid;
            bid = Math.floor(bid * curseEffects.bidMultiplier);
            
            if (curseEffects.message) {
                showFloatingText(curseEffects.message, '#8b4513');
            }
            
            if (bid > gameState.totalWealth) {
                playSound('failure');
                showFloatingText('Ë¥¢ÂØå‰∏çË∂≥!', '#f85149');
                bidInput.classList.add('shake');
                setTimeout(() => bidInput.classList.remove('shake'), 600);
                return;
            }
            
            playSound('click');
            gameState.playerBid = bid;
            gameState.stats.totalBids++;
            
            // ËÆ∞ÂΩïÁ∫≥‰ªÄÁ≠ñÁï•‰ΩøÁî®
            const nashBid = calculateNashBid();
            if (Math.abs(originalBid - nashBid) <= 5) {
                gameState.stats.nashUsageCount++;
            }
            gameState.stats.nashUsageRate = gameState.stats.nashUsageCount / gameState.stats.totalBids;
            
            document.getElementById('biddingPanel').classList.add('hidden');
            gameState.biddingPhase = 'thinking';
            
            showThinkingPhase();
        }
        
        function showThinkingPhase() {
            const aiCards = document.querySelectorAll('#aiPlayers .card:not(.eliminated)');
            aiCards.forEach((card, index) => {
                setTimeout(() => {
                    const thinking = document.createElement('div');
                    thinking.className = 'thinking-animation';
                    thinking.textContent = ['ü§î', 'üí≠', 'üé≠', 'üòà', 'üëÅÔ∏è'][Math.floor(Math.random() * 5)];
                    card.style.position = 'relative';
                    card.appendChild(thinking);
                }, index * 200);
            });
            
            showCountdown(() => {
                generateAIBids();
                gameState.biddingPhase = 'revealing';
                showBiddingReveal();
            });
        }
        
        function showCountdown(callback) {
            let count = 3;
            
            function displayCount() {
                if (count > 0) {
                    const countdown = document.createElement('div');
                    countdown.className = 'countdown-overlay';
                    countdown.textContent = count;
                    document.body.appendChild(countdown);
                    
                    playSound('click');
                    
                    setTimeout(() => {
                        countdown.remove();
                    }, 1000);
                    
                    count--;
                    setTimeout(displayCount, 1000);
                } else {
                    const bidsText = document.createElement('div');
                    bidsText.className = 'countdown-overlay';
                    bidsText.textContent = 'ÂëΩËøêÈôç‰∏¥!';
                    bidsText.style.fontSize = '48px';
                    document.body.appendChild(bidsText);
                    
                    playSound('level');
                    
                    setTimeout(() => {
                        bidsText.remove();
                        callback();
                    }, 1000);
                }
            }
            
            displayCount();
        }
        
        function generateAIBids() {
            const aliveAIs = gameState.aiPlayers.filter(ai => !ai.eliminated);
            
            aliveAIs.forEach(ai => {
                const aiValuation = Math.floor(gameState.currentItem.base * (0.7 + Math.random() * 0.6));
                let baseBid = 0;
                
                switch(ai.strategy) {
                    case "nash":
                        const numPlayers = aliveAIs.length + 1;
                        baseBid = Math.floor(aiValuation * (numPlayers - 1) / numPlayers);
                        break;
                    case "aggressive":
                        baseBid = Math.floor(aiValuation * (0.85 + Math.random() * 0.1));
                        break;
                    case "conservative":
                        baseBid = Math.floor(aiValuation * (0.4 + Math.random() * 0.3));
                        if (ai.totalWealth < gameState.marginFee * 3) {
                            baseBid = Math.floor(baseBid * 0.7);
                        }
                        break;
                    case "adaptive":
                        const winRate = ai.wins / Math.max(gameState.level, 1);
                        let adaptiveRatio = winRate > 0.5 ? 0.6 : 0.8;
                        if (ai.totalWealth < gameState.marginFee * 2) {
                            adaptiveRatio *= 0.6;
                        }
                        baseBid = Math.floor(aiValuation * (adaptiveRatio + Math.random() * 0.2));
                        break;
                    case "psychological":
                        const bluffChance = Math.random();
                        if (bluffChance < 0.3 && ai.totalWealth > gameState.marginFee * 3) {
                            baseBid = Math.floor(aiValuation * (1.2 + Math.random() * 0.3));
                        } else {
                            baseBid = Math.floor(aiValuation * (0.5 + Math.random() * 0.4));
                        }
                        break;
                    case "random":
                        baseBid = Math.floor(Math.random() * aiValuation);
                        break;
                }
                
                // ÊÉÖÁª™ÂíåÁñëËôë‰øÆÊ≠£
                switch(ai.mood) {
                    case 'confident':
                        baseBid = Math.floor(baseBid * (1.2 + Math.random() * 0.2));
                        break;
                    case 'worried':
                        baseBid = Math.floor(baseBid * (0.6 + Math.random() * 0.2));
                        break;
                    case 'paranoid':
                        baseBid = Math.floor(baseBid * (1.5 + Math.random() * 0.5)); // ÊûÅÁ´ØÂá∫‰ª∑
                        break;
                }
                
                if (ai.suspicionLevel > 70) {
                    baseBid = Math.floor(baseBid * (1.1 + Math.random() * 0.3)); // ÁñëËôëÈ´òÊó∂Êõ¥ÊøÄËøõ
                }
                
                ai.bid = Math.max(1, Math.min(baseBid, ai.totalWealth));
                ai.valuation = aiValuation;
                ai.lastAction = 'bidding';
            });
        }
        
        function showBiddingReveal() {
            const revealStage = document.getElementById('biddingRevealStage');
            const revealTitle = document.getElementById('revealTitle');
            const revealPlayers = document.getElementById('revealPlayers');
            
            revealTitle.textContent = 'ÂëΩËøêÂÆ°Âà§!';
            revealPlayers.innerHTML = '';
            
            const participants = [];
            
            if (gameState.totalWealth >= 0) {
                participants.push({
                    name: 'Áé©ÂÆ∂',
                    bid: gameState.playerBid,
                    totalWealth: gameState.totalWealth,
                    strategy: 'human',
                    desc: 'ÁêÜÊÄß‰∏éÁñØÁãÇÁöÑÂåñË∫´',
                    color: '#4a9eff',
                    rgb: '74, 159, 255',
                    isPlayer: true,
                    eliminated: false
                });
            }
            
            gameState.aiPlayers.filter(ai => !ai.eliminated).forEach(ai => {
                participants.push({
                    ...ai,
                    isPlayer: false
                });
            });
            
            const winningBid = Math.max(...participants.map(p => p.bid));
            const winner = participants.find(p => p.bid === winningBid);
            
            participants.forEach((participant, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = 'reveal-player';
                playerCard.style.setProperty('--player-color', participant.color);
                playerCard.style.animationDelay = `${index * 0.2}s`;
                
                if (participant.bid === winningBid) {
                    playerCard.classList.add('winner');
                }
                
                playerCard.innerHTML = `
                    <div class="reveal-player-name">${participant.name}</div>
                    <div class="reveal-player-bid">${participant.bid}</div>
                    <div class="reveal-player-wealth">Ë¥¢ÂØå: ${Math.floor(participant.totalWealth)}</div>
                    <div style="font-size: 8px; color: #7d8590; margin-top: 5px;">${participant.desc}</div>
                `;
                
                revealPlayers.appendChild(playerCard);
                
                setTimeout(() => {
                    createBidBubble(participant, index, participant.bid === winningBid);
                }, index * 200 + 500);
            });
            
            revealStage.classList.add('active');
        }
        
        function createBidBubble(participant, index, isWinner) {
            const container = document.getElementById('biddingAnimationContainer');
            const bubble = document.createElement('div');
            bubble.className = 'bid-bubble';
            bubble.style.setProperty('--player-color', participant.color);
            bubble.style.setProperty('--player-color-rgba', participant.color.replace('#', '').match(/.{2}/g).map(hex => parseInt(hex, 16)).join(', ') + ', 0.3');
            
            const baseX = 100 + (index * 150) % (window.innerWidth - 200);
            const baseY = 200 + (Math.floor(index / 4) * 80);
            
            bubble.style.left = baseX + 'px';
            bubble.style.top = baseY + 'px';
            
            bubble.innerHTML = `
                <strong>${participant.name}</strong><br>
                ${participant.bid}
            `;
            
            container.appendChild(bubble);
            
            if (isWinner) {
                setTimeout(() => {
                    playSound('success');
                    createParticleEffect(baseX, baseY, 'success', 15);
                }, 1000);
            }
            
            setTimeout(() => {
                bubble.remove();
            }, 5000);
        }
        
        function continueFromReveal() {
            playSound('click');
            
            document.getElementById('biddingRevealStage').classList.remove('active');
            document.querySelectorAll('.thinking-animation').forEach(el => el.remove());
            
            processAuctionResult(gameState.playerBid);
            
            gameState.biddingPhase = 'complete';
        }
        
        function processAuctionResult(playerBid) {
            const aliveAIs = gameState.aiPlayers.filter(ai => !ai.eliminated);
            
            let winner = null;
            let winningBid = playerBid;
            let isPlayerWinner = true;
            
            aliveAIs.forEach(ai => {
                if (ai.bid > winningBid) {
                    winner = ai;
                    winningBid = ai.bid;
                    isPlayerWinner = false;
                }
            });
            
            if (!winner && isPlayerWinner) {
                winner = { name: 'Áé©ÂÆ∂' };
            }
            
            let profit = 0;
            let success = false;
            let wealthChange = 0;
            let itemEffects = { triggeredSkill: false, triggeredCurse: false };
            
            if (isPlayerWinner && winningBid > 0) {
                gameState.totalWealth -= winningBid;
                gameState.totalWealth += gameState.playerValuation;
                
                if (gameState.cash >= winningBid) {
                    gameState.cash -= winningBid;
                } else {
                    gameState.cash = 0;
                }
                
                itemEffects = processItemEffects(gameState.currentItem);
                
                gameState.wonItems.push({
                    ...gameState.currentItem,
                    valuation: gameState.playerValuation,
                    purchasePrice: winningBid,
                    level: gameState.level,
                    triggeredSkill: itemEffects.triggeredSkill,
                    triggeredCurse: itemEffects.triggeredCurse
                });
                
                profit = gameState.playerValuation - winningBid;
                wealthChange = profit;
                gameState.totalProfit += profit;
                gameState.streak++;
                success = true;
                
                gameState.stats.totalWins++;
                
                if (Math.abs(playerBid - calculateNashBid()) <= 5) {
                    gameState.stats.nashWinStreak++;
                } else {
                    gameState.stats.nashWinStreak = 0;
                }
                
                if (gameState.activeCurses.length >= 3) {
                    gameState.stats.cursedVictory = Math.max(gameState.stats.cursedVictory, gameState.activeCurses.length);
                }
                
                playSound('success');
                
                const rect = document.getElementById('auctionItem').getBoundingClientRect();
                createParticleEffect(
                    rect.left + rect.width / 2,
                    rect.top + rect.height / 2,
                    itemEffects.triggeredSkill ? 'skill' : (itemEffects.triggeredCurse ? 'curse' : 'success'),
                    25
                );
                
                showFloatingText(`Ë¥¢ÂØå+${profit}!`, "#2ea043");
                
            } else {
                profit = -gameState.marginFee;
                wealthChange = -gameState.marginFee;
                gameState.totalProfit += profit;
                gameState.streak = 0;
                gameState.stats.nashWinStreak = 0;
                
                if (profit < 0) {
                    gameState.stats.negativeProfitRounds++;
                }
                
                playSound('failure');
                
                const rect = document.getElementById('auctionItem').getBoundingClientRect();
                createParticleEffect(
                    rect.left + rect.width / 2,
                    rect.top + rect.height / 2,
                    'failure',
                    15
                );
                
                showFloatingText(`ÊçüÂ§±‰øùËØÅÈáë: ${gameState.marginFee}`, "#f85149");
            }
            
            // AIÂ§ÑÁêÜ
            aliveAIs.forEach(ai => {
                if (ai === winner && winner !== null && typeof winner === 'object') {
                    ai.totalWealth -= ai.bid;
                    ai.totalWealth += ai.valuation;
                    ai.wins++;
                    ai.lastAction = 'won';
                    ai.mood = 'confident';
                } else {
                    ai.lastAction = 'lost';
                    if (ai.mood === 'confident') {
                        ai.mood = 'neutral';
                    }
                }
                
                // AIÁñëËôëÂ¢ûÈïø
                if (success && isPlayerWinner) {
                    ai.suspicionLevel += 15 + Math.random() * 10;
                }
            });
            
            checkAchievements();
            checkEliminations();
            
            showResult(winner?.name || 'Êú™Áü•', winningBid, playerBid, profit, success, wealthChange, itemEffects);
            updateRoundStats(playerBid, winningBid, winner?.name || 'Êú™Áü•', wealthChange);
        }
        
        function showMarginNotice(fee) {
            const auctionItem = document.getElementById('auctionItem');
            const notice = document.createElement('div');
            notice.className = 'margin-notice';
            notice.innerHTML = `
                Â∑≤ÊîØ‰ªòÂÖ•Âú∫Ë¥πÔºö${fee}<br>
                Ââ©‰ΩôË¥¢ÂØå: ${Math.floor(gameState.totalWealth)}
            `;
            
            auctionItem.style.position = 'relative';
            auctionItem.appendChild(notice);
            
            setTimeout(() => {
                notice.remove();
            }, 3000);
        }
        
        function checkEliminations() {
            let eliminatedThisRound = [];
            
            gameState.aiPlayers.forEach(ai => {
                if (!ai.eliminated && ai.totalWealth < gameState.marginFee) {
                    ai.eliminated = true;
                    eliminatedThisRound.push({
                        name: ai.name,
                        type: 'ai',
                        color: ai.color
                    });
                }
            });
            
            if (gameState.totalWealth < gameState.marginFee) {
                eliminatedThisRound.push({
                    name: 'Áé©ÂÆ∂',
                    type: 'player',
                    color: '#4a9eff'
                });
            }
            
            if (eliminatedThisRound.length > 0) {
                showEliminationAnimation(eliminatedThisRound);
            }
            
            return eliminatedThisRound;
        }
        
        function showEliminationAnimation(eliminated) {
            const overlay = document.getElementById('eliminationOverlay');
            const title = document.getElementById('eliminationTitle');
            const subtitle = document.getElementById('eliminationSubtitle');
            
            playSound('elimination');
            
            for (let i = 0; i < 40; i++) {
                setTimeout(() => {
                    createParticleEffect(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight,
                        'elimination',
                        5
                    );
                }, i * 50);
            }
            
            if (eliminated.some(e => e.type === 'player')) {
                title.textContent = 'ÁÅµÈ≠ÇÊ∂àÊï£';
                subtitle.textContent = 'Ë¥¢ÂØåËÄóÂ∞Ω - Ë¢´ÊöóÂΩ±ÂêûÂô¨';
            } else {
                const names = eliminated.map(e => e.name).join(', ');
                title.textContent = `${names}`;
                subtitle.textContent = 'Â∑≤Ë¢´ÊöóÂΩ±ÂêûÂô¨';
            }
            
            overlay.classList.add('active');
        }
        
        function hideElimination() {
            playSound('click');
            document.getElementById('eliminationOverlay').classList.remove('active');
            
            if (gameState.totalWealth < gameState.marginFee) {
                setTimeout(() => {
                    const rankings = calculateFinalRankings();
                    gameOver(false, false);
                }, 500);
            } else {
                updateAIPlayersUI();
                updateUI();
            }
        }
        
        function showResult(winner, winningBid, playerBid, profit, success, wealthChange, itemEffects) {
            const panel = document.getElementById('resultPanel');
            const title = document.getElementById('resultTitle');
            const stats = document.getElementById('resultStats');
            const content = document.getElementById('resultContent');
            
            title.textContent = success ? 'ÂæÅÊúçÊàêÂäü!' : 'ËØïÁÇºÂ§±Ë¥•';
            title.style.color = success ? "#2ea043" : "#f85149";
            
            stats.innerHTML = `
                <div class="result-stat">
                    <div class="result-stat-label">ËÉúÂà©ËÄÖ</div>
                    <div class="result-stat-value">${winner}</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">Êàê‰∫§‰ª∑</div>
                    <div class="result-stat-value">${winningBid}</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">‰Ω†ÁöÑÂá∫‰ª∑</div>
                    <div class="result-stat-value">${playerBid}</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">Ë¥¢ÂØåÂèòÂåñ</div>
                    <div class="result-stat-value" style="color: ${wealthChange >= 0 ? '#2ea043' : '#f85149'}">${wealthChange >= 0 ? '+' : ''}${wealthChange}</div>
                </div>
            `;
            
            const nashBid = calculateNashBid();
            const deviation = playerBid - nashBid;
            const itemsValue = gameState.wonItems.reduce((sum, item) => sum + item.valuation, 0);
            
            let specialEffectText = '';
            if (itemEffects.triggeredSkill) {
                specialEffectText += '<br><span style="color: #2ea043;">‚ú® Ëé∑ÂæóÁ•ûÁßòÂäõÈáè!</span>';
            }
            if (itemEffects.triggeredCurse) {
                specialEffectText += '<br><span style="color: #8b4513;">üíÄ Ëß¶ÂèëÂè§ËÄÅËØÖÂíí!</span>';
            }
            
            const mysteryText = gameState.currentItem && gameState.currentItem.mysteryLevel > gameState.mysteryUnlocked ? 
                '<br><span style="color: #9f7aea;">üîÆ Á•ûÁßòÈù¢Á∫±Â∞öÊú™Êè≠ÂºÄ...</span>' : '';
            
            const analysis = `
                <div style="margin: 20px 0; padding: 15px; background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px;">
                    <div style="color: #ffd700; font-size: 10px; margin-bottom: 10px;">ÁêÜÊÄßÂàÜÊûê</div>
                    <div style="font-size: 8px; color: #c9d1d9;">
                        ‰Ω†ÁöÑÂá∫‰ª∑: ${playerBid} | Á∫≥‰ªÄÂá∫‰ª∑: ${nashBid}<br>
                        ÂÅèÂ∑Æ: <span style="color: ${Math.abs(deviation) <= 10 ? '#2ea043' : '#f85149'}">${deviation > 0 ? '+' : ''}${deviation}</span>
                        ${Math.abs(deviation) <= 10 ? ' ÂÆåÁæéÁêÜÊÄß!' : ' ÂèóÊÉÖÊÑüÂΩ±Âìç'}<br>
                        <hr style="margin: 8px 0; border: none; border-top: 1px solid #30363d;">
                        ÊÄªË¥¢ÂØå: <span style="color: #ffd700">${Math.floor(gameState.totalWealth)}</span> 
                        (Áé∞Èáë: ${gameState.cash} + ËóèÂìÅ: ${Math.floor(itemsValue)})<br>
                        Â®ÅËÉÅÁ≠âÁ∫ß: <span style="color: ${gameState.threatLevel === 'critical' ? '#f85149' : '#2ea043'}">${gameState.threatLevel.toUpperCase()}</span>
                        ${success ? `<br>Ëé∑Âæó‰º∞ÂÄº: <span style="color: #2ea043">${gameState.playerValuation}</span>` : `<br>ÊçüÂ§±: <span style="color: #f85149">${Math.abs(profit)}</span>`}
                        ${specialEffectText}
                        ${mysteryText}
                    </div>
                </div>
                
                <div style="margin: 15px 0; padding: 15px; background: rgba(139, 69, 19, 0.1); border: 1px solid rgba(139, 69, 19, 0.3); border-radius: 8px;">
                    <div style="color: #8b4513; font-size: 10px; margin-bottom: 10px;">Ë∂ÖËá™ÁÑ∂Áä∂ÊÄÅ</div>
                    <div style="font-size: 8px; color: #c9d1d9;">
                        Á•ûÂäõ: ${gameState.activeSkills.length > 0 ? gameState.activeSkills.map(s => s.name).join(', ') : 'Êó†'}<br>
                        ËØÖÂíí: ${gameState.activeCurses.length > 0 ? gameState.activeCurses.map(c => c.name).join(', ') : 'Êó†'}<br>
                        Â∑≤Ëß£ÈîÅÁ•ûÁßò: ${gameState.mysteryUnlocked}/6<br>
                        Èò¥Ë∞ãÁ≠âÁ∫ß: ${currentStoryState.conspiracyLevel}
                    </div>
                </div>
            `;
            
            content.innerHTML = analysis;
            panel.classList.add('active');
        }
        
        function nextRound() {
            playSound('click');
            gameState.level++;
            
            document.getElementById('resultPanel').classList.remove('active');
            updateUI();
            
            if (gameState.level > gameState.maxLevel) {
                setTimeout(() => {
                    const rankings = calculateFinalRankings();
                    const playerRank = rankings.findIndex(p => p.name === 'Áé©ÂÆ∂') + 1;
                    gameOver(playerRank === 1, false);
                }, 500);
            } else {
                startNewRound();
            }
        }

        function calculateFinalRankings() {
            const participants = [];
            
            participants.push({
                name: 'Áé©ÂÆ∂',
                totalWealth: gameState.totalWealth,
                isPlayer: true,
                eliminated: gameState.totalWealth < gameState.marginFee,
                finalScore: gameState.totalWealth + (gameState.mysteryUnlocked * 50)
            });
            
            gameState.aiPlayers.forEach(ai => {
                participants.push({
                    name: ai.name,
                    totalWealth: ai.totalWealth,
                    isPlayer: false,
                    eliminated: ai.eliminated,
                    strategy: ai.strategy,
                    color: ai.color,
                    finalScore: ai.totalWealth + (Math.random() * 100) // AIÁ•ûÁßòÂä†Êàê
                });
            });
            
            return participants.sort((a, b) => b.finalScore - a.finalScore);
        }
        
        function gameOver(victory, lastSurvivor = false) {
            gameState.isGameOver = true;
            
            gameState.stats.gameTime = (Date.now() - gameState.stats.gameStartTime) / 1000;
            gameState.stats.gameCompleted = true;
            gameState.stats.lastSurvivor = lastSurvivor;
            
            const finalRankings = calculateFinalRankings();
            const playerRank = finalRankings.findIndex(p => p.name === 'Áé©ÂÆ∂') + 1;
            
            gameState.stats.finalRank = playerRank;
            gameState.stats.finalWealth = gameState.totalWealth;
            gameState.stats.perfectStrategy = gameState.stats.nashUsageRate >= 0.8 && gameState.stats.negativeProfitRounds === 0;
            
            if (gameState.totalWealth < gameState.marginFee * 3 && victory) {
                gameState.stats.comebackVictory = true;
            }
            
            checkAchievements();
            
            if (victory || playerRank === 1) {
                showVictoryScreen(finalRankings);
            } else {
                showDefeatScreen(finalRankings, playerRank);
            }
        }

        function showVictoryScreen(rankings) {
            const panel = document.getElementById('resultPanel');
            const title = document.getElementById('resultTitle');
            const stats = document.getElementById('resultStats');
            const content = document.getElementById('resultContent');
            
            title.textContent = 'ÊöóÂΩ±ÂæÅÊúçËÄÖ!';
            title.style.color = "#ffd700";
            
            const achievementCount = achievements.filter(a => a.unlocked).length;
            const itemsValue = gameState.wonItems.reduce((sum, item) => sum + item.valuation, 0);
            
            stats.innerHTML = `
                <div class="result-stat">
                    <div class="result-stat-label">ÊúÄÁªàÊéíÂêç</div>
                    <div class="result-stat-value" style="color: #ffd700;">ÊöóÂΩ±‰πãÁéã</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">Ë¥¢ÂØåÊÄªËÆ°</div>
                    <div class="result-stat-value">${Math.floor(gameState.totalWealth)}</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">‰º†Â•áÊàêÂ∞±</div>
                    <div class="result-stat-value">${achievementCount}/15</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">ËØïÁÇºÊó∂Èïø</div>
                    <div class="result-stat-value">${Math.floor(gameState.stats.gameTime / 60)}:${String(Math.floor(gameState.stats.gameTime % 60)).padStart(2, '0')}</div>
                </div>
            `;
            
            const rankingList = rankings.slice(0, 5).map((p, i) => {
                const prefix = p.name === 'Áé©ÂÆ∂' ? 'üëë ' : '   ';
                const style = p.name === 'Áé©ÂÆ∂' ? 'color: #ffd700; font-weight: bold;' : '';
                return `${prefix}${i + 1}. ${p.name}: ${Math.floor(p.totalWealth)}`;
            }).join('<br>');
            
            const hayekPortrait = `
                    ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
                    ‚îÇ  ‚ú®üëë‚ú®  ‚îÇ
                    ‚îÇ  ÂìàËÄ∂ÂÖã  ‚îÇ
                    ‚îÇ ÂæÆÁ¨ëÁÇπÂ§¥ ‚îÇ
                    ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
            `;
            
            content.innerHTML = `
                <div style="font-size: 12px; margin: 20px 0; color: #ffd700; text-align: center;">
                    ÊÅ≠ÂñúÔºÅ‰Ω†Â∑≤Êàê‰∏∫ÊöóÂΩ±ÊãçÂçñÊâÄÁöÑÊñ∞‰∏ª‰∫∫ÔºÅ<br>
                    Âú®Ë∂ÖËá™ÁÑ∂‰∏éÁêÜÊÄßÁöÑËæÉÈáè‰∏≠Ëé∑Âæó‰∫ÜÊúÄÁªàËÉúÂà©ÔºÅ
                </div>
                
                <div style="margin: 20px 0; text-align: center;">
                    <pre style="font-size: 8px; color: #ffd700; line-height: 1.2; margin: 0;">${hayekPortrait}</pre>
                    <div style="font-size: 7px; color: #ffd700; margin-top: 5px;">
                        "ÂìàËÄ∂ÂÖãÁöÑÁÅµÈ≠ÇÁªà‰∫éÂèØ‰ª•ÂÆâÊÅØ‰∫Ü"
                    </div>
                </div>
                
                <div style="margin: 20px 0; padding: 15px; background: rgba(255, 215, 0, 0.1); border: 1px solid rgba(255, 215, 0, 0.3); border-radius: 8px;">
                    <div style="color: #ffd700; font-size: 10px; margin-bottom: 10px; text-align: center;">ÊúÄÁªàÊéíË°åÊ¶ú</div>
                    <div style="font-size: 8px; color: #c9d1d9; font-family: monospace; line-height: 1.6;">
                        ${rankingList}
                    </div>
                </div>
                
                <div style="margin: 15px 0; padding: 15px; background: rgba(13, 17, 23, 0.8); border: 2px solid #ffd700; border-radius: 10px; text-align: center;">
                    <div style="color: #ffd700; font-size: 9px; margin-bottom: 8px;">"‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜÁªèÊµéÂ≠¶ÁöÑÊúÄÈ´òÂ••‰πâÔºåÁêÜÊÄß‰∏éÁñØÁãÇÁöÑÂÆåÁæéÂπ≥Ë°°„ÄÇÁé∞Âú®ÔºåËøô‰∏™ÊöóÂΩ±‰∏ñÁïåÁöÑ‰∏ÄÂàáÈÉΩÂ±û‰∫é‰Ω†‰∫Ü„ÄÇ"</div>
                    <div style="color: #9f7aea; font-size: 7px; font-style: italic;">
                        - ÊöóÂΩ±ÊãçÂçñÊâÄÁöÑÊúÄÁªàÂêØÁ§∫
                    </div>
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button class="pixel-btn" style="font-size: 8px;" onclick="showAchievements()">Êü•Áúã‰º†Â•á</button>
                </div>
            `;
            
            playSound('level');
            
            // ËÉúÂà©ÁâπÊïà
            for (let i = 0; i < 60; i++) {
                setTimeout(() => {
                    createParticleEffect(
                        Math.random() * window.innerWidth,
                        Math.random() * window.innerHeight,
                        ['success', 'skill', 'mystery'][Math.floor(Math.random() * 3)],
                        5
                    );
                }, i * 100);
            }
            
            saveAchievements();
            panel.classList.add('active');
        }

        function showDefeatScreen(rankings, playerRank) {
            const panel = document.getElementById('resultPanel');
            const title = document.getElementById('resultTitle');
            const stats = document.getElementById('resultStats');
            const content = document.getElementById('resultContent');
            
            const defeatEndings = [
                {
                    title: "ÊöóÂΩ±ÂêûÂô¨",
                    subtitle: "ÁêÜÊÄßÁöÑÈô®ËêΩ",
                    quote: "Êàë‰ª•‰∏∫Êï∞Â≠¶ËÉΩÊãØÊïë‰∏ÄÂàáÔºåÂç¥ÂøòËÆ∞‰∫ÜËøôÈáåÁöÑËßÑÂàôÊó©Â∑≤Ë¢´Êâ≠Êõ≤„ÄÇ",
                    advice: "Âú®Ë∂ÖËá™ÁÑ∂Èù¢ÂâçÔºåÁ∫ØÁ≤πÁöÑÁêÜÊÄßÊúâÊó∂ÊòØ‰∏ÄÁßçÈôêÂà∂„ÄÇ",
                    color: "#8b4513"
                },
                {
                    title: "ÁñØÁãÇÁöÑ‰ª£‰ª∑",
                    subtitle: "Êã•Êä±ÈªëÊöóÁöÑÂêéÊûú",
                    quote: "ÊàëËé∑Âæó‰∫ÜÂäõÈáèÔºåÂç¥Â§±Âéª‰∫ÜËá™Êàë„ÄÇËøôÂ∞±ÊòØ‰∏éÊÅ∂È≠î‰∫§ÊòìÁöÑ‰ª£‰ª∑„ÄÇ",
                    advice: "ÂäõÈáèÊÄªÊòØË¶Å‰ªòÂá∫‰ª£‰ª∑ÁöÑÔºåÁ°Æ‰øù‰Ω†ËÉΩÊâøÂèóÂÆÉ„ÄÇ",
                    color: "#f85149"
                },
                {
                    title: "Êú™Ëß£‰πãË∞ú",
                    subtitle: "ÁúüÁõ∏‰æùÁÑ∂ÈöêËóè",
                    quote: "ÊàëË∑ùÁ¶ªÁúüÁõ∏Â¶ÇÊ≠§Êé•ËøëÔºåÂç¥Âú®ÊúÄÂêé‰∏ÄÊ≠•Ë∑åÂÄí‰∫Ü„ÄÇ",
                    advice: "Êúâ‰∫õÁßòÂØÜÈúÄË¶ÅÊõ¥Â§öÁöÑÊô∫ÊÖßÂíåÂãáÊ∞îÊâçËÉΩÊè≠ÂºÄ„ÄÇ",
                    color: "#9f7aea"
                }
            ];
            
            const ending = defeatEndings[Math.floor(Math.random() * defeatEndings.length)];
            
            title.textContent = ending.title;
            title.style.color = ending.color;
            
            const achievementCount = achievements.filter(a => a.unlocked).length;
            
            stats.innerHTML = `
                <div class="result-stat">
                    <div class="result-stat-label">ÊúÄÁªàÊéíÂêç</div>
                    <div class="result-stat-value" style="color: ${ending.color};">Á¨¨${playerRank}Âêç</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">Ë¥¢ÂØåÊÄªËÆ°</div>
                    <div class="result-stat-value">${Math.floor(gameState.totalWealth)}</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">‰º†Â•áÊàêÂ∞±</div>
                    <div class="result-stat-value">${achievementCount}/15</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-label">Âà∞ËææËΩÆÊ¨°</div>
                    <div class="result-stat-value">${gameState.level}</div>
                </div>
            `;
            
            const rankingList = rankings.slice(0, Math.min(5, rankings.length)).map((p, i) => {
                const prefix = p.name === 'Áé©ÂÆ∂' ? '‚Üí ' : '   ';
                const style = p.name === 'Áé©ÂÆ∂' ? 'color: #ffd700; font-weight: bold;' : '';
                return `${prefix}${i + 1}. ${p.name}: ${Math.floor(p.totalWealth)}`;
            }).join('<br>');
            
            const hayekPortrait = `
                    ‚ï≠‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïÆ
                    ‚îÇ  üòîüí≠üìâ  ‚îÇ
                    ‚îÇ  ÂìàËÄ∂ÂÖã  ‚îÇ
                    ‚îÇ Â§±ÊúõÊëáÂ§¥ ‚îÇ
                    ‚ï∞‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ïØ
            `;
            
            content.innerHTML = `
                <div style="font-size: 12px; margin: 20px 0; color: ${ending.color}; text-align: center;">
                    ${ending.subtitle}
                </div>
                
                <div style="margin: 20px 0; text-align: center;">
                    <pre style="font-size: 8px; color: #7d8590; line-height: 1.2; margin: 0;">${hayekPortrait}</pre>
                    <div style="font-size: 7px; color: #7d8590; margin-top: 5px;">
                        "ÂìàËÄ∂ÂÖãÁöÑÁÅµÈ≠Ç‰æùÁÑ∂Âú®Á≠âÂæÖÁùÄÁúüÊ≠£ÁöÑÁªßÊâøËÄÖ"
                    </div>
                </div>
                
                <div style="margin: 20px 0; padding: 15px; background: rgba(${ending.color.replace('#', '')}, 0.1); border: 1px solid rgba(${ending.color.replace('#', '')}, 0.3); border-radius: 8px;">
                    <div style="color: ${ending.color}; font-size: 10px; margin-bottom: 10px; text-align: center;">ÊéíË°åÊ¶ú</div>
                    <div style="font-size: 8px; color: #c9d1d9; font-family: monospace; line-height: 1.6;">
                        ${rankingList}
                    </div>
                </div>
                
                <div style="margin: 15px 0; padding: 15px; background: rgba(13, 17, 23, 0.8); border: 2px solid #30363d; border-radius: 10px; text-align: center;">
                    <div style="color: ${ending.color}; font-size: 9px; margin-bottom: 8px;">"${ending.quote}"</div>
                    <div style="color: #7d8590; font-size: 7px; font-style: italic;">
                        ${ending.advice}
                    </div>
                </div>
                
                <div style="font-size: 8px; color: #7d8590; line-height: 1.6; text-align: center; margin-top: 15px;">
                    "Âú®ÊöóÂΩ±‰∏≠Â≠¶Âà∞ÁöÑÊØè‰∏ÄËØæÔºåÈÉΩÊòØÈÄöÂæÄÁúüÁõ∏ÁöÑÈò∂Ê¢Ø„ÄÇ"<br>
                    - Âç≥‰ΩøÂú®Â§±Ë¥•‰∏≠ÔºåÊô∫ÊÖß‰πüÂú®Â¢ûÈïø
                </div>
                
                <div style="margin-top: 15px; text-align: center;">
                    <button class="pixel-btn" style="font-size: 8px;" onclick="showAchievements()">Êü•ÁúãÊàêÂ∞±</button>
                </div>
            `;
            
            playSound('failure');
            saveAchievements();
            panel.classList.add('active');
        }
        
        function updateRoundStats(playerBid, winningBid, winner, wealthChange) {
            const container = document.getElementById('roundStats');
            if (!container) return;
            
            const nashBid = calculateNashBid();
            const deviation = playerBid - nashBid;
            const deviationColor = Math.abs(deviation) <= 10 ? '#2ea043' : '#f85149';
            
            let aiInfo = '';
            gameState.aiPlayers.filter(ai => !ai.eliminated).forEach(ai => {
                const wealthColor = ai.totalWealth <= gameState.marginFee ? '#f85149' : '#c9d1d9';
                const suspicionColor = ai.suspicionLevel > 70 ? '#f85149' : '#7d8590';
                aiInfo += `${ai.name}: ${ai.bid} <span style="color: ${wealthColor}">(${Math.floor(ai.totalWealth)})</span> 
                          <span style="color: ${suspicionColor}; font-size: 6px;">[${Math.floor(ai.suspicionLevel)}%]</span><br>`;
            });
            
            const itemsValue = gameState.wonItems.reduce((sum, item) => sum + item.valuation, 0);
            
            container.innerHTML = `
                <div class="card">
                    <div class="card-title">ÊãçÂçñÂàÜÊûê</div>
                    <div class="card-content">
                        ‰Ω†ÁöÑÂá∫‰ª∑: ${playerBid}<br>
                        ÁêÜÊÄßÂá∫‰ª∑: ${nashBid}<br>
                        <span style="color: ${deviationColor}">ÂÅèÂ∑Æ: ${deviation > 0 ? '+' : ''}${deviation}</span><br>
                        Ëé∑ËÉúËÄÖ: ${winner}<br>
                        Êàê‰∫§‰ª∑: ${winningBid}<br>
                        Ë¥¢ÂØåÂèòÂåñ: <span style="color: ${wealthChange >= 0 ? '#2ea043' : '#f85149'}">${wealthChange >= 0 ? '+' : ''}${wealthChange}</span><br>
                        Â®ÅËÉÅÁ≠âÁ∫ß: <span style="color: ${gameState.threatLevel === 'critical' ? '#f85149' : '#2ea043'}">${gameState.threatLevel.toUpperCase()}</span>
                    </div>
                </div>
                <div class="card" style="margin-top: 15px;">
                    <div class="card-title">Ë¥¢ÂØåÊûÑÊàê</div>
                    <div class="card-content" style="font-size: 7px;">
                        Áé∞Èáë: <span style="color: ${gameState.cash <= gameState.marginFee ? '#f85149' : '#2ea043'}">${gameState.cash}</span><br>
                        ËóèÂìÅ‰ª∑ÂÄº: <span style="color: #ffd700">${Math.floor(itemsValue)}</span><br>
                        ÊÄªË¥¢ÂØå: <span style="color: #4a9eff">${Math.floor(gameState.totalWealth)}</span><br>
                        Á•ûÁßòËß£ÈîÅ: ${gameState.mysteryUnlocked}/6
                    </div>
                </div>
                <div class="card" style="margin-top: 15px;">
                    <div class="card-title">Á´û‰∫âËÄÖÊÉÖÊä•</div>
                    <div class="card-content" style="font-size: 7px;">
                        ${aiInfo}
                    </div>
                </div>
            `;
        }

        // ===========================
        // ÊàêÂ∞±Á≥ªÁªü
        // ===========================
        
        function checkAchievements() {
            achievements.forEach(achievement => {
                if (!achievement.unlocked && achievement.condition(gameState.stats)) {
                    unlockAchievement(achievement);
                }
            });
        }

        function unlockAchievement(achievement) {
            achievement.unlocked = true;
            gameState.unlockedAchievements.push(achievement.id);
            
            showAchievementNotification(achievement);
            saveAchievements();
            playSound('level');
        }

        function showAchievementNotification(achievement) {
            const notification = document.getElementById('achievementNotification');
            const icon = document.getElementById('notificationIcon');
            const name = document.getElementById('notificationName');
            const quote = document.getElementById('notificationQuote');
            
            icon.textContent = achievement.icon;
            name.textContent = achievement.name;
            quote.textContent = achievement.quote;
            
            notification.style.display = 'block';
            notification.classList.add('show');
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createParticleEffect(
                        window.innerWidth - 200,
                        100,
                        'success',
                        3
                    );
                }, i * 50);
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 1000);
            }, 5000);
        }

        function showAchievements() {
            playSound('click');
            const panel = document.getElementById('achievementPanel');
            updateAchievementGrid();
            panel.classList.add('active');
        }

        function hideAchievements() {
            playSound('click');
            document.getElementById('achievementPanel').classList.remove('active');
        }

        function updateAchievementGrid() {
            const grid = document.getElementById('achievementGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            achievements.forEach(achievement => {
                const item = document.createElement('div');
                item.className = `achievement-item ${achievement.unlocked ? 'unlocked' : ''}`;
                
                item.innerHTML = `
                    <div class="achievement-item-header">
                        <div class="achievement-item-icon">${achievement.icon}</div>
                        <div class="achievement-item-name">${achievement.name}</div>
                    </div>
                    <div class="achievement-item-desc">${achievement.description}</div>
                    <div class="achievement-item-quote">${achievement.quote}</div>
                `;
                
                grid.appendChild(item);
            });
        }

        function saveAchievements() {
            try {
                const achievementData = {
                    unlocked: gameState.unlockedAchievements,
                    stats: gameState.stats
                };
                localStorage.setItem('shadow_auction_achievements', JSON.stringify(achievementData));
            } catch (e) {
                console.log('Êó†Ê≥ï‰øùÂ≠òÊàêÂ∞±Êï∞ÊçÆ');
            }
        }

        function loadAchievements() {
            try {
                const data = localStorage.getItem('shadow_auction_achievements');
                if (data) {
                    const achievementData = JSON.parse(data);
                    gameState.unlockedAchievements = achievementData.unlocked || [];
                    gameState.stats = { ...gameState.stats, ...achievementData.stats };
                    
                    achievements.forEach(achievement => {
                        if (gameState.unlockedAchievements.includes(achievement.id)) {
                            achievement.unlocked = true;
                        }
                    });
                }
            } catch (e) {
                console.log('Êó†Ê≥ïÂä†ËΩΩÊàêÂ∞±Êï∞ÊçÆ');
            }
        }

        // ===========================
        // ÁïåÈù¢‰∫§‰∫íÂáΩÊï∞
        // ===========================
        
        function showTutorial() {
            playSound('click');
            document.getElementById('tutorialPanel').classList.add('active');
        }
        
        function hideTutorial() {
            playSound('click');
            document.getElementById('tutorialPanel').classList.remove('active');
        }

        function showLore() {
            playSound('mystery');
            document.getElementById('lorePanel').classList.add('active');
        }

        function hideLore() {
            playSound('click');
            document.getElementById('lorePanel').classList.remove('active');
        }
        
        function backToMenu() {
            playSound('click');
            gameState.isPlaying = false;
            document.getElementById('gameContainer').style.opacity = '0';
            document.getElementById('gameContainer').style.pointerEvents = 'none';
            document.getElementById('resultPanel').classList.remove('active');
            
            setTimeout(() => {
                document.getElementById('startScreen').classList.remove('hidden');
                document.getElementById('startScreen').style.opacity = '1';
                document.getElementById('startScreen').style.pointerEvents = 'all';
            }, 500);
        }
        
        function toggleFullscreen() {
            playSound('click');
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', (e) => {
            if (!gameState.isPlaying) return;
            
            if (e.code === 'Escape') {
                e.preventDefault();
                backToMenu();
            }
            
            if (e.code === 'Space') {
                e.preventDefault();
                if (document.getElementById('resultPanel').classList.contains('active')) {
                    if (gameState.isGameOver) {
                        document.getElementById('resultPanel').classList.remove('active');
                        initGame();
                    } else {
                        nextRound();
                    }
                }
                
                if (document.getElementById('eliminationOverlay').classList.contains('active')) {
                    hideElimination();
                }
                
                if (document.getElementById('biddingRevealStage').classList.contains('active')) {
                    continueFromReveal();
                }
            }
            
            if (e.code === 'Enter') {
                e.preventDefault();
                if (!document.getElementById('biddingPanel').classList.contains('hidden')) {
                    submitBid();
                }
            }
            
            if (e.code === 'KeyN') {
                e.preventDefault();
                if (!document.getElementById('biddingPanel').classList.contains('hidden')) {
                    useNashStrategy();
                }
            }

            if (e.code === 'KeyI') {
                e.preventDefault();
                if (!document.getElementById('biddingPanel').classList.contains('hidden')) {
                    useIntuitiveStrategy();
                }
            }
        });
        
        // Èò≤Ê≠¢Âè≥ÈîÆËèúÂçï
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            loadAchievements();
            
            try {
                new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Audio context not available');
            }
            
            console.log('%cTHE RATIONALIST\'S TRIAL - SHADOW AUCTION CHRONICLES', 'color: #ffd700; font-size: 16px; font-weight: bold;');
            console.log('%cË∏èÂÖ•ÊöóÂΩ±ÔºåÂæÅÊúçÁêÜÊÄß‰∏éÁñØÁãÇÁöÑÁªàÊûÅËØïÁÇºÔºÅ', 'color: #9f7aea; font-size: 12px;');
            
            // ËæìÂÖ•È™åËØÅ
            ['initialWealth', 'aiCount', 'marginFee'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        const value = parseInt(this.value);
                        const min = parseInt(this.min);
                        const max = parseInt(this.max);
                        if (value < min) this.value = min;
                        if (value > max) this.value = max;
                    });
                }
            });
            
            // Ëá™Âä®Êõ¥Êñ∞ÊöóÂΩ±‰º†Ë®Ä
            setInterval(() => {
                if (gameState.isPlaying) {
                    updateShadowRumors();
                }
            }, 10000);
        });
        
    </script>
</body>
</html>